import{b as se}from"./pako.esm-a0be47a3-xwDPjElE.js";import{x as le,Q as fe,v as $,G as ue}from"./index-CmYg0Rp7.js";var ee={exports:{}};(function(G){/* Copyright 2015-2021 Esri. Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 @preserve */(function(){var X=function(){var S={};S.defaultNoDataValue=-34027999387901484e22,S.decode=function(t,u){u=u||{};var i=u.encodedMaskData||u.encodedMaskData===null,a=s(t,u.inputOffset||0,i),d=u.noDataValue!==null?u.noDataValue:S.defaultNoDataValue,r=D(a,u.pixelType||Float32Array,u.encodedMaskData,d,u.returnMask),n={width:a.width,height:a.height,pixelData:r.resultPixels,minValue:r.minValue,maxValue:a.pixels.maxValue,noDataValue:d};return r.resultMask&&(n.maskData=r.resultMask),u.returnEncodedMask&&a.mask&&(n.encodedMaskData=a.mask.bitset?a.mask.bitset:null),u.returnFileInfo&&(n.fileInfo=F(a),u.computeUsedBitDepths&&(n.fileInfo.bitDepths=N(a))),n};var D=function(t,u,i,a,d){var r=0,n=t.pixels.numBlocksX,h=t.pixels.numBlocksY,o=Math.floor(t.width/n),c=Math.floor(t.height/h),g=2*t.maxZError,f=Number.MAX_VALUE,l;i=i||(t.mask?t.mask.bitset:null);var p,y;p=new u(t.width*t.height),d&&i&&(y=new Uint8Array(t.width*t.height));for(var A=new Float32Array(o*c),x,V,w=0;w<=h;w++){var M=w!==h?c:t.height%h;if(M!==0)for(var k=0;k<=n;k++){var m=k!==n?o:t.width%n;if(m!==0){var v=w*t.width*c+k*o,b=t.width-m,U=t.pixels.blocks[r],B,I,P;U.encoding<2?(U.encoding===0?B=U.rawData:(e(U.stuffedData,U.bitsPerPixel,U.numValidPixels,U.offset,g,A,t.pixels.maxValue),B=A),I=0):U.encoding===2?P=0:P=U.offset;var T;if(i)for(V=0;V<M;V++){for(v&7&&(T=i[v>>3],T<<=v&7),x=0;x<m;x++)v&7||(T=i[v>>3]),T&128?(y&&(y[v]=1),l=U.encoding<2?B[I++]:P,f=f>l?l:f,p[v++]=l):(y&&(y[v]=0),p[v++]=a),T<<=1;v+=b}else if(U.encoding<2)for(V=0;V<M;V++){for(x=0;x<m;x++)l=B[I++],f=f>l?l:f,p[v++]=l;v+=b}else for(f=f>P?P:f,V=0;V<M;V++){for(x=0;x<m;x++)p[v++]=P;v+=b}if(U.encoding===1&&I!==U.numValidPixels)throw"Block and Mask do not match";r++}}}return{resultPixels:p,resultMask:y,minValue:f}},F=function(t){return{fileIdentifierString:t.fileIdentifierString,fileVersion:t.fileVersion,imageType:t.imageType,height:t.height,width:t.width,maxZError:t.maxZError,eofOffset:t.eofOffset,mask:t.mask?{numBlocksX:t.mask.numBlocksX,numBlocksY:t.mask.numBlocksY,numBytes:t.mask.numBytes,maxValue:t.mask.maxValue}:null,pixels:{numBlocksX:t.pixels.numBlocksX,numBlocksY:t.pixels.numBlocksY,numBytes:t.pixels.numBytes,maxValue:t.pixels.maxValue,noDataValue:t.noDataValue}}},N=function(t){for(var u=t.pixels.numBlocksX*t.pixels.numBlocksY,i={},a=0;a<u;a++){var d=t.pixels.blocks[a];d.encoding===0?i.float32=!0:d.encoding===1?i[d.bitsPerPixel]=!0:i[0]=!0}return Object.keys(i)},s=function(t,u,i){var a={},d=new Uint8Array(t,u,10);if(a.fileIdentifierString=String.fromCharCode.apply(null,d),a.fileIdentifierString.trim()!=="CntZImage")throw"Unexpected file identifier string: "+a.fileIdentifierString;u+=10;var r=new DataView(t,u,24);if(a.fileVersion=r.getInt32(0,!0),a.imageType=r.getInt32(4,!0),a.height=r.getUint32(8,!0),a.width=r.getUint32(12,!0),a.maxZError=r.getFloat64(16,!0),u+=24,!i)if(r=new DataView(t,u,16),a.mask={},a.mask.numBlocksY=r.getUint32(0,!0),a.mask.numBlocksX=r.getUint32(4,!0),a.mask.numBytes=r.getUint32(8,!0),a.mask.maxValue=r.getFloat32(12,!0),u+=16,a.mask.numBytes>0){var n=new Uint8Array(Math.ceil(a.width*a.height/8));r=new DataView(t,u,a.mask.numBytes);var h=r.getInt16(0,!0),o=2,c=0;do{if(h>0)for(;h--;)n[c++]=r.getUint8(o++);else{var g=r.getUint8(o++);for(h=-h;h--;)n[c++]=g}h=r.getInt16(o,!0),o+=2}while(o<a.mask.numBytes);if(h!==-32768||c<n.length)throw"Unexpected end of mask RLE encoding";a.mask.bitset=n,u+=a.mask.numBytes}else a.mask.numBytes|a.mask.numBlocksY|a.mask.maxValue||(a.mask.bitset=new Uint8Array(Math.ceil(a.width*a.height/8)));r=new DataView(t,u,16),a.pixels={},a.pixels.numBlocksY=r.getUint32(0,!0),a.pixels.numBlocksX=r.getUint32(4,!0),a.pixels.numBytes=r.getUint32(8,!0),a.pixels.maxValue=r.getFloat32(12,!0),u+=16;var f=a.pixels.numBlocksX,l=a.pixels.numBlocksY,p=f+(a.width%f>0?1:0),y=l+(a.height%l>0?1:0);a.pixels.blocks=new Array(p*y);for(var A=0,x=0;x<y;x++)for(var V=0;V<p;V++){var w=0,M=t.byteLength-u;r=new DataView(t,u,Math.min(10,M));var k={};a.pixels.blocks[A++]=k;var m=r.getUint8(0);if(w++,k.encoding=m&63,k.encoding>3)throw"Invalid block encoding ("+k.encoding+")";if(k.encoding===2){u++;continue}if(m!==0&&m!==2){if(m>>=6,k.offsetType=m,m===2)k.offset=r.getInt8(1),w++;else if(m===1)k.offset=r.getInt16(1,!0),w+=2;else if(m===0)k.offset=r.getFloat32(1,!0),w+=4;else throw"Invalid block offset type";if(k.encoding===1)if(m=r.getUint8(w),w++,k.bitsPerPixel=m&63,m>>=6,k.numValidPixelsType=m,m===2)k.numValidPixels=r.getUint8(w),w++;else if(m===1)k.numValidPixels=r.getUint16(w,!0),w+=2;else if(m===0)k.numValidPixels=r.getUint32(w,!0),w+=4;else throw"Invalid valid pixel count type"}if(u+=w,k.encoding!==3){var v,b;if(k.encoding===0){var U=(a.pixels.numBytes-1)/4;if(U!==Math.floor(U))throw"uncompressed block has invalid length";v=new ArrayBuffer(U*4),b=new Uint8Array(v),b.set(new Uint8Array(t,u,U*4));var B=new Float32Array(v);k.rawData=B,u+=U*4}else if(k.encoding===1){var I=Math.ceil(k.numValidPixels*k.bitsPerPixel/8),P=Math.ceil(I/4);v=new ArrayBuffer(P*4),b=new Uint8Array(v),b.set(new Uint8Array(t,u,I)),k.stuffedData=new Uint32Array(v),u+=I}}}return a.eofOffset=u,a},e=function(t,u,i,a,d,r,n){var h=(1<<u)-1,o=0,c,g=0,f,l,p=Math.ceil((n-a)/d),y=t.length*4-Math.ceil(u*i/8);for(t[t.length-1]<<=8*y,c=0;c<i;c++){if(g===0&&(l=t[o++],g=32),g>=u)f=l>>>g-u&h,g-=u;else{var A=u-g;f=(l&h)<<A&h,l=t[o++],g=32-A,f+=l>>>g}r[c]=f<p?a+f*d:n}return r};return S}(),te=function(){var S={unstuff:function(s,e,t,u,i,a,d,r){var n=(1<<t)-1,h=0,o,c=0,g,f,l,p,y=s.length*4-Math.ceil(t*u/8);if(s[s.length-1]<<=8*y,i)for(o=0;o<u;o++)c===0&&(f=s[h++],c=32),c>=t?(g=f>>>c-t&n,c-=t):(l=t-c,g=(f&n)<<l&n,f=s[h++],c=32-l,g+=f>>>c),e[o]=i[g];else for(p=Math.ceil((r-a)/d),o=0;o<u;o++)c===0&&(f=s[h++],c=32),c>=t?(g=f>>>c-t&n,c-=t):(l=t-c,g=(f&n)<<l&n,f=s[h++],c=32-l,g+=f>>>c),e[o]=g<p?a+g*d:r},unstuffLUT:function(s,e,t,u,i,a){var d=(1<<e)-1,r=0,n=0,h=0,o=0,c=0,g,f=[],l=s.length*4-Math.ceil(e*t/8);s[s.length-1]<<=8*l;var p=Math.ceil((a-u)/i);for(n=0;n<t;n++)o===0&&(g=s[r++],o=32),o>=e?(c=g>>>o-e&d,o-=e):(h=e-o,c=(g&d)<<h&d,g=s[r++],o=32-h,c+=g>>>o),f[n]=c<p?u+c*i:a;return f.unshift(u),f},unstuff2:function(s,e,t,u,i,a,d,r){var n=(1<<t)-1,h=0,o,c=0,g=0,f,l,p;if(i)for(o=0;o<u;o++)c===0&&(l=s[h++],c=32,g=0),c>=t?(f=l>>>g&n,c-=t,g+=t):(p=t-c,f=l>>>g&n,l=s[h++],c=32-p,f|=(l&(1<<p)-1)<<t-p,g=p),e[o]=i[f];else{var y=Math.ceil((r-a)/d);for(o=0;o<u;o++)c===0&&(l=s[h++],c=32,g=0),c>=t?(f=l>>>g&n,c-=t,g+=t):(p=t-c,f=l>>>g&n,l=s[h++],c=32-p,f|=(l&(1<<p)-1)<<t-p,g=p),e[o]=f<y?a+f*d:r}return e},unstuffLUT2:function(s,e,t,u,i,a){var d=(1<<e)-1,r=0,n=0,h=0,o=0,c=0,g=0,f,l=[],p=Math.ceil((a-u)/i);for(n=0;n<t;n++)o===0&&(f=s[r++],o=32,g=0),o>=e?(c=f>>>g&d,o-=e,g+=e):(h=e-o,c=f>>>g&d,f=s[r++],o=32-h,c|=(f&(1<<h)-1)<<e-h,g=h),l[n]=c<p?u+c*i:a;return l.unshift(u),l},originalUnstuff:function(s,e,t,u){var i=(1<<t)-1,a=0,d,r=0,n,h,o,c=s.length*4-Math.ceil(t*u/8);for(s[s.length-1]<<=8*c,d=0;d<u;d++)r===0&&(h=s[a++],r=32),r>=t?(n=h>>>r-t&i,r-=t):(o=t-r,n=(h&i)<<o&i,h=s[a++],r=32-o,n+=h>>>r),e[d]=n;return e},originalUnstuff2:function(s,e,t,u){var i=(1<<t)-1,a=0,d,r=0,n=0,h,o,c;for(d=0;d<u;d++)r===0&&(o=s[a++],r=32,n=0),r>=t?(h=o>>>n&i,r-=t,n+=t):(c=t-r,h=o>>>n&i,o=s[a++],r=32-c,h|=(o&(1<<c)-1)<<t-c,n=c),e[d]=h;return e}},D={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(s){for(var e=65535,t=65535,u=s.length,i=Math.floor(u/2),a=0;i;){var d=i>=359?359:i;i-=d;do e+=s[a++]<<8,t+=e+=s[a++];while(--d);e=(e&65535)+(e>>>16),t=(t&65535)+(t>>>16)}return u&1&&(t+=e+=s[a]<<8),e=(e&65535)+(e>>>16),t=(t&65535)+(t>>>16),(t<<16|e)>>>0},readHeaderInfo:function(s,e){var t=e.ptr,u=new Uint8Array(s,t,6),i={};if(i.fileIdentifierString=String.fromCharCode.apply(null,u),i.fileIdentifierString.lastIndexOf("Lerc2",0)!==0)throw"Unexpected file identifier string (expect Lerc2 ): "+i.fileIdentifierString;t+=6;var a=new DataView(s,t,8),d=a.getInt32(0,!0);i.fileVersion=d,t+=4,d>=3&&(i.checksum=a.getUint32(4,!0),t+=4),a=new DataView(s,t,12),i.height=a.getUint32(0,!0),i.width=a.getUint32(4,!0),t+=8,d>=4?(i.numDims=a.getUint32(8,!0),t+=4):i.numDims=1,a=new DataView(s,t,40),i.numValidPixel=a.getUint32(0,!0),i.microBlockSize=a.getInt32(4,!0),i.blobSize=a.getInt32(8,!0),i.imageType=a.getInt32(12,!0),i.maxZError=a.getFloat64(16,!0),i.zMin=a.getFloat64(24,!0),i.zMax=a.getFloat64(32,!0),t+=40,e.headerInfo=i,e.ptr=t;var r,n;if(d>=3&&(n=d>=4?52:48,r=this.computeChecksumFletcher32(new Uint8Array(s,t-n,i.blobSize-14)),r!==i.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(s,e){var t=e.headerInfo,u=this.getDataTypeArray(t.imageType),i=t.numDims*this.getDataTypeSize(t.imageType),a=this.readSubArray(s,e.ptr,u,i),d=this.readSubArray(s,e.ptr+i,u,i);e.ptr+=2*i;var r,n=!0;for(r=0;r<t.numDims;r++)if(a[r]!==d[r]){n=!1;break}return t.minValues=a,t.maxValues=d,n},readSubArray:function(s,e,t,u){var i;if(t===Uint8Array)i=new Uint8Array(s,e,u);else{var a=new ArrayBuffer(u),d=new Uint8Array(a);d.set(new Uint8Array(s,e,u)),i=new t(a)}return i},readMask:function(s,e){var t=e.ptr,u=e.headerInfo,i=u.width*u.height,a=u.numValidPixel,d=new DataView(s,t,4),r={};if(r.numBytes=d.getUint32(0,!0),t+=4,(a===0||i===a)&&r.numBytes!==0)throw"invalid mask";var n,h;if(a===0)n=new Uint8Array(Math.ceil(i/8)),r.bitset=n,h=new Uint8Array(i),e.pixels.resultMask=h,t+=r.numBytes;else if(r.numBytes>0){n=new Uint8Array(Math.ceil(i/8)),d=new DataView(s,t,r.numBytes);var o=d.getInt16(0,!0),c=2,g=0,f=0;do{if(o>0)for(;o--;)n[g++]=d.getUint8(c++);else for(f=d.getUint8(c++),o=-o;o--;)n[g++]=f;o=d.getInt16(c,!0),c+=2}while(c<r.numBytes);if(o!==-32768||g<n.length)throw"Unexpected end of mask RLE encoding";h=new Uint8Array(i);var l=0,p=0;for(p=0;p<i;p++)p&7?(l=n[p>>3],l<<=p&7):l=n[p>>3],l&128&&(h[p]=1);e.pixels.resultMask=h,r.bitset=n,t+=r.numBytes}return e.ptr=t,e.mask=r,!0},readDataOneSweep:function(s,e,t,u){var i=e.ptr,a=e.headerInfo,d=a.numDims,r=a.width*a.height,n=a.imageType,h=a.numValidPixel*D.getDataTypeSize(n)*d,o,c=e.pixels.resultMask;if(t===Uint8Array)o=new Uint8Array(s,i,h);else{var g=new ArrayBuffer(h),f=new Uint8Array(g);f.set(new Uint8Array(s,i,h)),o=new t(g)}if(o.length===r*d)u?e.pixels.resultPixels=D.swapDimensionOrder(o,r,d,t,!0):e.pixels.resultPixels=o;else{e.pixels.resultPixels=new t(r*d);var l=0,p=0,y=0,A=0;if(d>1){if(u){for(p=0;p<r;p++)if(c[p])for(A=p,y=0;y<d;y++,A+=r)e.pixels.resultPixels[A]=o[l++]}else for(p=0;p<r;p++)if(c[p])for(A=p*d,y=0;y<d;y++)e.pixels.resultPixels[A+y]=o[l++]}else for(p=0;p<r;p++)c[p]&&(e.pixels.resultPixels[p]=o[l++])}return i+=h,e.ptr=i,!0},readHuffmanTree:function(s,e){var t=this.HUFFMAN_LUT_BITS_MAX,u=new DataView(s,e.ptr,16);e.ptr+=16;var i=u.getInt32(0,!0);if(i<2)throw"unsupported Huffman version";var a=u.getInt32(4,!0),d=u.getInt32(8,!0),r=u.getInt32(12,!0);if(d>=r)return!1;var n=new Uint32Array(r-d);D.decodeBits(s,e,n);var h=[],o,c,g,f;for(o=d;o<r;o++)c=o-(o<a?0:a),h[c]={first:n[o-d],second:null};var l=s.byteLength-e.ptr,p=Math.ceil(l/4),y=new ArrayBuffer(p*4),A=new Uint8Array(y);A.set(new Uint8Array(s,e.ptr,l));var x=new Uint32Array(y),V=0,w,M=0;for(w=x[0],o=d;o<r;o++)c=o-(o<a?0:a),f=h[c].first,f>0&&(h[c].second=w<<V>>>32-f,32-V>=f?(V+=f,V===32&&(V=0,M++,w=x[M])):(V+=f-32,M++,w=x[M],h[c].second|=w>>>32-V));var k=0,m=0,v=new F;for(o=0;o<h.length;o++)h[o]!==void 0&&(k=Math.max(k,h[o].first));k>=t?m=t:m=k;var b=[],U,B,I,P,T,z;for(o=d;o<r;o++)if(c=o-(o<a?0:a),f=h[c].first,f>0)if(U=[f,c],f<=m)for(B=h[c].second<<m-f,I=1<<m-f,g=0;g<I;g++)b[B|g]=U;else for(B=h[c].second,z=v,P=f-1;P>=0;P--)T=B>>>P&1,T?(z.right||(z.right=new F),z=z.right):(z.left||(z.left=new F),z=z.left),P===0&&!z.val&&(z.val=U[1]);return{decodeLut:b,numBitsLUTQick:m,numBitsLUT:k,tree:v,stuffedData:x,srcPtr:M,bitPos:V}},readHuffman:function(s,e,t,u){var i=e.headerInfo,a=i.numDims,d=e.headerInfo.height,r=e.headerInfo.width,n=r*d,h=this.readHuffmanTree(s,e),o=h.decodeLut,c=h.tree,g=h.stuffedData,f=h.srcPtr,l=h.bitPos,p=h.numBitsLUTQick,y=h.numBitsLUT,A=e.headerInfo.imageType===0?128:0,x,V,w,M=e.pixels.resultMask,k,m,v,b,U,B,I,P=0;l>0&&(f++,l=0);var T=g[f],z=e.encodeMode===1,R=new t(n*a),O=R,C;if(a<2||z){for(C=0;C<a;C++)if(a>1&&(O=new t(R.buffer,n*C,n),P=0),e.headerInfo.numValidPixel===r*d)for(B=0,b=0;b<d;b++)for(U=0;U<r;U++,B++){if(V=0,k=T<<l>>>32-p,m=k,32-l<p&&(k|=g[f+1]>>>64-l-p,m=k),o[m])V=o[m][1],l+=o[m][0];else for(k=T<<l>>>32-y,m=k,32-l<y&&(k|=g[f+1]>>>64-l-y,m=k),x=c,I=0;I<y;I++)if(v=k>>>y-I-1&1,x=v?x.right:x.left,!(x.left||x.right)){V=x.val,l=l+I+1;break}l>=32&&(l-=32,f++,T=g[f]),w=V-A,z?(U>0?w+=P:b>0?w+=O[B-r]:w+=P,w&=255,O[B]=w,P=w):O[B]=w}else for(B=0,b=0;b<d;b++)for(U=0;U<r;U++,B++)if(M[B]){if(V=0,k=T<<l>>>32-p,m=k,32-l<p&&(k|=g[f+1]>>>64-l-p,m=k),o[m])V=o[m][1],l+=o[m][0];else for(k=T<<l>>>32-y,m=k,32-l<y&&(k|=g[f+1]>>>64-l-y,m=k),x=c,I=0;I<y;I++)if(v=k>>>y-I-1&1,x=v?x.right:x.left,!(x.left||x.right)){V=x.val,l=l+I+1;break}l>=32&&(l-=32,f++,T=g[f]),w=V-A,z?(U>0&&M[B-1]?w+=P:b>0&&M[B-r]?w+=O[B-r]:w+=P,w&=255,O[B]=w,P=w):O[B]=w}}else for(B=0,b=0;b<d;b++)for(U=0;U<r;U++)if(B=b*r+U,!M||M[B])for(C=0;C<a;C++,B+=n){if(V=0,k=T<<l>>>32-p,m=k,32-l<p&&(k|=g[f+1]>>>64-l-p,m=k),o[m])V=o[m][1],l+=o[m][0];else for(k=T<<l>>>32-y,m=k,32-l<y&&(k|=g[f+1]>>>64-l-y,m=k),x=c,I=0;I<y;I++)if(v=k>>>y-I-1&1,x=v?x.right:x.left,!(x.left||x.right)){V=x.val,l=l+I+1;break}l>=32&&(l-=32,f++,T=g[f]),w=V-A,O[B]=w}e.ptr=e.ptr+(f+1)*4+(l>0?4:0),e.pixels.resultPixels=R,a>1&&!u&&(e.pixels.resultPixels=D.swapDimensionOrder(R,n,a,t))},decodeBits:function(s,e,t,u,i){{var a=e.headerInfo,d=a.fileVersion,r=0,n=s.byteLength-e.ptr>=5?5:s.byteLength-e.ptr,h=new DataView(s,e.ptr,n),o=h.getUint8(0);r++;var c=o>>6,g=c===0?4:3-c,f=(o&32)>0,l=o&31,p=0;if(g===1)p=h.getUint8(r),r++;else if(g===2)p=h.getUint16(r,!0),r+=2;else if(g===4)p=h.getUint32(r,!0),r+=4;else throw"Invalid valid pixel count type";var y=2*a.maxZError,A,x,V,w,M,k,m,v,b,U=a.numDims>1?a.maxValues[i]:a.zMax;if(f){for(e.counter.lut++,v=h.getUint8(r),r++,w=Math.ceil((v-1)*l/8),M=Math.ceil(w/4),x=new ArrayBuffer(M*4),V=new Uint8Array(x),e.ptr+=r,V.set(new Uint8Array(s,e.ptr,w)),m=new Uint32Array(x),e.ptr+=w,b=0;v-1>>>b;)b++;w=Math.ceil(p*b/8),M=Math.ceil(w/4),x=new ArrayBuffer(M*4),V=new Uint8Array(x),V.set(new Uint8Array(s,e.ptr,w)),A=new Uint32Array(x),e.ptr+=w,d>=3?k=S.unstuffLUT2(m,l,v-1,u,y,U):k=S.unstuffLUT(m,l,v-1,u,y,U),d>=3?S.unstuff2(A,t,b,p,k):S.unstuff(A,t,b,p,k)}else e.counter.bitstuffer++,b=l,e.ptr+=r,b>0&&(w=Math.ceil(p*b/8),M=Math.ceil(w/4),x=new ArrayBuffer(M*4),V=new Uint8Array(x),V.set(new Uint8Array(s,e.ptr,w)),A=new Uint32Array(x),e.ptr+=w,d>=3?u==null?S.originalUnstuff2(A,t,b,p):S.unstuff2(A,t,b,p,!1,u,y,U):u==null?S.originalUnstuff(A,t,b,p):S.unstuff(A,t,b,p,!1,u,y,U))}},readTiles:function(s,e,t,u){var i=e.headerInfo,a=i.width,d=i.height,r=a*d,n=i.microBlockSize,h=i.imageType,o=D.getDataTypeSize(h),c=Math.ceil(a/n),g=Math.ceil(d/n);e.pixels.numBlocksY=g,e.pixels.numBlocksX=c,e.pixels.ptr=0;var f=0,l=0,p=0,y=0,A=0,x=0,V=0,w=0,M=0,k=0,m=0,v=0,b=0,U=0,B=0,I=0,P,T,z,R,O,C,Q=new t(n*n),re=d%n||n,ie=a%n||n,W,_,j=i.numDims,Y,E=e.pixels.resultMask,L=e.pixels.resultPixels,ne=i.fileVersion,K=ne>=5?14:15,H,q=i.zMax,Z;for(p=0;p<g;p++)for(A=p!==g-1?n:re,y=0;y<c;y++)for(x=y!==c-1?n:ie,m=p*a*n+y*n,v=a-x,Y=0;Y<j;Y++){if(j>1?(Z=L,m=p*a*n+y*n,L=new t(e.pixels.resultPixels.buffer,r*Y*o,r),q=i.maxValues[Y]):Z=null,V=s.byteLength-e.ptr,P=new DataView(s,e.ptr,Math.min(10,V)),T={},I=0,w=P.getUint8(0),I++,H=i.fileVersion>=5?w&4:0,M=w>>6&255,k=w>>2&K,k!==(y*n>>3&K)||H&&Y===0)throw"integrity issue";if(C=w&3,C>3)throw e.ptr+=I,"Invalid block encoding ("+C+")";if(C===2){if(H)if(E)for(f=0;f<A;f++)for(l=0;l<x;l++)E[m]&&(L[m]=Z[m]),m++;else for(f=0;f<A;f++)for(l=0;l<x;l++)L[m]=Z[m],m++;e.counter.constant++,e.ptr+=I;continue}else if(C===0){if(H)throw"integrity issue";if(e.counter.uncompressed++,e.ptr+=I,b=A*x*o,U=s.byteLength-e.ptr,b=b<U?b:U,z=new ArrayBuffer(b%o===0?b:b+o-b%o),R=new Uint8Array(z),R.set(new Uint8Array(s,e.ptr,b)),O=new t(z),B=0,E)for(f=0;f<A;f++){for(l=0;l<x;l++)E[m]&&(L[m]=O[B++]),m++;m+=v}else for(f=0;f<A;f++){for(l=0;l<x;l++)L[m++]=O[B++];m+=v}e.ptr+=B*o}else if(W=D.getDataTypeUsed(H&&h<6?4:h,M),_=D.getOnePixel(T,I,W,P),I+=D.getDataTypeSize(W),C===3)if(e.ptr+=I,e.counter.constantoffset++,E)for(f=0;f<A;f++){for(l=0;l<x;l++)E[m]&&(L[m]=H?Math.min(q,Z[m]+_):_),m++;m+=v}else for(f=0;f<A;f++){for(l=0;l<x;l++)L[m]=H?Math.min(q,Z[m]+_):_,m++;m+=v}else if(e.ptr+=I,D.decodeBits(s,e,Q,_,Y),I=0,H)if(E)for(f=0;f<A;f++){for(l=0;l<x;l++)E[m]&&(L[m]=Q[I++]+Z[m]),m++;m+=v}else for(f=0;f<A;f++){for(l=0;l<x;l++)L[m]=Q[I++]+Z[m],m++;m+=v}else if(E)for(f=0;f<A;f++){for(l=0;l<x;l++)E[m]&&(L[m]=Q[I++]),m++;m+=v}else for(f=0;f<A;f++){for(l=0;l<x;l++)L[m++]=Q[I++];m+=v}}j>1&&!u&&(e.pixels.resultPixels=D.swapDimensionOrder(e.pixels.resultPixels,r,j,t))},formatFileInfo:function(s){return{fileIdentifierString:s.headerInfo.fileIdentifierString,fileVersion:s.headerInfo.fileVersion,imageType:s.headerInfo.imageType,height:s.headerInfo.height,width:s.headerInfo.width,numValidPixel:s.headerInfo.numValidPixel,microBlockSize:s.headerInfo.microBlockSize,blobSize:s.headerInfo.blobSize,maxZError:s.headerInfo.maxZError,pixelType:D.getPixelType(s.headerInfo.imageType),eofOffset:s.eofOffset,mask:s.mask?{numBytes:s.mask.numBytes}:null,pixels:{numBlocksX:s.pixels.numBlocksX,numBlocksY:s.pixels.numBlocksY,maxValue:s.headerInfo.zMax,minValue:s.headerInfo.zMin,noDataValue:s.noDataValue}}},constructConstantSurface:function(s,e){var t=s.headerInfo.zMax,u=s.headerInfo.zMin,i=s.headerInfo.maxValues,a=s.headerInfo.numDims,d=s.headerInfo.height*s.headerInfo.width,r=0,n=0,h=0,o=s.pixels.resultMask,c=s.pixels.resultPixels;if(o)if(a>1){if(e)for(r=0;r<a;r++)for(h=r*d,t=i[r],n=0;n<d;n++)o[n]&&(c[h+n]=t);else for(n=0;n<d;n++)if(o[n])for(h=n*a,r=0;r<a;r++)c[h+a]=i[r]}else for(n=0;n<d;n++)o[n]&&(c[n]=t);else if(a>1&&u!==t)if(e)for(r=0;r<a;r++)for(h=r*d,t=i[r],n=0;n<d;n++)c[h+n]=t;else for(n=0;n<d;n++)for(h=n*a,r=0;r<a;r++)c[h+r]=i[r];else for(n=0;n<d*a;n++)c[n]=t},getDataTypeArray:function(s){var e;switch(s){case 0:e=Int8Array;break;case 1:e=Uint8Array;break;case 2:e=Int16Array;break;case 3:e=Uint16Array;break;case 4:e=Int32Array;break;case 5:e=Uint32Array;break;case 6:e=Float32Array;break;case 7:e=Float64Array;break;default:e=Float32Array}return e},getPixelType:function(s){var e;switch(s){case 0:e="S8";break;case 1:e="U8";break;case 2:e="S16";break;case 3:e="U16";break;case 4:e="S32";break;case 5:e="U32";break;case 6:e="F32";break;case 7:e="F64";break;default:e="F32"}return e},isValidPixelValue:function(s,e){if(e==null)return!1;var t;switch(s){case 0:t=e>=-128&&e<=127;break;case 1:t=e>=0&&e<=255;break;case 2:t=e>=-32768&&e<=32767;break;case 3:t=e>=0&&e<=65536;break;case 4:t=e>=-2147483648&&e<=2147483647;break;case 5:t=e>=0&&e<=4294967296;break;case 6:t=e>=-34027999387901484e22&&e<=34027999387901484e22;break;case 7:t=e>=-17976931348623157e292&&e<=17976931348623157e292;break;default:t=!1}return t},getDataTypeSize:function(s){var e=0;switch(s){case 0:case 1:e=1;break;case 2:case 3:e=2;break;case 4:case 5:case 6:e=4;break;case 7:e=8;break;default:e=s}return e},getDataTypeUsed:function(s,e){var t=s;switch(s){case 2:case 4:t=s-e;break;case 3:case 5:t=s-2*e;break;case 6:e===0?t=s:e===1?t=2:t=1;break;case 7:e===0?t=s:t=s-2*e+1;break;default:t=s;break}return t},getOnePixel:function(s,e,t,u){var i=0;switch(t){case 0:i=u.getInt8(e);break;case 1:i=u.getUint8(e);break;case 2:i=u.getInt16(e,!0);break;case 3:i=u.getUint16(e,!0);break;case 4:i=u.getInt32(e,!0);break;case 5:i=u.getUInt32(e,!0);break;case 6:i=u.getFloat32(e,!0);break;case 7:i=u.getFloat64(e,!0);break;default:throw"the decoder does not understand this pixel type"}return i},swapDimensionOrder:function(s,e,t,u,i){var a=0,d=0,r=0,n=0,h=s;if(t>1)if(h=new u(e*t),i)for(a=0;a<e;a++)for(n=a,r=0;r<t;r++,n+=e)h[n]=s[d++];else for(a=0;a<e;a++)for(n=a,r=0;r<t;r++,n+=e)h[d++]=s[n];return h}},F=function(s,e,t){this.val=s,this.left=e,this.right=t},N={decode:function(s,e){e=e||{};var t=e.noDataValue,u=0,i={};if(i.ptr=e.inputOffset||0,i.pixels={},!!D.readHeaderInfo(s,i)){var a=i.headerInfo,d=a.fileVersion,r=D.getDataTypeArray(a.imageType);if(d>5)throw"unsupported lerc version 2."+d;D.readMask(s,i),a.numValidPixel!==a.width*a.height&&!i.pixels.resultMask&&(i.pixels.resultMask=e.maskData);var n=a.width*a.height;i.pixels.resultPixels=new r(n*a.numDims),i.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var h=!e.returnPixelInterleavedDims;if(a.numValidPixel!==0)if(a.zMax===a.zMin)D.constructConstantSurface(i,h);else if(d>=4&&D.checkMinMaxRanges(s,i))D.constructConstantSurface(i,h);else{var o=new DataView(s,i.ptr,2),c=o.getUint8(0);if(i.ptr++,c)D.readDataOneSweep(s,i,r,h);else if(d>1&&a.imageType<=1&&Math.abs(a.maxZError-.5)<1e-5){var g=o.getUint8(1);if(i.ptr++,i.encodeMode=g,g>2||d<4&&g>1)throw"Invalid Huffman flag "+g;g?D.readHuffman(s,i,r,h):D.readTiles(s,i,r,h)}else D.readTiles(s,i,r,h)}i.eofOffset=i.ptr;var f;e.inputOffset?(f=i.headerInfo.blobSize+e.inputOffset-i.ptr,Math.abs(f)>=1&&(i.eofOffset=e.inputOffset+i.headerInfo.blobSize)):(f=i.headerInfo.blobSize-i.ptr,Math.abs(f)>=1&&(i.eofOffset=i.headerInfo.blobSize));var l={width:a.width,height:a.height,pixelData:i.pixels.resultPixels,minValue:a.zMin,maxValue:a.zMax,validPixelCount:a.numValidPixel,dimCount:a.numDims,dimStats:{minValues:a.minValues,maxValues:a.maxValues},maskData:i.pixels.resultMask};if(i.pixels.resultMask&&D.isValidPixelValue(a.imageType,t)){var p=i.pixels.resultMask;for(u=0;u<n;u++)p[u]||(l.pixelData[u]=t);l.noDataValue=t}return i.noDataValue=t,e.returnFileInfo&&(l.fileInfo=D.formatFileInfo(i)),l}},getBandCount:function(s){var e=0,t=0,u={};for(u.ptr=0,u.pixels={};t<s.byteLength-58;)D.readHeaderInfo(s,u),t+=u.headerInfo.blobSize,e++,u.ptr=t;return e}};return N}(),ae=function(){var S=new ArrayBuffer(4),D=new Uint8Array(S),F=new Uint32Array(S);return F[0]=1,D[0]===1}(),J={decode:function(S,D){if(!ae)throw"Big endian system is not supported.";D=D||{};var F=D.inputOffset||0,N=new Uint8Array(S,F,10),s=String.fromCharCode.apply(null,N),e,t;if(s.trim()==="CntZImage")e=X,t=1;else if(s.substring(0,5)==="Lerc2")e=te,t=2;else throw"Unexpected file identifier string: "+s;for(var u=0,i=S.byteLength-10,a,d=[],r,n,h={width:0,height:0,pixels:[],pixelType:D.pixelType,mask:null,statistics:[]},o=0;F<i;){var c=e.decode(S,{inputOffset:F,encodedMaskData:a,maskData:n,returnMask:u===0,returnEncodedMask:u===0,returnFileInfo:!0,returnPixelInterleavedDims:D.returnPixelInterleavedDims,pixelType:D.pixelType||null,noDataValue:D.noDataValue||null});F=c.fileInfo.eofOffset,n=c.maskData,u===0&&(a=c.encodedMaskData,h.width=c.width,h.height=c.height,h.dimCount=c.dimCount||1,h.pixelType=c.pixelType||c.fileInfo.pixelType,h.mask=n),t>1&&(n&&d.push(n),c.fileInfo.mask&&c.fileInfo.mask.numBytes>0&&o++),u++,h.pixels.push(c.pixelData),h.statistics.push({minValue:c.minValue,maxValue:c.maxValue,noDataValue:c.noDataValue,dimStats:c.dimStats})}var g,f,l;if(t>1&&o>1){for(l=h.width*h.height,h.bandMasks=d,n=new Uint8Array(l),n.set(d[0]),g=1;g<d.length;g++)for(r=d[g],f=0;f<l;f++)n[f]=n[f]&r[f];h.maskData=n}return h}};G.exports?G.exports=J:this.Lerc=J})()})(ee);var oe=ee.exports;const he=ue(oe);class me extends le{constructor(X){super(),this.planarConfiguration=typeof X.PlanarConfiguration<"u"?X.PlanarConfiguration:1,this.samplesPerPixel=typeof X.SamplesPerPixel<"u"?X.SamplesPerPixel:1,this.addCompression=X.LercParameters[fe.AddCompression]}decodeBlock(X){switch(this.addCompression){case $.None:break;case $.Deflate:X=se(new Uint8Array(X)).buffer;break;default:throw new Error(`Unsupported LERC additional compression method identifier: ${this.addCompression}`)}return he.decode(X,{returnPixelInterleavedDims:this.planarConfiguration===1}).pixels[0].buffer}}export{me as default};
