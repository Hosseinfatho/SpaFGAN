const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/troika-three-text.esm-4798f478-BteEwe1Y.js","assets/index-CFpbgV4B.js","assets/index-LH_qcHwl.css"])))=>i.map(i=>d[i]);
import{r as z,K as ne,N as go,g as Hn,u as or,H as ll,e as Sn,D as ar,a as Il,b as Rd,U as qr,i as V,G as Id,o as zd,c as Gr,L as Yr,d as Is,f as Np,h as jp,j as Bp,l as Op,k as Dp,E as Je,n as Dt,m as be,A as zl,q as Vn,Z as Up,p as Pr,W as Mr,s as Cc,t as po,w as Fp,O as Hp,y as Vp,F as Gp,z as Yp,B as Kp,C as ho,I as Qe,J as Zr,M as Da,$ as xn,P as kd,V as kl,R as zs,S as ul,T as Wp,X as Qp,Y as uo,_ as qp,a0 as Xp,a1 as Zp,a2 as sr,a3 as Nd,a4 as cl,a5 as ir,a6 as $p,a7 as dl,a8 as jd,a9 as Rc,aa as Jp,ab as Ic,ac as eh,ad as Na,ae as th,af as nh,ag as rh,ah,ai as Nl,aj as ih,ak as oh,al as sh,am as Bd,an as lh,ao as uh,ap as ch,aq as dh,ar as fl,as as fh,at as ph,au as hh,av as mh,aw as Od,ax as gh,ay as vh,az as yh,aA as bh,aB as xh,aC as wh,aD as Dd,aE as Sh,aF as _h,aG as Ud,aH as Eh,aI as Ah,aJ as dn,aK as Th,aL as zc,aM as Ph,aN as Mh,aO as pl,aP as Fd,aQ as Lh,aR as za,aS as Ch,aT as Rh,aU as Ih,aV as zh}from"./index-CFpbgV4B.js";var Hd={exports:{}},cr={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */cr.ConcurrentRoot=1;cr.ContinuousEventPriority=4;cr.DefaultEventPriority=16;cr.DiscreteEventPriority=1;cr.IdleEventPriority=536870912;cr.LegacyRoot=0;Hd.exports=cr;var Kr=Hd.exports,Vd={exports:{}},Gd={exports:{}},Yd={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(a){function r(G,ee){var Z=G.length;G.push(ee);e:for(;0<Z;){var ie=Z-1>>>1,pe=G[ie];if(0<o(pe,ee))G[ie]=ee,G[Z]=pe,Z=ie;else break e}}function n(G){return G.length===0?null:G[0]}function l(G){if(G.length===0)return null;var ee=G[0],Z=G.pop();if(Z!==ee){G[0]=Z;e:for(var ie=0,pe=G.length,Te=pe>>>1;ie<Te;){var ze=2*(ie+1)-1,St=G[ze],dt=ze+1,Kt=G[dt];if(0>o(St,Z))dt<pe&&0>o(Kt,St)?(G[ie]=Kt,G[dt]=Z,ie=dt):(G[ie]=St,G[ze]=Z,ie=ze);else if(dt<pe&&0>o(Kt,Z))G[ie]=Kt,G[dt]=Z,ie=dt;else break e}}return ee}function o(G,ee){var Z=G.sortIndex-ee.sortIndex;return Z!==0?Z:G.id-ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;a.unstable_now=function(){return s.now()}}else{var u=Date,f=u.now();a.unstable_now=function(){return u.now()-f}}var d=[],p=[],m=1,g=null,v=3,b=!1,A=!1,_=!1,w=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(G){for(var ee=n(p);ee!==null;){if(ee.callback===null)l(p);else if(ee.startTime<=G)l(p),ee.sortIndex=ee.expirationTime,r(d,ee);else break;ee=n(p)}}function P(G){if(_=!1,E(G),!A)if(n(d)!==null)A=!0,fe(M);else{var ee=n(p);ee!==null&&ve(P,ee.startTime-G)}}function M(G,ee){A=!1,_&&(_=!1,x(N),N=-1),b=!0;var Z=v;try{for(E(ee),g=n(d);g!==null&&(!(g.expirationTime>ee)||G&&!B());){var ie=g.callback;if(typeof ie=="function"){g.callback=null,v=g.priorityLevel;var pe=ie(g.expirationTime<=ee);ee=a.unstable_now(),typeof pe=="function"?g.callback=pe:g===n(d)&&l(d),E(ee)}else l(d);g=n(d)}if(g!==null)var Te=!0;else{var ze=n(p);ze!==null&&ve(P,ze.startTime-ee),Te=!1}return Te}finally{g=null,v=Z,b=!1}}var R=!1,L=null,N=-1,C=5,O=-1;function B(){return!(a.unstable_now()-O<C)}function F(){if(L!==null){var G=a.unstable_now();O=G;var ee=!0;try{ee=L(!0,G)}finally{ee?K():(R=!1,L=null)}}else R=!1}var K;if(typeof S=="function")K=function(){S(F)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,le=$.port2;$.port1.onmessage=F,K=function(){le.postMessage(null)}}else K=function(){w(F,0)};function fe(G){L=G,R||(R=!0,K())}function ve(G,ee){N=w(function(){G(a.unstable_now())},ee)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(G){G.callback=null},a.unstable_continueExecution=function(){A||b||(A=!0,fe(M))},a.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<G?Math.floor(1e3/G):5},a.unstable_getCurrentPriorityLevel=function(){return v},a.unstable_getFirstCallbackNode=function(){return n(d)},a.unstable_next=function(G){switch(v){case 1:case 2:case 3:var ee=3;break;default:ee=v}var Z=v;v=ee;try{return G()}finally{v=Z}},a.unstable_pauseExecution=function(){},a.unstable_requestPaint=function(){},a.unstable_runWithPriority=function(G,ee){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var Z=v;v=G;try{return ee()}finally{v=Z}},a.unstable_scheduleCallback=function(G,ee,Z){var ie=a.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?ie+Z:ie):Z=ie,G){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=Z+pe,G={id:m++,callback:ee,priorityLevel:G,startTime:Z,expirationTime:pe,sortIndex:-1},Z>ie?(G.sortIndex=Z,r(p,G),n(d)===null&&G===n(p)&&(_?(x(N),N=-1):_=!0,ve(P,Z-ie))):(G.sortIndex=pe,r(d,G),A||b||(A=!0,fe(M))),G},a.unstable_shouldYield=B,a.unstable_wrapCallback=function(G){var ee=v;return function(){var Z=v;v=ee;try{return G.apply(this,arguments)}finally{v=Z}}}})(Yd);Gd.exports=Yd;var hl=Gd.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kh=function(a){var r={},n=Ih,l=hl,o=Object.assign;function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var u=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,f=Symbol.for("react.element"),d=Symbol.for("react.portal"),p=Symbol.for("react.fragment"),m=Symbol.for("react.strict_mode"),g=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),b=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),_=Symbol.for("react.suspense"),w=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),S=Symbol.for("react.lazy"),E=Symbol.for("react.offscreen"),P=Symbol.iterator;function M(e){return e===null||typeof e!="object"?null:(e=P&&e[P]||e["@@iterator"],typeof e=="function"?e:null)}function R(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case p:return"Fragment";case d:return"Portal";case g:return"Profiler";case m:return"StrictMode";case _:return"Suspense";case w:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case b:return(e.displayName||"Context")+".Consumer";case v:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case x:return t=e.displayName||null,t!==null?t:R(e.type)||"Memo";case S:t=e._payload,e=e._init;try{return R(e(t))}catch{}}return null}function L(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return R(t);case 8:return t===m?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function N(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(i=t.return),e=t.return;while(e)}return t.tag===3?i:null}function C(e){if(N(e)!==e)throw Error(s(188))}function O(e){var t=e.alternate;if(!t){if(t=N(e),t===null)throw Error(s(188));return t!==e?null:e}for(var i=e,c=t;;){var h=i.return;if(h===null)break;var y=h.alternate;if(y===null){if(c=h.return,c!==null){i=c;continue}break}if(h.child===y.child){for(y=h.child;y;){if(y===i)return C(h),e;if(y===c)return C(h),t;y=y.sibling}throw Error(s(188))}if(i.return!==c.return)i=h,c=y;else{for(var T=!1,I=h.child;I;){if(I===i){T=!0,i=h,c=y;break}if(I===c){T=!0,c=h,i=y;break}I=I.sibling}if(!T){for(I=y.child;I;){if(I===i){T=!0,i=y,c=h;break}if(I===c){T=!0,c=y,i=h;break}I=I.sibling}if(!T)throw Error(s(189))}}if(i.alternate!==c)throw Error(s(190))}if(i.tag!==3)throw Error(s(188));return i.stateNode.current===i?e:t}function B(e){return e=O(e),e!==null?F(e):null}function F(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=F(e);if(t!==null)return t;e=e.sibling}return null}function K(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){if(e.tag!==4){var t=K(e);if(t!==null)return t}e=e.sibling}return null}var $=Array.isArray,le=a.getPublicInstance,fe=a.getRootHostContext,ve=a.getChildHostContext,G=a.prepareForCommit,ee=a.resetAfterCommit,Z=a.createInstance,ie=a.appendInitialChild,pe=a.finalizeInitialChildren,Te=a.prepareUpdate,ze=a.shouldSetTextContent,St=a.createTextInstance,dt=a.scheduleTimeout,Kt=a.cancelTimeout,_n=a.noTimeout,fn=a.isPrimaryRenderer,me=a.supportsMutation,Y=a.supportsPersistence,te=a.supportsHydration,Me=a.getInstanceFromNode,he=a.preparePortalMount,Ge=a.getCurrentEventPriority,we=a.detachDeletedInstance,Le=a.supportsMicrotasks,je=a.scheduleMicrotask,et=a.supportsTestSelectors,Fa=a.findFiberRoot,Jr=a.getBoundingRect,ea=a.getTextContent,En=a.isHiddenSubtree,bo=a.matchAccessibilityRole,xo=a.setFocusIfFocusable,Ha=a.setupIntersectionObserver,ta=a.appendChild,wo=a.appendChildToContainer,So=a.commitTextUpdate,Va=a.commitMount,_o=a.commitUpdate,Ga=a.insertBefore,Ya=a.insertInContainerBefore,na=a.removeChild,j=a.removeChildFromContainer,Q=a.resetTextContent,se=a.hideInstance,Se=a.hideTextInstance,ft=a.unhideInstance,_t=a.unhideTextInstance,fr=a.clearContainer,Ka=a.cloneInstance,Lt=a.createContainerChildSet,Ct=a.appendChildToContainerChildSet,Yn=a.finalizeContainerChildren,An=a.replaceContainerChildren,Tn=a.cloneHiddenInstance,Kn=a.cloneHiddenTextInstance,Tf=a.canHydrateInstance,Pf=a.canHydrateTextInstance,Mf=a.canHydrateSuspenseInstance,Wl=a.isSuspenseInstancePending,Eo=a.isSuspenseInstanceFallback,Lf=a.registerSuspenseInstanceRetry,ra=a.getNextHydratableSibling,Cf=a.getFirstHydratableChild,Rf=a.getFirstHydratableChildWithinContainer,If=a.getFirstHydratableChildWithinSuspenseInstance,zf=a.hydrateInstance,kf=a.hydrateTextInstance,Nf=a.hydrateSuspenseInstance,jf=a.getNextHydratableInstanceAfterSuspenseInstance,Ql=a.commitHydratedContainer,Bf=a.commitHydratedSuspenseInstance,Of=a.clearSuspenseBoundary,Df=a.clearSuspenseBoundaryFromContainer,Uf=a.shouldDeleteUnhydratedTailInstances,Ff=a.didNotMatchHydratedContainerTextInstance,Hf=a.didNotMatchHydratedTextInstance,Ao;function aa(e){if(Ao===void 0)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);Ao=t&&t[1]||""}return`
`+Ao+e}var To=!1;function Po(e,t){if(!e||To)return"";To=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(W){var c=W}Reflect.construct(e,[],t)}else{try{t.call()}catch(W){c=W}e.call(t.prototype)}else{try{throw Error()}catch(W){c=W}e()}}catch(W){if(W&&c&&typeof W.stack=="string"){for(var h=W.stack.split(`
`),y=c.stack.split(`
`),T=h.length-1,I=y.length-1;1<=T&&0<=I&&h[T]!==y[I];)I--;for(;1<=T&&0<=I;T--,I--)if(h[T]!==y[I]){if(T!==1||I!==1)do if(T--,I--,0>I||h[T]!==y[I]){var H=`
`+h[T].replace(" at new "," at ");return e.displayName&&H.includes("<anonymous>")&&(H=H.replace("<anonymous>",e.displayName)),H}while(1<=T&&0<=I);break}}}finally{To=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?aa(e):""}var Vf=Object.prototype.hasOwnProperty,Mo=[],pr=-1;function Pn(e){return{current:e}}function Re(e){0>pr||(e.current=Mo[pr],Mo[pr]=null,pr--)}function Ce(e,t){pr++,Mo[pr]=e.current,e.current=t}var Mn={},it=Pn(Mn),gt=Pn(!1),Wn=Mn;function hr(e,t){var i=e.type.contextTypes;if(!i)return Mn;var c=e.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===t)return c.__reactInternalMemoizedMaskedChildContext;var h={},y;for(y in i)h[y]=t[y];return c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=h),h}function vt(e){return e=e.childContextTypes,e!=null}function Wa(){Re(gt),Re(it)}function ql(e,t,i){if(it.current!==Mn)throw Error(s(168));Ce(it,t),Ce(gt,i)}function Xl(e,t,i){var c=e.stateNode;if(t=t.childContextTypes,typeof c.getChildContext!="function")return i;c=c.getChildContext();for(var h in c)if(!(h in t))throw Error(s(108,L(e)||"Unknown",h));return o({},i,c)}function Qa(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Mn,Wn=it.current,Ce(it,e),Ce(gt,gt.current),!0}function Zl(e,t,i){var c=e.stateNode;if(!c)throw Error(s(169));i?(e=Xl(e,t,Wn),c.__reactInternalMemoizedMergedChildContext=e,Re(gt),Re(it),Ce(it,e)):Re(gt),Ce(gt,i)}var Wt=Math.clz32?Math.clz32:Kf,Gf=Math.log,Yf=Math.LN2;function Kf(e){return e>>>=0,e===0?32:31-(Gf(e)/Yf|0)|0}var qa=64,Xa=4194304;function ia(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Za(e,t){var i=e.pendingLanes;if(i===0)return 0;var c=0,h=e.suspendedLanes,y=e.pingedLanes,T=i&268435455;if(T!==0){var I=T&~h;I!==0?c=ia(I):(y&=T,y!==0&&(c=ia(y)))}else T=i&~h,T!==0?c=ia(T):y!==0&&(c=ia(y));if(c===0)return 0;if(t!==0&&t!==c&&!(t&h)&&(h=c&-c,y=t&-t,h>=y||h===16&&(y&4194240)!==0))return t;if(c&4&&(c|=i&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=c;0<t;)i=31-Wt(t),h=1<<i,c|=e[i],t&=~h;return c}function Wf(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Qf(e,t){for(var i=e.suspendedLanes,c=e.pingedLanes,h=e.expirationTimes,y=e.pendingLanes;0<y;){var T=31-Wt(y),I=1<<T,H=h[T];H===-1?(!(I&i)||I&c)&&(h[T]=Wf(I,t)):H<=t&&(e.expiredLanes|=I),y&=~I}}function Lo(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Co(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function oa(e,t,i){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Wt(t),e[t]=i}function qf(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var c=e.eventTimes;for(e=e.expirationTimes;0<i;){var h=31-Wt(i),y=1<<h;t[h]=0,c[h]=-1,e[h]=-1,i&=~y}}function Ro(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var c=31-Wt(i),h=1<<c;h&t|e[c]&t&&(e[c]|=t),i&=~h}}var _e=0;function $l(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Io=l.unstable_scheduleCallback,Jl=l.unstable_cancelCallback,Xf=l.unstable_shouldYield,Zf=l.unstable_requestPaint,Xe=l.unstable_now,zo=l.unstable_ImmediatePriority,$f=l.unstable_UserBlockingPriority,ko=l.unstable_NormalPriority,Jf=l.unstable_IdlePriority,$a=null,Jt=null;function ep(e){if(Jt&&typeof Jt.onCommitFiberRoot=="function")try{Jt.onCommitFiberRoot($a,e,void 0,(e.current.flags&128)===128)}catch{}}function tp(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var en=typeof Object.is=="function"?Object.is:tp,pn=null,Ja=!1,No=!1;function eu(e){pn===null?pn=[e]:pn.push(e)}function np(e){Ja=!0,eu(e)}function tn(){if(!No&&pn!==null){No=!0;var e=0,t=_e;try{var i=pn;for(_e=1;e<i.length;e++){var c=i[e];do c=c(!0);while(c!==null)}pn=null,Ja=!1}catch(h){throw pn!==null&&(pn=pn.slice(e+1)),Io(zo,tn),h}finally{_e=t,No=!1}}return null}var rp=u.ReactCurrentBatchConfig;function ei(e,t){if(en(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var i=Object.keys(e),c=Object.keys(t);if(i.length!==c.length)return!1;for(c=0;c<i.length;c++){var h=i[c];if(!Vf.call(t,h)||!en(e[h],t[h]))return!1}return!0}function ap(e){switch(e.tag){case 5:return aa(e.type);case 16:return aa("Lazy");case 13:return aa("Suspense");case 19:return aa("SuspenseList");case 0:case 2:case 15:return e=Po(e.type,!1),e;case 11:return e=Po(e.type.render,!1),e;case 1:return e=Po(e.type,!0),e;default:return""}}function Qt(e,t){if(e&&e.defaultProps){t=o({},t),e=e.defaultProps;for(var i in e)t[i]===void 0&&(t[i]=e[i]);return t}return t}var ti=Pn(null),ni=null,mr=null,jo=null;function Bo(){jo=mr=ni=null}function tu(e,t,i){fn?(Ce(ti,t._currentValue),t._currentValue=i):(Ce(ti,t._currentValue2),t._currentValue2=i)}function Oo(e){var t=ti.current;Re(ti),fn?e._currentValue=t:e._currentValue2=t}function Do(e,t,i){for(;e!==null;){var c=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,c!==null&&(c.childLanes|=t)):c!==null&&(c.childLanes&t)!==t&&(c.childLanes|=t),e===i)break;e=e.return}}function gr(e,t){ni=e,jo=mr=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Tt=!0),e.firstContext=null)}function Rt(e){var t=fn?e._currentValue:e._currentValue2;if(jo!==e)if(e={context:e,memoizedValue:t,next:null},mr===null){if(ni===null)throw Error(s(308));mr=e,ni.dependencies={lanes:0,firstContext:e}}else mr=mr.next=e;return t}var nn=null,Ln=!1;function Uo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function nu(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function hn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Cn(e,t){var i=e.updateQueue;i!==null&&(i=i.shared,Ye!==null&&e.mode&1&&!(ye&2)?(e=i.interleaved,e===null?(t.next=t,nn===null?nn=[i]:nn.push(i)):(t.next=e.next,e.next=t),i.interleaved=t):(e=i.pending,e===null?t.next=t:(t.next=e.next,e.next=t),i.pending=t))}function ri(e,t,i){if(t=t.updateQueue,t!==null&&(t=t.shared,(i&4194240)!==0)){var c=t.lanes;c&=e.pendingLanes,i|=c,t.lanes=i,Ro(e,i)}}function ru(e,t){var i=e.updateQueue,c=e.alternate;if(c!==null&&(c=c.updateQueue,i===c)){var h=null,y=null;if(i=i.firstBaseUpdate,i!==null){do{var T={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};y===null?h=y=T:y=y.next=T,i=i.next}while(i!==null);y===null?h=y=t:y=y.next=t}else h=y=t;i={baseState:c.baseState,firstBaseUpdate:h,lastBaseUpdate:y,shared:c.shared,effects:c.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function ai(e,t,i,c){var h=e.updateQueue;Ln=!1;var y=h.firstBaseUpdate,T=h.lastBaseUpdate,I=h.shared.pending;if(I!==null){h.shared.pending=null;var H=I,W=H.next;H.next=null,T===null?y=W:T.next=W,T=H;var J=e.alternate;J!==null&&(J=J.updateQueue,I=J.lastBaseUpdate,I!==T&&(I===null?J.firstBaseUpdate=W:I.next=W,J.lastBaseUpdate=H))}if(y!==null){var ce=h.baseState;T=0,J=W=H=null,I=y;do{var oe=I.lane,Pe=I.eventTime;if((c&oe)===oe){J!==null&&(J=J.next={eventTime:Pe,lane:0,tag:I.tag,payload:I.payload,callback:I.callback,next:null});e:{var re=e,ut=I;switch(oe=t,Pe=i,ut.tag){case 1:if(re=ut.payload,typeof re=="function"){ce=re.call(Pe,ce,oe);break e}ce=re;break e;case 3:re.flags=re.flags&-65537|128;case 0:if(re=ut.payload,oe=typeof re=="function"?re.call(Pe,ce,oe):re,oe==null)break e;ce=o({},ce,oe);break e;case 2:Ln=!0}}I.callback!==null&&I.lane!==0&&(e.flags|=64,oe=h.effects,oe===null?h.effects=[I]:oe.push(I))}else Pe={eventTime:Pe,lane:oe,tag:I.tag,payload:I.payload,callback:I.callback,next:null},J===null?(W=J=Pe,H=ce):J=J.next=Pe,T|=oe;if(I=I.next,I===null){if(I=h.shared.pending,I===null)break;oe=I,I=oe.next,oe.next=null,h.lastBaseUpdate=oe,h.shared.pending=null}}while(!0);if(J===null&&(H=ce),h.baseState=H,h.firstBaseUpdate=W,h.lastBaseUpdate=J,t=h.shared.interleaved,t!==null){h=t;do T|=h.lane,h=h.next;while(h!==t)}else y===null&&(h.shared.lanes=0);Ar|=T,e.lanes=T,e.memoizedState=ce}}function au(e,t,i){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var c=e[t],h=c.callback;if(h!==null){if(c.callback=null,c=i,typeof h!="function")throw Error(s(191,h));h.call(c)}}}var iu=new n.Component().refs;function Fo(e,t,i,c){t=e.memoizedState,i=i(c,t),i=i==null?t:o({},t,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var ii={isMounted:function(e){return(e=e._reactInternals)?N(e)===e:!1},enqueueSetState:function(e,t,i){e=e._reactInternals;var c=ht(),h=zn(e),y=hn(c,h);y.payload=t,i!=null&&(y.callback=i),Cn(e,y),t=jt(e,h,c),t!==null&&ri(t,e,h)},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var c=ht(),h=zn(e),y=hn(c,h);y.tag=1,y.payload=t,i!=null&&(y.callback=i),Cn(e,y),t=jt(e,h,c),t!==null&&ri(t,e,h)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ht(),c=zn(e),h=hn(i,c);h.tag=2,t!=null&&(h.callback=t),Cn(e,h),t=jt(e,c,i),t!==null&&ri(t,e,c)}};function ou(e,t,i,c,h,y,T){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(c,y,T):t.prototype&&t.prototype.isPureReactComponent?!ei(i,c)||!ei(h,y):!0}function su(e,t,i){var c=!1,h=Mn,y=t.contextType;return typeof y=="object"&&y!==null?y=Rt(y):(h=vt(t)?Wn:it.current,c=t.contextTypes,y=(c=c!=null)?hr(e,h):Mn),t=new t(i,y),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=ii,e.stateNode=t,t._reactInternals=e,c&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=h,e.__reactInternalMemoizedMaskedChildContext=y),t}function lu(e,t,i,c){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(i,c),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(i,c),t.state!==e&&ii.enqueueReplaceState(t,t.state,null)}function Ho(e,t,i,c){var h=e.stateNode;h.props=i,h.state=e.memoizedState,h.refs=iu,Uo(e);var y=t.contextType;typeof y=="object"&&y!==null?h.context=Rt(y):(y=vt(t)?Wn:it.current,h.context=hr(e,y)),h.state=e.memoizedState,y=t.getDerivedStateFromProps,typeof y=="function"&&(Fo(e,t,y,i),h.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(t=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),t!==h.state&&ii.enqueueReplaceState(h,h.state,null),ai(e,i,h,c),h.state=e.memoizedState),typeof h.componentDidMount=="function"&&(e.flags|=4194308)}var vr=[],yr=0,oi=null,si=0,It=[],zt=0,Qn=null,mn=1,gn="";function qn(e,t){vr[yr++]=si,vr[yr++]=oi,oi=e,si=t}function uu(e,t,i){It[zt++]=mn,It[zt++]=gn,It[zt++]=Qn,Qn=e;var c=mn;e=gn;var h=32-Wt(c)-1;c&=~(1<<h),i+=1;var y=32-Wt(t)+h;if(30<y){var T=h-h%5;y=(c&(1<<T)-1).toString(32),c>>=T,h-=T,mn=1<<32-Wt(t)+h|i<<h|c,gn=y+e}else mn=1<<y|i<<h|c,gn=e}function Vo(e){e.return!==null&&(qn(e,1),uu(e,1,0))}function Go(e){for(;e===oi;)oi=vr[--yr],vr[yr]=null,si=vr[--yr],vr[yr]=null;for(;e===Qn;)Qn=It[--zt],It[zt]=null,gn=It[--zt],It[zt]=null,mn=It[--zt],It[zt]=null}var Et=null,At=null,ke=!1,sa=!1,qt=null;function cu(e,t){var i=Bt(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)}function du(e,t){switch(e.tag){case 5:return t=Tf(t,e.type,e.pendingProps),t!==null?(e.stateNode=t,Et=e,At=Cf(t),!0):!1;case 6:return t=Pf(t,e.pendingProps),t!==null?(e.stateNode=t,Et=e,At=null,!0):!1;case 13:if(t=Mf(t),t!==null){var i=Qn!==null?{id:mn,overflow:gn}:null;return e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},i=Bt(18,null,null,0),i.stateNode=t,i.return=e,e.child=i,Et=e,At=null,!0}return!1;default:return!1}}function Yo(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Ko(e){if(ke){var t=At;if(t){var i=t;if(!du(e,t)){if(Yo(e))throw Error(s(418));t=ra(i);var c=Et;t&&du(e,t)?cu(c,i):(e.flags=e.flags&-4097|2,ke=!1,Et=e)}}else{if(Yo(e))throw Error(s(418));e.flags=e.flags&-4097|2,ke=!1,Et=e}}}function fu(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Et=e}function la(e){if(!te||e!==Et)return!1;if(!ke)return fu(e),ke=!0,!1;if(e.tag!==3&&(e.tag!==5||Uf(e.type)&&!ze(e.type,e.memoizedProps))){var t=At;if(t){if(Yo(e)){for(e=At;e;)e=ra(e);throw Error(s(418))}for(;t;)cu(e,t),t=ra(t)}}if(fu(e),e.tag===13){if(!te)throw Error(s(316));if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));At=jf(e)}else At=Et?ra(e.stateNode):null;return!0}function br(){te&&(At=Et=null,sa=ke=!1)}function Wo(e){qt===null?qt=[e]:qt.push(e)}function ua(e,t,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(s(309));var c=i.stateNode}if(!c)throw Error(s(147,e));var h=c,y=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===y?t.ref:(t=function(T){var I=h.refs;I===iu&&(I=h.refs={}),T===null?delete I[y]:I[y]=T},t._stringRef=y,t)}if(typeof e!="string")throw Error(s(284));if(!i._owner)throw Error(s(290,e))}return e}function li(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function pu(e){var t=e._init;return t(e._payload)}function hu(e){function t(D,k){if(e){var U=D.deletions;U===null?(D.deletions=[k],D.flags|=16):U.push(k)}}function i(D,k){if(!e)return null;for(;k!==null;)t(D,k),k=k.sibling;return null}function c(D,k){for(D=new Map;k!==null;)k.key!==null?D.set(k.key,k):D.set(k.index,k),k=k.sibling;return D}function h(D,k){return D=Nn(D,k),D.index=0,D.sibling=null,D}function y(D,k,U){return D.index=U,e?(U=D.alternate,U!==null?(U=U.index,U<k?(D.flags|=2,k):U):(D.flags|=2,k)):(D.flags|=1048576,k)}function T(D){return e&&D.alternate===null&&(D.flags|=2),D}function I(D,k,U,X){return k===null||k.tag!==6?(k=Ls(U,D.mode,X),k.return=D,k):(k=h(k,U),k.return=D,k)}function H(D,k,U,X){var ae=U.type;return ae===p?J(D,k,U.props.children,X,U.key):k!==null&&(k.elementType===ae||typeof ae=="object"&&ae!==null&&ae.$$typeof===S&&pu(ae)===k.type)?(X=h(k,U.props),X.ref=ua(D,k,U),X.return=D,X):(X=Di(U.type,U.key,U.props,null,D.mode,X),X.ref=ua(D,k,U),X.return=D,X)}function W(D,k,U,X){return k===null||k.tag!==4||k.stateNode.containerInfo!==U.containerInfo||k.stateNode.implementation!==U.implementation?(k=Cs(U,D.mode,X),k.return=D,k):(k=h(k,U.children||[]),k.return=D,k)}function J(D,k,U,X,ae){return k===null||k.tag!==7?(k=nr(U,D.mode,X,ae),k.return=D,k):(k=h(k,U),k.return=D,k)}function ce(D,k,U){if(typeof k=="string"&&k!==""||typeof k=="number")return k=Ls(""+k,D.mode,U),k.return=D,k;if(typeof k=="object"&&k!==null){switch(k.$$typeof){case f:return U=Di(k.type,k.key,k.props,null,D.mode,U),U.ref=ua(D,null,k),U.return=D,U;case d:return k=Cs(k,D.mode,U),k.return=D,k;case S:var X=k._init;return ce(D,X(k._payload),U)}if($(k)||M(k))return k=nr(k,D.mode,U,null),k.return=D,k;li(D,k)}return null}function oe(D,k,U,X){var ae=k!==null?k.key:null;if(typeof U=="string"&&U!==""||typeof U=="number")return ae!==null?null:I(D,k,""+U,X);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case f:return U.key===ae?H(D,k,U,X):null;case d:return U.key===ae?W(D,k,U,X):null;case S:return ae=U._init,oe(D,k,ae(U._payload),X)}if($(U)||M(U))return ae!==null?null:J(D,k,U,X,null);li(D,U)}return null}function Pe(D,k,U,X,ae){if(typeof X=="string"&&X!==""||typeof X=="number")return D=D.get(U)||null,I(k,D,""+X,ae);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case f:return D=D.get(X.key===null?U:X.key)||null,H(k,D,X,ae);case d:return D=D.get(X.key===null?U:X.key)||null,W(k,D,X,ae);case S:var ge=X._init;return Pe(D,k,U,ge(X._payload),ae)}if($(X)||M(X))return D=D.get(U)||null,J(k,D,X,ae,null);li(k,X)}return null}function re(D,k,U,X){for(var ae=null,ge=null,de=k,Ee=k=0,$e=null;de!==null&&Ee<U.length;Ee++){de.index>Ee?($e=de,de=null):$e=de.sibling;var Ae=oe(D,de,U[Ee],X);if(Ae===null){de===null&&(de=$e);break}e&&de&&Ae.alternate===null&&t(D,de),k=y(Ae,k,Ee),ge===null?ae=Ae:ge.sibling=Ae,ge=Ae,de=$e}if(Ee===U.length)return i(D,de),ke&&qn(D,Ee),ae;if(de===null){for(;Ee<U.length;Ee++)de=ce(D,U[Ee],X),de!==null&&(k=y(de,k,Ee),ge===null?ae=de:ge.sibling=de,ge=de);return ke&&qn(D,Ee),ae}for(de=c(D,de);Ee<U.length;Ee++)$e=Pe(de,D,Ee,U[Ee],X),$e!==null&&(e&&$e.alternate!==null&&de.delete($e.key===null?Ee:$e.key),k=y($e,k,Ee),ge===null?ae=$e:ge.sibling=$e,ge=$e);return e&&de.forEach(function(jn){return t(D,jn)}),ke&&qn(D,Ee),ae}function ut(D,k,U,X){var ae=M(U);if(typeof ae!="function")throw Error(s(150));if(U=ae.call(U),U==null)throw Error(s(151));for(var ge=ae=null,de=k,Ee=k=0,$e=null,Ae=U.next();de!==null&&!Ae.done;Ee++,Ae=U.next()){de.index>Ee?($e=de,de=null):$e=de.sibling;var jn=oe(D,de,Ae.value,X);if(jn===null){de===null&&(de=$e);break}e&&de&&jn.alternate===null&&t(D,de),k=y(jn,k,Ee),ge===null?ae=jn:ge.sibling=jn,ge=jn,de=$e}if(Ae.done)return i(D,de),ke&&qn(D,Ee),ae;if(de===null){for(;!Ae.done;Ee++,Ae=U.next())Ae=ce(D,Ae.value,X),Ae!==null&&(k=y(Ae,k,Ee),ge===null?ae=Ae:ge.sibling=Ae,ge=Ae);return ke&&qn(D,Ee),ae}for(de=c(D,de);!Ae.done;Ee++,Ae=U.next())Ae=Pe(de,D,Ee,Ae.value,X),Ae!==null&&(e&&Ae.alternate!==null&&de.delete(Ae.key===null?Ee:Ae.key),k=y(Ae,k,Ee),ge===null?ae=Ae:ge.sibling=Ae,ge=Ae);return e&&de.forEach(function(kp){return t(D,kp)}),ke&&qn(D,Ee),ae}function Ot(D,k,U,X){if(typeof U=="object"&&U!==null&&U.type===p&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case f:e:{for(var ae=U.key,ge=k;ge!==null;){if(ge.key===ae){if(ae=U.type,ae===p){if(ge.tag===7){i(D,ge.sibling),k=h(ge,U.props.children),k.return=D,D=k;break e}}else if(ge.elementType===ae||typeof ae=="object"&&ae!==null&&ae.$$typeof===S&&pu(ae)===ge.type){i(D,ge.sibling),k=h(ge,U.props),k.ref=ua(D,ge,U),k.return=D,D=k;break e}i(D,ge);break}else t(D,ge);ge=ge.sibling}U.type===p?(k=nr(U.props.children,D.mode,X,U.key),k.return=D,D=k):(X=Di(U.type,U.key,U.props,null,D.mode,X),X.ref=ua(D,k,U),X.return=D,D=X)}return T(D);case d:e:{for(ge=U.key;k!==null;){if(k.key===ge)if(k.tag===4&&k.stateNode.containerInfo===U.containerInfo&&k.stateNode.implementation===U.implementation){i(D,k.sibling),k=h(k,U.children||[]),k.return=D,D=k;break e}else{i(D,k);break}else t(D,k);k=k.sibling}k=Cs(U,D.mode,X),k.return=D,D=k}return T(D);case S:return ge=U._init,Ot(D,k,ge(U._payload),X)}if($(U))return re(D,k,U,X);if(M(U))return ut(D,k,U,X);li(D,U)}return typeof U=="string"&&U!==""||typeof U=="number"?(U=""+U,k!==null&&k.tag===6?(i(D,k.sibling),k=h(k,U),k.return=D,D=k):(i(D,k),k=Ls(U,D.mode,X),k.return=D,D=k),T(D)):i(D,k)}return Ot}var xr=hu(!0),mu=hu(!1),ca={},kt=Pn(ca),da=Pn(ca),wr=Pn(ca);function rn(e){if(e===ca)throw Error(s(174));return e}function Qo(e,t){Ce(wr,t),Ce(da,e),Ce(kt,ca),e=fe(t),Re(kt),Ce(kt,e)}function Sr(){Re(kt),Re(da),Re(wr)}function gu(e){var t=rn(wr.current),i=rn(kt.current);t=ve(i,e.type,t),i!==t&&(Ce(da,e),Ce(kt,t))}function qo(e){da.current===e&&(Re(kt),Re(da))}var Be=Pn(0);function ui(e){for(var t=e;t!==null;){if(t.tag===13){var i=t.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||Wl(i)||Eo(i)))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Xo=[];function Zo(){for(var e=0;e<Xo.length;e++){var t=Xo[e];fn?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}Xo.length=0}var ci=u.ReactCurrentDispatcher,Nt=u.ReactCurrentBatchConfig,_r=0,Ue=null,ot=null,Ze=null,di=!1,fa=!1,pa=0,ip=0;function st(){throw Error(s(321))}function $o(e,t){if(t===null)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!en(e[i],t[i]))return!1;return!0}function Jo(e,t,i,c,h,y){if(_r=y,Ue=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ci.current=e===null||e.memoizedState===null?up:cp,e=i(c,h),fa){y=0;do{if(fa=!1,pa=0,25<=y)throw Error(s(301));y+=1,Ze=ot=null,t.updateQueue=null,ci.current=dp,e=i(c,h)}while(fa)}if(ci.current=gi,t=ot!==null&&ot.next!==null,_r=0,Ze=ot=Ue=null,di=!1,t)throw Error(s(300));return e}function es(){var e=pa!==0;return pa=0,e}function vn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ze===null?Ue.memoizedState=Ze=e:Ze=Ze.next=e,Ze}function an(){if(ot===null){var e=Ue.alternate;e=e!==null?e.memoizedState:null}else e=ot.next;var t=Ze===null?Ue.memoizedState:Ze.next;if(t!==null)Ze=t,ot=e;else{if(e===null)throw Error(s(310));ot=e,e={memoizedState:ot.memoizedState,baseState:ot.baseState,baseQueue:ot.baseQueue,queue:ot.queue,next:null},Ze===null?Ue.memoizedState=Ze=e:Ze=Ze.next=e}return Ze}function Xn(e,t){return typeof t=="function"?t(e):t}function fi(e){var t=an(),i=t.queue;if(i===null)throw Error(s(311));i.lastRenderedReducer=e;var c=ot,h=c.baseQueue,y=i.pending;if(y!==null){if(h!==null){var T=h.next;h.next=y.next,y.next=T}c.baseQueue=h=y,i.pending=null}if(h!==null){y=h.next,c=c.baseState;var I=T=null,H=null,W=y;do{var J=W.lane;if((_r&J)===J)H!==null&&(H=H.next={lane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),c=W.hasEagerState?W.eagerState:e(c,W.action);else{var ce={lane:J,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null};H===null?(I=H=ce,T=c):H=H.next=ce,Ue.lanes|=J,Ar|=J}W=W.next}while(W!==null&&W!==y);H===null?T=c:H.next=I,en(c,t.memoizedState)||(Tt=!0),t.memoizedState=c,t.baseState=T,t.baseQueue=H,i.lastRenderedState=c}if(e=i.interleaved,e!==null){h=e;do y=h.lane,Ue.lanes|=y,Ar|=y,h=h.next;while(h!==e)}else h===null&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function pi(e){var t=an(),i=t.queue;if(i===null)throw Error(s(311));i.lastRenderedReducer=e;var c=i.dispatch,h=i.pending,y=t.memoizedState;if(h!==null){i.pending=null;var T=h=h.next;do y=e(y,T.action),T=T.next;while(T!==h);en(y,t.memoizedState)||(Tt=!0),t.memoizedState=y,t.baseQueue===null&&(t.baseState=y),i.lastRenderedState=y}return[y,c]}function vu(){}function yu(e,t){var i=Ue,c=an(),h=t(),y=!en(c.memoizedState,h);if(y&&(c.memoizedState=h,Tt=!0),c=c.queue,ma(wu.bind(null,i,c,e),[e]),c.getSnapshot!==t||y||Ze!==null&&Ze.memoizedState.tag&1){if(i.flags|=2048,ha(9,xu.bind(null,i,c,h,t),void 0,null),Ye===null)throw Error(s(349));_r&30||bu(i,t,h)}return h}function bu(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},t=Ue.updateQueue,t===null?(t={lastEffect:null,stores:null},Ue.updateQueue=t,t.stores=[e]):(i=t.stores,i===null?t.stores=[e]:i.push(e))}function xu(e,t,i,c){t.value=i,t.getSnapshot=c,Su(t)&&jt(e,1,-1)}function wu(e,t,i){return i(function(){Su(t)&&jt(e,1,-1)})}function Su(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!en(e,i)}catch{return!0}}function ts(e){var t=vn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xn,lastRenderedState:e},t.queue=e,e=e.dispatch=lp.bind(null,Ue,e),[t.memoizedState,e]}function ha(e,t,i,c){return e={tag:e,create:t,destroy:i,deps:c,next:null},t=Ue.updateQueue,t===null?(t={lastEffect:null,stores:null},Ue.updateQueue=t,t.lastEffect=e.next=e):(i=t.lastEffect,i===null?t.lastEffect=e.next=e:(c=i.next,i.next=e,e.next=c,t.lastEffect=e)),e}function _u(){return an().memoizedState}function hi(e,t,i,c){var h=vn();Ue.flags|=e,h.memoizedState=ha(1|t,i,void 0,c===void 0?null:c)}function mi(e,t,i,c){var h=an();c=c===void 0?null:c;var y=void 0;if(ot!==null){var T=ot.memoizedState;if(y=T.destroy,c!==null&&$o(c,T.deps)){h.memoizedState=ha(t,i,y,c);return}}Ue.flags|=e,h.memoizedState=ha(1|t,i,y,c)}function ns(e,t){return hi(8390656,8,e,t)}function ma(e,t){return mi(2048,8,e,t)}function Eu(e,t){return mi(4,2,e,t)}function Au(e,t){return mi(4,4,e,t)}function Tu(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Pu(e,t,i){return i=i!=null?i.concat([e]):null,mi(4,4,Tu.bind(null,t,e),i)}function rs(){}function Mu(e,t){var i=an();t=t===void 0?null:t;var c=i.memoizedState;return c!==null&&t!==null&&$o(t,c[1])?c[0]:(i.memoizedState=[e,t],e)}function Lu(e,t){var i=an();t=t===void 0?null:t;var c=i.memoizedState;return c!==null&&t!==null&&$o(t,c[1])?c[0]:(e=e(),i.memoizedState=[e,t],e)}function op(e,t){var i=_e;_e=i!==0&&4>i?i:4,e(!0);var c=Nt.transition;Nt.transition={};try{e(!1),t()}finally{_e=i,Nt.transition=c}}function Cu(){return an().memoizedState}function sp(e,t,i){var c=zn(e);i={lane:c,action:i,hasEagerState:!1,eagerState:null,next:null},Ru(e)?Iu(t,i):(zu(e,t,i),i=ht(),e=jt(e,c,i),e!==null&&ku(e,t,c))}function lp(e,t,i){var c=zn(e),h={lane:c,action:i,hasEagerState:!1,eagerState:null,next:null};if(Ru(e))Iu(t,h);else{zu(e,t,h);var y=e.alternate;if(e.lanes===0&&(y===null||y.lanes===0)&&(y=t.lastRenderedReducer,y!==null))try{var T=t.lastRenderedState,I=y(T,i);if(h.hasEagerState=!0,h.eagerState=I,en(I,T))return}catch{}finally{}i=ht(),e=jt(e,c,i),e!==null&&ku(e,t,c)}}function Ru(e){var t=e.alternate;return e===Ue||t!==null&&t===Ue}function Iu(e,t){fa=di=!0;var i=e.pending;i===null?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function zu(e,t,i){Ye!==null&&e.mode&1&&!(ye&2)?(e=t.interleaved,e===null?(i.next=i,nn===null?nn=[t]:nn.push(t)):(i.next=e.next,e.next=i),t.interleaved=i):(e=t.pending,e===null?i.next=i:(i.next=e.next,e.next=i),t.pending=i)}function ku(e,t,i){if(i&4194240){var c=t.lanes;c&=e.pendingLanes,i|=c,t.lanes=i,Ro(e,i)}}var gi={readContext:Rt,useCallback:st,useContext:st,useEffect:st,useImperativeHandle:st,useInsertionEffect:st,useLayoutEffect:st,useMemo:st,useReducer:st,useRef:st,useState:st,useDebugValue:st,useDeferredValue:st,useTransition:st,useMutableSource:st,useSyncExternalStore:st,useId:st,unstable_isNewReconciler:!1},up={readContext:Rt,useCallback:function(e,t){return vn().memoizedState=[e,t===void 0?null:t],e},useContext:Rt,useEffect:ns,useImperativeHandle:function(e,t,i){return i=i!=null?i.concat([e]):null,hi(4194308,4,Tu.bind(null,t,e),i)},useLayoutEffect:function(e,t){return hi(4194308,4,e,t)},useInsertionEffect:function(e,t){return hi(4,2,e,t)},useMemo:function(e,t){var i=vn();return t=t===void 0?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var c=vn();return t=i!==void 0?i(t):t,c.memoizedState=c.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},c.queue=e,e=e.dispatch=sp.bind(null,Ue,e),[c.memoizedState,e]},useRef:function(e){var t=vn();return e={current:e},t.memoizedState=e},useState:ts,useDebugValue:rs,useDeferredValue:function(e){var t=ts(e),i=t[0],c=t[1];return ns(function(){var h=Nt.transition;Nt.transition={};try{c(e)}finally{Nt.transition=h}},[e]),i},useTransition:function(){var e=ts(!1),t=e[0];return e=op.bind(null,e[1]),vn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var c=Ue,h=vn();if(ke){if(i===void 0)throw Error(s(407));i=i()}else{if(i=t(),Ye===null)throw Error(s(349));_r&30||bu(c,t,i)}h.memoizedState=i;var y={value:i,getSnapshot:t};return h.queue=y,ns(wu.bind(null,c,y,e),[e]),c.flags|=2048,ha(9,xu.bind(null,c,y,i,t),void 0,null),i},useId:function(){var e=vn(),t=Ye.identifierPrefix;if(ke){var i=gn,c=mn;i=(c&~(1<<32-Wt(c)-1)).toString(32)+i,t=":"+t+"R"+i,i=pa++,0<i&&(t+="H"+i.toString(32)),t+=":"}else i=ip++,t=":"+t+"r"+i.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},cp={readContext:Rt,useCallback:Mu,useContext:Rt,useEffect:ma,useImperativeHandle:Pu,useInsertionEffect:Eu,useLayoutEffect:Au,useMemo:Lu,useReducer:fi,useRef:_u,useState:function(){return fi(Xn)},useDebugValue:rs,useDeferredValue:function(e){var t=fi(Xn),i=t[0],c=t[1];return ma(function(){var h=Nt.transition;Nt.transition={};try{c(e)}finally{Nt.transition=h}},[e]),i},useTransition:function(){var e=fi(Xn)[0],t=an().memoizedState;return[e,t]},useMutableSource:vu,useSyncExternalStore:yu,useId:Cu,unstable_isNewReconciler:!1},dp={readContext:Rt,useCallback:Mu,useContext:Rt,useEffect:ma,useImperativeHandle:Pu,useInsertionEffect:Eu,useLayoutEffect:Au,useMemo:Lu,useReducer:pi,useRef:_u,useState:function(){return pi(Xn)},useDebugValue:rs,useDeferredValue:function(e){var t=pi(Xn),i=t[0],c=t[1];return ma(function(){var h=Nt.transition;Nt.transition={};try{c(e)}finally{Nt.transition=h}},[e]),i},useTransition:function(){var e=pi(Xn)[0],t=an().memoizedState;return[e,t]},useMutableSource:vu,useSyncExternalStore:yu,useId:Cu,unstable_isNewReconciler:!1};function as(e,t){try{var i="",c=t;do i+=ap(c),c=c.return;while(c);var h=i}catch(y){h=`
Error generating stack: `+y.message+`
`+y.stack}return{value:e,source:t,stack:h}}function is(e,t){try{console.error(t.value)}catch(i){setTimeout(function(){throw i})}}var fp=typeof WeakMap=="function"?WeakMap:Map;function Nu(e,t,i){i=hn(-1,i),i.tag=3,i.payload={element:null};var c=t.value;return i.callback=function(){Ii||(Ii=!0,Ss=c),is(e,t)},i}function ju(e,t,i){i=hn(-1,i),i.tag=3;var c=e.type.getDerivedStateFromError;if(typeof c=="function"){var h=t.value;i.payload=function(){return c(h)},i.callback=function(){is(e,t)}}var y=e.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(i.callback=function(){is(e,t),typeof c!="function"&&(Rn===null?Rn=new Set([this]):Rn.add(this));var T=t.stack;this.componentDidCatch(t.value,{componentStack:T!==null?T:""})}),i}function Bu(e,t,i){var c=e.pingCache;if(c===null){c=e.pingCache=new fp;var h=new Set;c.set(t,h)}else h=c.get(t),h===void 0&&(h=new Set,c.set(t,h));h.has(i)||(h.add(i),e=Tp.bind(null,e,t,i),t.then(e,e))}function Ou(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Du(e,t,i,c,h){return e.mode&1?(e.flags|=65536,e.lanes=h,e):(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(t=hn(-1,1),t.tag=2,Cn(i,t))),i.lanes|=1),e)}function on(e){e.flags|=4}function Uu(e,t){if(e!==null&&e.child===t.child)return!0;if(t.flags&16)return!1;for(e=t.child;e!==null;){if(e.flags&12854||e.subtreeFlags&12854)return!1;e=e.sibling}return!0}var ga,va,vi,yi;if(me)ga=function(e,t){for(var i=t.child;i!==null;){if(i.tag===5||i.tag===6)ie(e,i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},va=function(){},vi=function(e,t,i,c,h){if(e=e.memoizedProps,e!==c){var y=t.stateNode,T=rn(kt.current);i=Te(y,i,e,c,h,T),(t.updateQueue=i)&&on(t)}},yi=function(e,t,i,c){i!==c&&on(t)};else if(Y){ga=function(e,t,i,c){for(var h=t.child;h!==null;){if(h.tag===5){var y=h.stateNode;i&&c&&(y=Tn(y,h.type,h.memoizedProps,h)),ie(e,y)}else if(h.tag===6)y=h.stateNode,i&&c&&(y=Kn(y,h.memoizedProps,h)),ie(e,y);else if(h.tag!==4){if(h.tag===22&&h.memoizedState!==null)y=h.child,y!==null&&(y.return=h),ga(e,h,!0,!0);else if(h.child!==null){h.child.return=h,h=h.child;continue}}if(h===t)break;for(;h.sibling===null;){if(h.return===null||h.return===t)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};var Fu=function(e,t,i,c){for(var h=t.child;h!==null;){if(h.tag===5){var y=h.stateNode;i&&c&&(y=Tn(y,h.type,h.memoizedProps,h)),Ct(e,y)}else if(h.tag===6)y=h.stateNode,i&&c&&(y=Kn(y,h.memoizedProps,h)),Ct(e,y);else if(h.tag!==4){if(h.tag===22&&h.memoizedState!==null)y=h.child,y!==null&&(y.return=h),Fu(e,h,!0,!0);else if(h.child!==null){h.child.return=h,h=h.child;continue}}if(h===t)break;for(;h.sibling===null;){if(h.return===null||h.return===t)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};va=function(e,t){var i=t.stateNode;if(!Uu(e,t)){e=i.containerInfo;var c=Lt(e);Fu(c,t,!1,!1),i.pendingChildren=c,on(t),Yn(e,c)}},vi=function(e,t,i,c,h){var y=e.stateNode,T=e.memoizedProps;if((e=Uu(e,t))&&T===c)t.stateNode=y;else{var I=t.stateNode,H=rn(kt.current),W=null;T!==c&&(W=Te(I,i,T,c,h,H)),e&&W===null?t.stateNode=y:(y=Ka(y,W,i,T,c,t,e,I),pe(y,i,c,h,H)&&on(t),t.stateNode=y,e?on(t):ga(y,t,!1,!1))}},yi=function(e,t,i,c){i!==c?(e=rn(wr.current),i=rn(kt.current),t.stateNode=St(c,e,i,t),on(t)):t.stateNode=e.stateNode}}else va=function(){},vi=function(){},yi=function(){};function ya(e,t){if(!ke)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var c=null;i!==null;)i.alternate!==null&&(c=i),i=i.sibling;c===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:c.sibling=null}}function lt(e){var t=e.alternate!==null&&e.alternate.child===e.child,i=0,c=0;if(t)for(var h=e.child;h!==null;)i|=h.lanes|h.childLanes,c|=h.subtreeFlags&14680064,c|=h.flags&14680064,h.return=e,h=h.sibling;else for(h=e.child;h!==null;)i|=h.lanes|h.childLanes,c|=h.subtreeFlags,c|=h.flags,h.return=e,h=h.sibling;return e.subtreeFlags|=c,e.childLanes=i,t}function pp(e,t,i){var c=t.pendingProps;switch(Go(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return lt(t),null;case 1:return vt(t.type)&&Wa(),lt(t),null;case 3:return c=t.stateNode,Sr(),Re(gt),Re(it),Zo(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(e===null||e.child===null)&&(la(t)?on(t):e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,qt!==null&&(As(qt),qt=null))),va(e,t),lt(t),null;case 5:qo(t),i=rn(wr.current);var h=t.type;if(e!==null&&t.stateNode!=null)vi(e,t,h,c,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!c){if(t.stateNode===null)throw Error(s(166));return lt(t),null}if(e=rn(kt.current),la(t)){if(!te)throw Error(s(175));e=zf(t.stateNode,t.type,t.memoizedProps,i,e,t,!sa),t.updateQueue=e,e!==null&&on(t)}else{var y=Z(h,c,i,e,t);ga(y,t,!1,!1),t.stateNode=y,pe(y,h,c,i,e)&&on(t)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return lt(t),null;case 6:if(e&&t.stateNode!=null)yi(e,t,e.memoizedProps,c);else{if(typeof c!="string"&&t.stateNode===null)throw Error(s(166));if(e=rn(wr.current),i=rn(kt.current),la(t)){if(!te)throw Error(s(176));if(e=t.stateNode,c=t.memoizedProps,(i=kf(e,c,t,!sa))&&(h=Et,h!==null))switch(y=(h.mode&1)!==0,h.tag){case 3:Ff(h.stateNode.containerInfo,e,c,y);break;case 5:Hf(h.type,h.memoizedProps,h.stateNode,e,c,y)}i&&on(t)}else t.stateNode=St(c,e,i,t)}return lt(t),null;case 13:if(Re(Be),c=t.memoizedState,ke&&At!==null&&t.mode&1&&!(t.flags&128)){for(e=At;e;)e=ra(e);return br(),t.flags|=98560,t}if(c!==null&&c.dehydrated!==null){if(c=la(t),e===null){if(!c)throw Error(s(318));if(!te)throw Error(s(344));if(e=t.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(s(317));Nf(e,t)}else br(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;return lt(t),null}return qt!==null&&(As(qt),qt=null),t.flags&128?(t.lanes=i,t):(c=c!==null,i=!1,e===null?la(t):i=e.memoizedState!==null,c&&!i&&(t.child.flags|=8192,t.mode&1&&(e===null||Be.current&1?qe===0&&(qe=3):Ps())),t.updateQueue!==null&&(t.flags|=4),lt(t),null);case 4:return Sr(),va(e,t),e===null&&he(t.stateNode.containerInfo),lt(t),null;case 10:return Oo(t.type._context),lt(t),null;case 17:return vt(t.type)&&Wa(),lt(t),null;case 19:if(Re(Be),h=t.memoizedState,h===null)return lt(t),null;if(c=(t.flags&128)!==0,y=h.rendering,y===null)if(c)ya(h,!1);else{if(qe!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(y=ui(e),y!==null){for(t.flags|=128,ya(h,!1),e=y.updateQueue,e!==null&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=i,c=t.child;c!==null;)i=c,h=e,i.flags&=14680066,y=i.alternate,y===null?(i.childLanes=0,i.lanes=h,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=y.childLanes,i.lanes=y.lanes,i.child=y.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=y.memoizedProps,i.memoizedState=y.memoizedState,i.updateQueue=y.updateQueue,i.type=y.type,h=y.dependencies,i.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),c=c.sibling;return Ce(Be,Be.current&1|2),t.child}e=e.sibling}h.tail!==null&&Xe()>ws&&(t.flags|=128,c=!0,ya(h,!1),t.lanes=4194304)}else{if(!c)if(e=ui(y),e!==null){if(t.flags|=128,c=!0,e=e.updateQueue,e!==null&&(t.updateQueue=e,t.flags|=4),ya(h,!0),h.tail===null&&h.tailMode==="hidden"&&!y.alternate&&!ke)return lt(t),null}else 2*Xe()-h.renderingStartTime>ws&&i!==1073741824&&(t.flags|=128,c=!0,ya(h,!1),t.lanes=4194304);h.isBackwards?(y.sibling=t.child,t.child=y):(e=h.last,e!==null?e.sibling=y:t.child=y,h.last=y)}return h.tail!==null?(t=h.tail,h.rendering=t,h.tail=t.sibling,h.renderingStartTime=Xe(),t.sibling=null,e=Be.current,Ce(Be,c?e&1|2:e&1),t):(lt(t),null);case 22:case 23:return Ts(),c=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==c&&(t.flags|=8192),c&&t.mode&1?Pt&1073741824&&(lt(t),me&&t.subtreeFlags&6&&(t.flags|=8192)):lt(t),null;case 24:return null;case 25:return null}throw Error(s(156,t.tag))}var hp=u.ReactCurrentOwner,Tt=!1;function pt(e,t,i,c){t.child=e===null?mu(t,null,i,c):xr(t,e.child,i,c)}function Hu(e,t,i,c,h){i=i.render;var y=t.ref;return gr(t,h),c=Jo(e,t,i,c,y,h),i=es(),e!==null&&!Tt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~h,yn(e,t,h)):(ke&&i&&Vo(t),t.flags|=1,pt(e,t,c,h),t.child)}function Vu(e,t,i,c,h){if(e===null){var y=i.type;return typeof y=="function"&&!Ms(y)&&y.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(t.tag=15,t.type=y,Gu(e,t,y,c,h)):(e=Di(i.type,null,c,t,t.mode,h),e.ref=t.ref,e.return=t,t.child=e)}if(y=e.child,!(e.lanes&h)){var T=y.memoizedProps;if(i=i.compare,i=i!==null?i:ei,i(T,c)&&e.ref===t.ref)return yn(e,t,h)}return t.flags|=1,e=Nn(y,c),e.ref=t.ref,e.return=t,t.child=e}function Gu(e,t,i,c,h){if(e!==null&&ei(e.memoizedProps,c)&&e.ref===t.ref)if(Tt=!1,(e.lanes&h)!==0)e.flags&131072&&(Tt=!0);else return t.lanes=e.lanes,yn(e,t,h);return os(e,t,i,c,h)}function Yu(e,t,i){var c=t.pendingProps,h=c.children,y=e!==null?e.memoizedState:null;if(c.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null},Ce(Er,Pt),Pt|=i;else if(i&1073741824)t.memoizedState={baseLanes:0,cachePool:null},c=y!==null?y.baseLanes:i,Ce(Er,Pt),Pt|=c;else return e=y!==null?y.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,Ce(Er,Pt),Pt|=e,null;else y!==null?(c=y.baseLanes|i,t.memoizedState=null):c=i,Ce(Er,Pt),Pt|=c;return pt(e,t,h,i),t.child}function Ku(e,t){var i=t.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function os(e,t,i,c,h){var y=vt(i)?Wn:it.current;return y=hr(t,y),gr(t,h),i=Jo(e,t,i,c,y,h),c=es(),e!==null&&!Tt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~h,yn(e,t,h)):(ke&&c&&Vo(t),t.flags|=1,pt(e,t,i,h),t.child)}function Wu(e,t,i,c,h){if(vt(i)){var y=!0;Qa(t)}else y=!1;if(gr(t,h),t.stateNode===null)e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),su(t,i,c),Ho(t,i,c,h),c=!0;else if(e===null){var T=t.stateNode,I=t.memoizedProps;T.props=I;var H=T.context,W=i.contextType;typeof W=="object"&&W!==null?W=Rt(W):(W=vt(i)?Wn:it.current,W=hr(t,W));var J=i.getDerivedStateFromProps,ce=typeof J=="function"||typeof T.getSnapshotBeforeUpdate=="function";ce||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(I!==c||H!==W)&&lu(t,T,c,W),Ln=!1;var oe=t.memoizedState;T.state=oe,ai(t,c,T,h),H=t.memoizedState,I!==c||oe!==H||gt.current||Ln?(typeof J=="function"&&(Fo(t,i,J,c),H=t.memoizedState),(I=Ln||ou(t,i,I,c,oe,H,W))?(ce||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(t.flags|=4194308)):(typeof T.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=c,t.memoizedState=H),T.props=c,T.state=H,T.context=W,c=I):(typeof T.componentDidMount=="function"&&(t.flags|=4194308),c=!1)}else{T=t.stateNode,nu(e,t),I=t.memoizedProps,W=t.type===t.elementType?I:Qt(t.type,I),T.props=W,ce=t.pendingProps,oe=T.context,H=i.contextType,typeof H=="object"&&H!==null?H=Rt(H):(H=vt(i)?Wn:it.current,H=hr(t,H));var Pe=i.getDerivedStateFromProps;(J=typeof Pe=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(I!==ce||oe!==H)&&lu(t,T,c,H),Ln=!1,oe=t.memoizedState,T.state=oe,ai(t,c,T,h);var re=t.memoizedState;I!==ce||oe!==re||gt.current||Ln?(typeof Pe=="function"&&(Fo(t,i,Pe,c),re=t.memoizedState),(W=Ln||ou(t,i,W,c,oe,re,H)||!1)?(J||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(c,re,H),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(c,re,H)),typeof T.componentDidUpdate=="function"&&(t.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof T.componentDidUpdate!="function"||I===e.memoizedProps&&oe===e.memoizedState||(t.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||I===e.memoizedProps&&oe===e.memoizedState||(t.flags|=1024),t.memoizedProps=c,t.memoizedState=re),T.props=c,T.state=re,T.context=H,c=W):(typeof T.componentDidUpdate!="function"||I===e.memoizedProps&&oe===e.memoizedState||(t.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||I===e.memoizedProps&&oe===e.memoizedState||(t.flags|=1024),c=!1)}return ss(e,t,i,c,y,h)}function ss(e,t,i,c,h,y){Ku(e,t);var T=(t.flags&128)!==0;if(!c&&!T)return h&&Zl(t,i,!1),yn(e,t,y);c=t.stateNode,hp.current=t;var I=T&&typeof i.getDerivedStateFromError!="function"?null:c.render();return t.flags|=1,e!==null&&T?(t.child=xr(t,e.child,null,y),t.child=xr(t,null,I,y)):pt(e,t,I,y),t.memoizedState=c.state,h&&Zl(t,i,!0),t.child}function Qu(e){var t=e.stateNode;t.pendingContext?ql(e,t.pendingContext,t.pendingContext!==t.context):t.context&&ql(e,t.context,!1),Qo(e,t.containerInfo)}function qu(e,t,i,c,h){return br(),Wo(h),t.flags|=256,pt(e,t,i,c),t.child}var bi={dehydrated:null,treeContext:null,retryLane:0};function xi(e){return{baseLanes:e,cachePool:null}}function Xu(e,t,i){var c=t.pendingProps,h=Be.current,y=!1,T=(t.flags&128)!==0,I;if((I=T)||(I=e!==null&&e.memoizedState===null?!1:(h&2)!==0),I?(y=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(h|=1),Ce(Be,h&1),e===null)return Ko(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?Eo(e)?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(h=c.children,e=c.fallback,y?(c=t.mode,y=t.child,h={mode:"hidden",children:h},!(c&1)&&y!==null?(y.childLanes=0,y.pendingProps=h):y=Ui(h,c,0,null),e=nr(e,c,i,null),y.return=t,e.return=t,y.sibling=e,t.child=y,t.child.memoizedState=xi(i),t.memoizedState=bi,e):ls(t,h));if(h=e.memoizedState,h!==null){if(I=h.dehydrated,I!==null){if(T)return t.flags&256?(t.flags&=-257,wi(e,t,i,Error(s(422)))):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(y=c.fallback,h=t.mode,c=Ui({mode:"visible",children:c.children},h,0,null),y=nr(y,h,i,null),y.flags|=2,c.return=t,y.return=t,c.sibling=y,t.child=c,t.mode&1&&xr(t,e.child,null,i),t.child.memoizedState=xi(i),t.memoizedState=bi,y);if(!(t.mode&1))t=wi(e,t,i,null);else if(Eo(I))t=wi(e,t,i,Error(s(419)));else if(c=(i&e.childLanes)!==0,Tt||c){if(c=Ye,c!==null){switch(i&-i){case 4:y=2;break;case 16:y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:y=32;break;case 536870912:y=268435456;break;default:y=0}c=y&(c.suspendedLanes|i)?0:y,c!==0&&c!==h.retryLane&&(h.retryLane=c,jt(e,c,-1))}Ps(),t=wi(e,t,i,Error(s(421)))}else Wl(I)?(t.flags|=128,t.child=e.child,t=Pp.bind(null,e),Lf(I,t),t=null):(i=h.treeContext,te&&(At=If(I),Et=t,ke=!0,qt=null,sa=!1,i!==null&&(It[zt++]=mn,It[zt++]=gn,It[zt++]=Qn,mn=i.id,gn=i.overflow,Qn=t)),t=ls(t,t.pendingProps.children),t.flags|=4096);return t}return y?(c=$u(e,t,c.children,c.fallback,i),y=t.child,h=e.child.memoizedState,y.memoizedState=h===null?xi(i):{baseLanes:h.baseLanes|i,cachePool:null},y.childLanes=e.childLanes&~i,t.memoizedState=bi,c):(i=Zu(e,t,c.children,i),t.memoizedState=null,i)}return y?(c=$u(e,t,c.children,c.fallback,i),y=t.child,h=e.child.memoizedState,y.memoizedState=h===null?xi(i):{baseLanes:h.baseLanes|i,cachePool:null},y.childLanes=e.childLanes&~i,t.memoizedState=bi,c):(i=Zu(e,t,c.children,i),t.memoizedState=null,i)}function ls(e,t){return t=Ui({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Zu(e,t,i,c){var h=e.child;return e=h.sibling,i=Nn(h,{mode:"visible",children:i}),!(t.mode&1)&&(i.lanes=c),i.return=t,i.sibling=null,e!==null&&(c=t.deletions,c===null?(t.deletions=[e],t.flags|=16):c.push(e)),t.child=i}function $u(e,t,i,c,h){var y=t.mode;e=e.child;var T=e.sibling,I={mode:"hidden",children:i};return!(y&1)&&t.child!==e?(i=t.child,i.childLanes=0,i.pendingProps=I,t.deletions=null):(i=Nn(e,I),i.subtreeFlags=e.subtreeFlags&14680064),T!==null?c=Nn(T,c):(c=nr(c,y,h,null),c.flags|=2),c.return=t,i.return=t,i.sibling=c,t.child=i,c}function wi(e,t,i,c){return c!==null&&Wo(c),xr(t,e.child,null,i),e=ls(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Ju(e,t,i){e.lanes|=t;var c=e.alternate;c!==null&&(c.lanes|=t),Do(e.return,t,i)}function us(e,t,i,c,h){var y=e.memoizedState;y===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:c,tail:i,tailMode:h}:(y.isBackwards=t,y.rendering=null,y.renderingStartTime=0,y.last=c,y.tail=i,y.tailMode=h)}function ec(e,t,i){var c=t.pendingProps,h=c.revealOrder,y=c.tail;if(pt(e,t,c.children,i),c=Be.current,c&2)c=c&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Ju(e,i,t);else if(e.tag===19)Ju(e,i,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}c&=1}if(Ce(Be,c),!(t.mode&1))t.memoizedState=null;else switch(h){case"forwards":for(i=t.child,h=null;i!==null;)e=i.alternate,e!==null&&ui(e)===null&&(h=i),i=i.sibling;i=h,i===null?(h=t.child,t.child=null):(h=i.sibling,i.sibling=null),us(t,!1,h,i,y);break;case"backwards":for(i=null,h=t.child,t.child=null;h!==null;){if(e=h.alternate,e!==null&&ui(e)===null){t.child=h;break}e=h.sibling,h.sibling=i,i=h,h=e}us(t,!0,i,null,y);break;case"together":us(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function yn(e,t,i){if(e!==null&&(t.dependencies=e.dependencies),Ar|=t.lanes,!(i&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(s(153));if(t.child!==null){for(e=t.child,i=Nn(e,e.pendingProps),t.child=i,i.return=t;e.sibling!==null;)e=e.sibling,i=i.sibling=Nn(e,e.pendingProps),i.return=t;i.sibling=null}return t.child}function mp(e,t,i){switch(t.tag){case 3:Qu(t),br();break;case 5:gu(t);break;case 1:vt(t.type)&&Qa(t);break;case 4:Qo(t,t.stateNode.containerInfo);break;case 10:tu(t,t.type._context,t.memoizedProps.value);break;case 13:var c=t.memoizedState;if(c!==null)return c.dehydrated!==null?(Ce(Be,Be.current&1),t.flags|=128,null):i&t.child.childLanes?Xu(e,t,i):(Ce(Be,Be.current&1),e=yn(e,t,i),e!==null?e.sibling:null);Ce(Be,Be.current&1);break;case 19:if(c=(i&t.childLanes)!==0,e.flags&128){if(c)return ec(e,t,i);t.flags|=128}var h=t.memoizedState;if(h!==null&&(h.rendering=null,h.tail=null,h.lastEffect=null),Ce(Be,Be.current),c)break;return null;case 22:case 23:return t.lanes=0,Yu(e,t,i)}return yn(e,t,i)}function gp(e,t){switch(Go(t),t.tag){case 1:return vt(t.type)&&Wa(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Sr(),Re(gt),Re(it),Zo(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return qo(t),null;case 13:if(Re(Be),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(s(340));br()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return Re(Be),null;case 4:return Sr(),null;case 10:return Oo(t.type._context),null;case 22:case 23:return Ts(),null;case 24:return null;default:return null}}var Si=!1,Zn=!1,vp=typeof WeakSet=="function"?WeakSet:Set,q=null;function _i(e,t){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(c){xt(e,t,c)}else i.current=null}function tc(e,t,i){try{i()}catch(c){xt(e,t,c)}}var nc=!1;function yp(e,t){for(G(e.containerInfo),q=t;q!==null;)if(e=q,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,q=t;else for(;q!==null;){e=q;try{var i=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(i!==null){var c=i.memoizedProps,h=i.memoizedState,y=e.stateNode,T=y.getSnapshotBeforeUpdate(e.elementType===e.type?c:Qt(e.type,c),h);y.__reactInternalSnapshotBeforeUpdate=T}break;case 3:me&&fr(e.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(I){xt(e,e.return,I)}if(t=e.sibling,t!==null){t.return=e.return,q=t;break}q=e.return}return i=nc,nc=!1,i}function $n(e,t,i){var c=t.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var h=c=c.next;do{if((h.tag&e)===e){var y=h.destroy;h.destroy=void 0,y!==void 0&&tc(t,i,y)}h=h.next}while(h!==c)}}function ba(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var i=t=t.next;do{if((i.tag&e)===e){var c=i.create;i.destroy=c()}i=i.next}while(i!==t)}}function cs(e){var t=e.ref;if(t!==null){var i=e.stateNode;switch(e.tag){case 5:e=le(i);break;default:e=i}typeof t=="function"?t(e):t.current=e}}function rc(e,t,i){if(Jt&&typeof Jt.onCommitFiberUnmount=="function")try{Jt.onCommitFiberUnmount($a,t)}catch{}switch(t.tag){case 0:case 11:case 14:case 15:if(e=t.updateQueue,e!==null&&(e=e.lastEffect,e!==null)){var c=e=e.next;do{var h=c,y=h.destroy;h=h.tag,y!==void 0&&(h&2||h&4)&&tc(t,i,y),c=c.next}while(c!==e)}break;case 1:if(_i(t,i),e=t.stateNode,typeof e.componentWillUnmount=="function")try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(T){xt(t,i,T)}break;case 5:_i(t,i);break;case 4:me?uc(e,t,i):Y&&Y&&(t=t.stateNode.containerInfo,i=Lt(t),An(t,i))}}function ac(e,t,i){for(var c=t;;)if(rc(e,c,i),c.child===null||me&&c.tag===4){if(c===t)break;for(;c.sibling===null;){if(c.return===null||c.return===t)return;c=c.return}c.sibling.return=c.return,c=c.sibling}else c.child.return=c,c=c.child}function ic(e){var t=e.alternate;t!==null&&(e.alternate=null,ic(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&we(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function oc(e){return e.tag===5||e.tag===3||e.tag===4}function sc(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||oc(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function lc(e){if(me){e:{for(var t=e.return;t!==null;){if(oc(t))break e;t=t.return}throw Error(s(160))}var i=t;switch(i.tag){case 5:t=i.stateNode,i.flags&32&&(Q(t),i.flags&=-33),i=sc(e),fs(e,i,t);break;case 3:case 4:t=i.stateNode.containerInfo,i=sc(e),ds(e,i,t);break;default:throw Error(s(161))}}}function ds(e,t,i){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?Ya(i,e,t):wo(i,e);else if(c!==4&&(e=e.child,e!==null))for(ds(e,t,i),e=e.sibling;e!==null;)ds(e,t,i),e=e.sibling}function fs(e,t,i){var c=e.tag;if(c===5||c===6)e=e.stateNode,t?Ga(i,e,t):ta(i,e);else if(c!==4&&(e=e.child,e!==null))for(fs(e,t,i),e=e.sibling;e!==null;)fs(e,t,i),e=e.sibling}function uc(e,t,i){for(var c=t,h=!1,y,T;;){if(!h){h=c.return;e:for(;;){if(h===null)throw Error(s(160));switch(y=h.stateNode,h.tag){case 5:T=!1;break e;case 3:y=y.containerInfo,T=!0;break e;case 4:y=y.containerInfo,T=!0;break e}h=h.return}h=!0}if(c.tag===5||c.tag===6)ac(e,c,i),T?j(y,c.stateNode):na(y,c.stateNode);else if(c.tag===18)T?Df(y,c.stateNode):Of(y,c.stateNode);else if(c.tag===4){if(c.child!==null){y=c.stateNode.containerInfo,T=!0,c.child.return=c,c=c.child;continue}}else if(rc(e,c,i),c.child!==null){c.child.return=c,c=c.child;continue}if(c===t)break;for(;c.sibling===null;){if(c.return===null||c.return===t)return;c=c.return,c.tag===4&&(h=!1)}c.sibling.return=c.return,c=c.sibling}}function ps(e,t){if(me){switch(t.tag){case 0:case 11:case 14:case 15:$n(3,t,t.return),ba(3,t),$n(5,t,t.return);return;case 1:return;case 5:var i=t.stateNode;if(i!=null){var c=t.memoizedProps;e=e!==null?e.memoizedProps:c;var h=t.type,y=t.updateQueue;t.updateQueue=null,y!==null&&_o(i,y,h,e,c,t)}return;case 6:if(t.stateNode===null)throw Error(s(162));i=t.memoizedProps,So(t.stateNode,e!==null?e.memoizedProps:i,i);return;case 3:te&&e!==null&&e.memoizedState.isDehydrated&&Ql(t.stateNode.containerInfo);return;case 12:return;case 13:Ei(t);return;case 19:Ei(t);return;case 17:return}throw Error(s(163))}switch(t.tag){case 0:case 11:case 14:case 15:$n(3,t,t.return),ba(3,t),$n(5,t,t.return);return;case 12:return;case 13:Ei(t);return;case 19:Ei(t);return;case 3:te&&e!==null&&e.memoizedState.isDehydrated&&Ql(t.stateNode.containerInfo);break;case 22:case 23:return}e:if(Y){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,An(t.containerInfo,t.pendingChildren);break e}throw Error(s(163))}}function Ei(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new vp),t.forEach(function(c){var h=Mp.bind(null,e,c);i.has(c)||(i.add(c),c.then(h,h))})}}function bp(e,t){for(q=t;q!==null;){t=q;var i=t.deletions;if(i!==null)for(var c=0;c<i.length;c++){var h=i[c];try{var y=e;me?uc(y,h,t):ac(y,h,t);var T=h.alternate;T!==null&&(T.return=null),h.return=null}catch(ae){xt(h,t,ae)}}if(i=t.child,t.subtreeFlags&12854&&i!==null)i.return=t,q=i;else for(;q!==null;){t=q;try{var I=t.flags;if(I&32&&me&&Q(t.stateNode),I&512){var H=t.alternate;if(H!==null){var W=H.ref;W!==null&&(typeof W=="function"?W(null):W.current=null)}}if(I&8192)switch(t.tag){case 13:if(t.memoizedState!==null){var J=t.alternate;(J===null||J.memoizedState===null)&&(xs=Xe())}break;case 22:var ce=t.memoizedState!==null,oe=t.alternate,Pe=oe!==null&&oe.memoizedState!==null;if(i=t,me){e:if(c=i,h=ce,y=null,me)for(var re=c;;){if(re.tag===5){if(y===null){y=re;var ut=re.stateNode;h?se(ut):ft(re.stateNode,re.memoizedProps)}}else if(re.tag===6){if(y===null){var Ot=re.stateNode;h?Se(Ot):_t(Ot,re.memoizedProps)}}else if((re.tag!==22&&re.tag!==23||re.memoizedState===null||re===c)&&re.child!==null){re.child.return=re,re=re.child;continue}if(re===c)break;for(;re.sibling===null;){if(re.return===null||re.return===c)break e;y===re&&(y=null),re=re.return}y===re&&(y=null),re.sibling.return=re.return,re=re.sibling}}if(ce&&!Pe&&i.mode&1){q=i;for(var D=i.child;D!==null;){for(i=q=D;q!==null;){c=q;var k=c.child;switch(c.tag){case 0:case 11:case 14:case 15:$n(4,c,c.return);break;case 1:_i(c,c.return);var U=c.stateNode;if(typeof U.componentWillUnmount=="function"){var X=c.return;try{U.props=c.memoizedProps,U.state=c.memoizedState,U.componentWillUnmount()}catch(ae){xt(c,X,ae)}}break;case 5:_i(c,c.return);break;case 22:if(c.memoizedState!==null){fc(i);continue}}k!==null?(k.return=c,q=k):fc(i)}D=D.sibling}}}switch(I&4102){case 2:lc(t),t.flags&=-3;break;case 6:lc(t),t.flags&=-3,ps(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,ps(t.alternate,t);break;case 4:ps(t.alternate,t)}}catch(ae){xt(t,t.return,ae)}if(i=t.sibling,i!==null){i.return=t.return,q=i;break}q=t.return}}}function xp(e,t,i){q=e,cc(e)}function cc(e,t,i){for(var c=(e.mode&1)!==0;q!==null;){var h=q,y=h.child;if(h.tag===22&&c){var T=h.memoizedState!==null||Si;if(!T){var I=h.alternate,H=I!==null&&I.memoizedState!==null||Zn;I=Si;var W=Zn;if(Si=T,(Zn=H)&&!W)for(q=h;q!==null;)T=q,H=T.child,T.tag===22&&T.memoizedState!==null?pc(h):H!==null?(H.return=T,q=H):pc(h);for(;y!==null;)q=y,cc(y),y=y.sibling;q=h,Si=I,Zn=W}dc(e)}else h.subtreeFlags&8772&&y!==null?(y.return=h,q=y):dc(e)}}function dc(e){for(;q!==null;){var t=q;if(t.flags&8772){var i=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Zn||ba(5,t);break;case 1:var c=t.stateNode;if(t.flags&4&&!Zn)if(i===null)c.componentDidMount();else{var h=t.elementType===t.type?i.memoizedProps:Qt(t.type,i.memoizedProps);c.componentDidUpdate(h,i.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var y=t.updateQueue;y!==null&&au(t,y,c);break;case 3:var T=t.updateQueue;if(T!==null){if(i=null,t.child!==null)switch(t.child.tag){case 5:i=le(t.child.stateNode);break;case 1:i=t.child.stateNode}au(t,T,i)}break;case 5:var I=t.stateNode;i===null&&t.flags&4&&Va(I,t.type,t.memoizedProps,t);break;case 6:break;case 4:break;case 12:break;case 13:if(te&&t.memoizedState===null){var H=t.alternate;if(H!==null){var W=H.memoizedState;if(W!==null){var J=W.dehydrated;J!==null&&Bf(J)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(s(163))}Zn||t.flags&512&&cs(t)}catch(ce){xt(t,t.return,ce)}}if(t===e){q=null;break}if(i=t.sibling,i!==null){i.return=t.return,q=i;break}q=t.return}}function fc(e){for(;q!==null;){var t=q;if(t===e){q=null;break}var i=t.sibling;if(i!==null){i.return=t.return,q=i;break}q=t.return}}function pc(e){for(;q!==null;){var t=q;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{ba(4,t)}catch(H){xt(t,i,H)}break;case 1:var c=t.stateNode;if(typeof c.componentDidMount=="function"){var h=t.return;try{c.componentDidMount()}catch(H){xt(t,h,H)}}var y=t.return;try{cs(t)}catch(H){xt(t,y,H)}break;case 5:var T=t.return;try{cs(t)}catch(H){xt(t,T,H)}}}catch(H){xt(t,t.return,H)}if(t===e){q=null;break}var I=t.sibling;if(I!==null){I.return=t.return,q=I;break}q=t.return}}var Ai=0,Ti=1,Pi=2,Mi=3,Li=4;if(typeof Symbol=="function"&&Symbol.for){var xa=Symbol.for;Ai=xa("selector.component"),Ti=xa("selector.has_pseudo_class"),Pi=xa("selector.role"),Mi=xa("selector.test_id"),Li=xa("selector.text")}function hs(e){var t=Me(e);if(t!=null){if(typeof t.memoizedProps["data-testname"]!="string")throw Error(s(364));return t}if(e=Fa(e),e===null)throw Error(s(362));return e.stateNode.current}function ms(e,t){switch(t.$$typeof){case Ai:if(e.type===t.value)return!0;break;case Ti:e:{t=t.value,e=[e,0];for(var i=0;i<e.length;){var c=e[i++],h=e[i++],y=t[h];if(c.tag!==5||!En(c)){for(;y!=null&&ms(c,y);)h++,y=t[h];if(h===t.length){t=!0;break e}else for(c=c.child;c!==null;)e.push(c,h),c=c.sibling}}t=!1}return t;case Pi:if(e.tag===5&&bo(e.stateNode,t.value))return!0;break;case Li:if((e.tag===5||e.tag===6)&&(e=ea(e),e!==null&&0<=e.indexOf(t.value)))return!0;break;case Mi:if(e.tag===5&&(e=e.memoizedProps["data-testname"],typeof e=="string"&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(s(365))}return!1}function gs(e){switch(e.$$typeof){case Ai:return"<"+(R(e.value)||"Unknown")+">";case Ti:return":has("+(gs(e)||"")+")";case Pi:return'[role="'+e.value+'"]';case Li:return'"'+e.value+'"';case Mi:return'[data-testname="'+e.value+'"]';default:throw Error(s(365))}}function hc(e,t){var i=[];e=[e,0];for(var c=0;c<e.length;){var h=e[c++],y=e[c++],T=t[y];if(h.tag!==5||!En(h)){for(;T!=null&&ms(h,T);)y++,T=t[y];if(y===t.length)i.push(h);else for(h=h.child;h!==null;)e.push(h,y),h=h.sibling}}return i}function vs(e,t){if(!et)throw Error(s(363));e=hs(e),e=hc(e,t),t=[],e=Array.from(e);for(var i=0;i<e.length;){var c=e[i++];if(c.tag===5)En(c)||t.push(c.stateNode);else for(c=c.child;c!==null;)e.push(c),c=c.sibling}return t}var wp=Math.ceil,Ci=u.ReactCurrentDispatcher,ys=u.ReactCurrentOwner,Ve=u.ReactCurrentBatchConfig,ye=0,Ye=null,Ke=null,tt=0,Pt=0,Er=Pn(0),qe=0,wa=null,Ar=0,Ri=0,bs=0,Sa=null,yt=null,xs=0,ws=1/0;function Tr(){ws=Xe()+500}var Ii=!1,Ss=null,Rn=null,zi=!1,In=null,ki=0,_a=0,_s=null,Ni=-1,ji=0;function ht(){return ye&6?Xe():Ni!==-1?Ni:Ni=Xe()}function zn(e){return e.mode&1?ye&2&&tt!==0?tt&-tt:rp.transition!==null?(ji===0&&(e=qa,qa<<=1,!(qa&4194240)&&(qa=64),ji=e),ji):(e=_e,e!==0?e:Ge()):1}function jt(e,t,i){if(50<_a)throw _a=0,_s=null,Error(s(185));var c=Bi(e,t);return c===null?null:(oa(c,t,i),(!(ye&2)||c!==Ye)&&(c===Ye&&(!(ye&2)&&(Ri|=t),qe===4&&kn(c,tt)),bt(c,i),t===1&&ye===0&&!(e.mode&1)&&(Tr(),Ja&&tn())),c)}function Bi(e,t){e.lanes|=t;var i=e.alternate;for(i!==null&&(i.lanes|=t),i=e,e=e.return;e!==null;)e.childLanes|=t,i=e.alternate,i!==null&&(i.childLanes|=t),i=e,e=e.return;return i.tag===3?i.stateNode:null}function bt(e,t){var i=e.callbackNode;Qf(e,t);var c=Za(e,e===Ye?tt:0);if(c===0)i!==null&&Jl(i),e.callbackNode=null,e.callbackPriority=0;else if(t=c&-c,e.callbackPriority!==t){if(i!=null&&Jl(i),t===1)e.tag===0?np(gc.bind(null,e)):eu(gc.bind(null,e)),Le?je(function(){ye===0&&tn()}):Io(zo,tn),i=null;else{switch($l(c)){case 1:i=zo;break;case 4:i=$f;break;case 16:i=ko;break;case 536870912:i=Jf;break;default:i=ko}i=Ac(i,mc.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function mc(e,t){if(Ni=-1,ji=0,ye&6)throw Error(s(327));var i=e.callbackNode;if(tr()&&e.callbackNode!==i)return null;var c=Za(e,e===Ye?tt:0);if(c===0)return null;if(c&30||c&e.expiredLanes||t)t=Oi(e,c);else{t=c;var h=ye;ye|=2;var y=bc();(Ye!==e||tt!==t)&&(Tr(),Jn(e,t));do try{Ep();break}catch(I){yc(e,I)}while(!0);Bo(),Ci.current=y,ye=h,Ke!==null?t=0:(Ye=null,tt=0,t=qe)}if(t!==0){if(t===2&&(h=Lo(e),h!==0&&(c=h,t=Es(e,h))),t===1)throw i=wa,Jn(e,0),kn(e,c),bt(e,Xe()),i;if(t===6)kn(e,c);else{if(h=e.current.alternate,!(c&30)&&!Sp(h)&&(t=Oi(e,c),t===2&&(y=Lo(e),y!==0&&(c=y,t=Es(e,y))),t===1))throw i=wa,Jn(e,0),kn(e,c),bt(e,Xe()),i;switch(e.finishedWork=h,e.finishedLanes=c,t){case 0:case 1:throw Error(s(345));case 2:er(e,yt);break;case 3:if(kn(e,c),(c&130023424)===c&&(t=xs+500-Xe(),10<t)){if(Za(e,0)!==0)break;if(h=e.suspendedLanes,(h&c)!==c){ht(),e.pingedLanes|=e.suspendedLanes&h;break}e.timeoutHandle=dt(er.bind(null,e,yt),t);break}er(e,yt);break;case 4:if(kn(e,c),(c&4194240)===c)break;for(t=e.eventTimes,h=-1;0<c;){var T=31-Wt(c);y=1<<T,T=t[T],T>h&&(h=T),c&=~y}if(c=h,c=Xe()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*wp(c/1960))-c,10<c){e.timeoutHandle=dt(er.bind(null,e,yt),c);break}er(e,yt);break;case 5:er(e,yt);break;default:throw Error(s(329))}}}return bt(e,Xe()),e.callbackNode===i?mc.bind(null,e):null}function Es(e,t){var i=Sa;return e.current.memoizedState.isDehydrated&&(Jn(e,t).flags|=256),e=Oi(e,t),e!==2&&(t=yt,yt=i,t!==null&&As(t)),e}function As(e){yt===null?yt=e:yt.push.apply(yt,e)}function Sp(e){for(var t=e;;){if(t.flags&16384){var i=t.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var c=0;c<i.length;c++){var h=i[c],y=h.getSnapshot;h=h.value;try{if(!en(y(),h))return!1}catch{return!1}}}if(i=t.child,t.subtreeFlags&16384&&i!==null)i.return=t,t=i;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function kn(e,t){for(t&=~bs,t&=~Ri,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-Wt(t),c=1<<i;e[i]=-1,t&=~c}}function gc(e){if(ye&6)throw Error(s(327));tr();var t=Za(e,0);if(!(t&1))return bt(e,Xe()),null;var i=Oi(e,t);if(e.tag!==0&&i===2){var c=Lo(e);c!==0&&(t=c,i=Es(e,c))}if(i===1)throw i=wa,Jn(e,0),kn(e,t),bt(e,Xe()),i;if(i===6)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,er(e,yt),bt(e,Xe()),null}function vc(e){In!==null&&In.tag===0&&!(ye&6)&&tr();var t=ye;ye|=1;var i=Ve.transition,c=_e;try{if(Ve.transition=null,_e=1,e)return e()}finally{_e=c,Ve.transition=i,ye=t,!(ye&6)&&tn()}}function Ts(){Pt=Er.current,Re(Er)}function Jn(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==_n&&(e.timeoutHandle=_n,Kt(i)),Ke!==null)for(i=Ke.return;i!==null;){var c=i;switch(Go(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&Wa();break;case 3:Sr(),Re(gt),Re(it),Zo();break;case 5:qo(c);break;case 4:Sr();break;case 13:Re(Be);break;case 19:Re(Be);break;case 10:Oo(c.type._context);break;case 22:case 23:Ts()}i=i.return}if(Ye=e,Ke=e=Nn(e.current,null),tt=Pt=t,qe=0,wa=null,bs=Ri=Ar=0,yt=Sa=null,nn!==null){for(t=0;t<nn.length;t++)if(i=nn[t],c=i.interleaved,c!==null){i.interleaved=null;var h=c.next,y=i.pending;if(y!==null){var T=y.next;y.next=h,c.next=T}i.pending=c}nn=null}return e}function yc(e,t){do{var i=Ke;try{if(Bo(),ci.current=gi,di){for(var c=Ue.memoizedState;c!==null;){var h=c.queue;h!==null&&(h.pending=null),c=c.next}di=!1}if(_r=0,Ze=ot=Ue=null,fa=!1,pa=0,ys.current=null,i===null||i.return===null){qe=1,wa=t,Ke=null;break}e:{var y=e,T=i.return,I=i,H=t;if(t=tt,I.flags|=32768,H!==null&&typeof H=="object"&&typeof H.then=="function"){var W=H,J=I,ce=J.tag;if(!(J.mode&1)&&(ce===0||ce===11||ce===15)){var oe=J.alternate;oe?(J.updateQueue=oe.updateQueue,J.memoizedState=oe.memoizedState,J.lanes=oe.lanes):(J.updateQueue=null,J.memoizedState=null)}var Pe=Ou(T);if(Pe!==null){Pe.flags&=-257,Du(Pe,T,I,y,t),Pe.mode&1&&Bu(y,W,t),t=Pe,H=W;var re=t.updateQueue;if(re===null){var ut=new Set;ut.add(H),t.updateQueue=ut}else re.add(H);break e}else{if(!(t&1)){Bu(y,W,t),Ps();break e}H=Error(s(426))}}else if(ke&&I.mode&1){var Ot=Ou(T);if(Ot!==null){!(Ot.flags&65536)&&(Ot.flags|=256),Du(Ot,T,I,y,t),Wo(H);break e}}y=H,qe!==4&&(qe=2),Sa===null?Sa=[y]:Sa.push(y),H=as(H,I),I=T;do{switch(I.tag){case 3:I.flags|=65536,t&=-t,I.lanes|=t;var D=Nu(I,H,t);ru(I,D);break e;case 1:y=H;var k=I.type,U=I.stateNode;if(!(I.flags&128)&&(typeof k.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(Rn===null||!Rn.has(U)))){I.flags|=65536,t&=-t,I.lanes|=t;var X=ju(I,y,t);ru(I,X);break e}}I=I.return}while(I!==null)}wc(i)}catch(ae){t=ae,Ke===i&&i!==null&&(Ke=i=i.return);continue}break}while(!0)}function bc(){var e=Ci.current;return Ci.current=gi,e===null?gi:e}function Ps(){(qe===0||qe===3||qe===2)&&(qe=4),Ye===null||!(Ar&268435455)&&!(Ri&268435455)||kn(Ye,tt)}function Oi(e,t){var i=ye;ye|=2;var c=bc();Ye===e&&tt===t||Jn(e,t);do try{_p();break}catch(h){yc(e,h)}while(!0);if(Bo(),ye=i,Ci.current=c,Ke!==null)throw Error(s(261));return Ye=null,tt=0,qe}function _p(){for(;Ke!==null;)xc(Ke)}function Ep(){for(;Ke!==null&&!Xf();)xc(Ke)}function xc(e){var t=Ec(e.alternate,e,Pt);e.memoizedProps=e.pendingProps,t===null?wc(e):Ke=t,ys.current=null}function wc(e){var t=e;do{var i=t.alternate;if(e=t.return,t.flags&32768){if(i=gp(i,t),i!==null){i.flags&=32767,Ke=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{qe=6,Ke=null;return}}else if(i=pp(i,t,Pt),i!==null){Ke=i;return}if(t=t.sibling,t!==null){Ke=t;return}Ke=t=e}while(t!==null);qe===0&&(qe=5)}function er(e,t){var i=_e,c=Ve.transition;try{Ve.transition=null,_e=1,Ap(e,t,i)}finally{Ve.transition=c,_e=i}return null}function Ap(e,t,i){do tr();while(In!==null);if(ye&6)throw Error(s(327));var c=e.finishedWork,h=e.finishedLanes;if(c===null)return null;if(e.finishedWork=null,e.finishedLanes=0,c===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var y=c.lanes|c.childLanes;if(qf(e,y),e===Ye&&(Ke=Ye=null,tt=0),!(c.subtreeFlags&2064)&&!(c.flags&2064)||zi||(zi=!0,Ac(ko,function(){return tr(),null})),y=(c.flags&15990)!==0,c.subtreeFlags&15990||y){y=Ve.transition,Ve.transition=null;var T=_e;_e=1;var I=ye;ye|=4,ys.current=null,yp(e,c),bp(e,c),ee(e.containerInfo),e.current=c,xp(c),Zf(),ye=I,_e=T,Ve.transition=y}else e.current=c;if(zi&&(zi=!1,In=e,ki=h),y=e.pendingLanes,y===0&&(Rn=null),ep(c.stateNode),bt(e,Xe()),t!==null)for(i=e.onRecoverableError,c=0;c<t.length;c++)i(t[c]);if(Ii)throw Ii=!1,e=Ss,Ss=null,e;return ki&1&&e.tag!==0&&tr(),y=e.pendingLanes,y&1?e===_s?_a++:(_a=0,_s=e):_a=0,tn(),null}function tr(){if(In!==null){var e=$l(ki),t=Ve.transition,i=_e;try{if(Ve.transition=null,_e=16>e?16:e,In===null)var c=!1;else{if(e=In,In=null,ki=0,ye&6)throw Error(s(331));var h=ye;for(ye|=4,q=e.current;q!==null;){var y=q,T=y.child;if(q.flags&16){var I=y.deletions;if(I!==null){for(var H=0;H<I.length;H++){var W=I[H];for(q=W;q!==null;){var J=q;switch(J.tag){case 0:case 11:case 15:$n(8,J,y)}var ce=J.child;if(ce!==null)ce.return=J,q=ce;else for(;q!==null;){J=q;var oe=J.sibling,Pe=J.return;if(ic(J),J===W){q=null;break}if(oe!==null){oe.return=Pe,q=oe;break}q=Pe}}}var re=y.alternate;if(re!==null){var ut=re.child;if(ut!==null){re.child=null;do{var Ot=ut.sibling;ut.sibling=null,ut=Ot}while(ut!==null)}}q=y}}if(y.subtreeFlags&2064&&T!==null)T.return=y,q=T;else e:for(;q!==null;){if(y=q,y.flags&2048)switch(y.tag){case 0:case 11:case 15:$n(9,y,y.return)}var D=y.sibling;if(D!==null){D.return=y.return,q=D;break e}q=y.return}}var k=e.current;for(q=k;q!==null;){T=q;var U=T.child;if(T.subtreeFlags&2064&&U!==null)U.return=T,q=U;else e:for(T=k;q!==null;){if(I=q,I.flags&2048)try{switch(I.tag){case 0:case 11:case 15:ba(9,I)}}catch(ae){xt(I,I.return,ae)}if(I===T){q=null;break e}var X=I.sibling;if(X!==null){X.return=I.return,q=X;break e}q=I.return}}if(ye=h,tn(),Jt&&typeof Jt.onPostCommitFiberRoot=="function")try{Jt.onPostCommitFiberRoot($a,e)}catch{}c=!0}return c}finally{_e=i,Ve.transition=t}}return!1}function Sc(e,t,i){t=as(i,t),t=Nu(e,t,1),Cn(e,t),t=ht(),e=Bi(e,1),e!==null&&(oa(e,1,t),bt(e,t))}function xt(e,t,i){if(e.tag===3)Sc(e,e,i);else for(;t!==null;){if(t.tag===3){Sc(t,e,i);break}else if(t.tag===1){var c=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Rn===null||!Rn.has(c))){e=as(i,e),e=ju(t,e,1),Cn(t,e),e=ht(),t=Bi(t,1),t!==null&&(oa(t,1,e),bt(t,e));break}}t=t.return}}function Tp(e,t,i){var c=e.pingCache;c!==null&&c.delete(t),t=ht(),e.pingedLanes|=e.suspendedLanes&i,Ye===e&&(tt&i)===i&&(qe===4||qe===3&&(tt&130023424)===tt&&500>Xe()-xs?Jn(e,0):bs|=i),bt(e,t)}function _c(e,t){t===0&&(e.mode&1?(t=Xa,Xa<<=1,!(Xa&130023424)&&(Xa=4194304)):t=1);var i=ht();e=Bi(e,t),e!==null&&(oa(e,t,i),bt(e,i))}function Pp(e){var t=e.memoizedState,i=0;t!==null&&(i=t.retryLane),_c(e,i)}function Mp(e,t){var i=0;switch(e.tag){case 13:var c=e.stateNode,h=e.memoizedState;h!==null&&(i=h.retryLane);break;case 19:c=e.stateNode;break;default:throw Error(s(314))}c!==null&&c.delete(t),_c(e,i)}var Ec;Ec=function(e,t,i){if(e!==null)if(e.memoizedProps!==t.pendingProps||gt.current)Tt=!0;else{if(!(e.lanes&i)&&!(t.flags&128))return Tt=!1,mp(e,t,i);Tt=!!(e.flags&131072)}else Tt=!1,ke&&t.flags&1048576&&uu(t,si,t.index);switch(t.lanes=0,t.tag){case 2:var c=t.type;e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var h=hr(t,it.current);gr(t,i),h=Jo(null,t,c,e,h,i);var y=es();return t.flags|=1,typeof h=="object"&&h!==null&&typeof h.render=="function"&&h.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,vt(c)?(y=!0,Qa(t)):y=!1,t.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,Uo(t),h.updater=ii,t.stateNode=h,h._reactInternals=t,Ho(t,c,e,i),t=ss(null,t,c,!0,y,i)):(t.tag=0,ke&&y&&Vo(t),pt(null,t,h,i),t=t.child),t;case 16:c=t.elementType;e:{switch(e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,h=c._init,c=h(c._payload),t.type=c,h=t.tag=Cp(c),e=Qt(c,e),h){case 0:t=os(null,t,c,e,i);break e;case 1:t=Wu(null,t,c,e,i);break e;case 11:t=Hu(null,t,c,e,i);break e;case 14:t=Vu(null,t,c,Qt(c.type,e),i);break e}throw Error(s(306,c,""))}return t;case 0:return c=t.type,h=t.pendingProps,h=t.elementType===c?h:Qt(c,h),os(e,t,c,h,i);case 1:return c=t.type,h=t.pendingProps,h=t.elementType===c?h:Qt(c,h),Wu(e,t,c,h,i);case 3:e:{if(Qu(t),e===null)throw Error(s(387));c=t.pendingProps,y=t.memoizedState,h=y.element,nu(e,t),ai(t,c,null,i);var T=t.memoizedState;if(c=T.element,te&&y.isDehydrated)if(y={element:c,isDehydrated:!1,cache:T.cache,transitions:T.transitions},t.updateQueue.baseState=y,t.memoizedState=y,t.flags&256){h=Error(s(423)),t=qu(e,t,c,i,h);break e}else if(c!==h){h=Error(s(424)),t=qu(e,t,c,i,h);break e}else for(te&&(At=Rf(t.stateNode.containerInfo),Et=t,ke=!0,qt=null,sa=!1),i=mu(t,null,c,i),t.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(br(),c===h){t=yn(e,t,i);break e}pt(e,t,c,i)}t=t.child}return t;case 5:return gu(t),e===null&&Ko(t),c=t.type,h=t.pendingProps,y=e!==null?e.memoizedProps:null,T=h.children,ze(c,h)?T=null:y!==null&&ze(c,y)&&(t.flags|=32),Ku(e,t),pt(e,t,T,i),t.child;case 6:return e===null&&Ko(t),null;case 13:return Xu(e,t,i);case 4:return Qo(t,t.stateNode.containerInfo),c=t.pendingProps,e===null?t.child=xr(t,null,c,i):pt(e,t,c,i),t.child;case 11:return c=t.type,h=t.pendingProps,h=t.elementType===c?h:Qt(c,h),Hu(e,t,c,h,i);case 7:return pt(e,t,t.pendingProps,i),t.child;case 8:return pt(e,t,t.pendingProps.children,i),t.child;case 12:return pt(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(c=t.type._context,h=t.pendingProps,y=t.memoizedProps,T=h.value,tu(t,c,T),y!==null)if(en(y.value,T)){if(y.children===h.children&&!gt.current){t=yn(e,t,i);break e}}else for(y=t.child,y!==null&&(y.return=t);y!==null;){var I=y.dependencies;if(I!==null){T=y.child;for(var H=I.firstContext;H!==null;){if(H.context===c){if(y.tag===1){H=hn(-1,i&-i),H.tag=2;var W=y.updateQueue;if(W!==null){W=W.shared;var J=W.pending;J===null?H.next=H:(H.next=J.next,J.next=H),W.pending=H}}y.lanes|=i,H=y.alternate,H!==null&&(H.lanes|=i),Do(y.return,i,t),I.lanes|=i;break}H=H.next}}else if(y.tag===10)T=y.type===t.type?null:y.child;else if(y.tag===18){if(T=y.return,T===null)throw Error(s(341));T.lanes|=i,I=T.alternate,I!==null&&(I.lanes|=i),Do(T,i,t),T=y.sibling}else T=y.child;if(T!==null)T.return=y;else for(T=y;T!==null;){if(T===t){T=null;break}if(y=T.sibling,y!==null){y.return=T.return,T=y;break}T=T.return}y=T}pt(e,t,h.children,i),t=t.child}return t;case 9:return h=t.type,c=t.pendingProps.children,gr(t,i),h=Rt(h),c=c(h),t.flags|=1,pt(e,t,c,i),t.child;case 14:return c=t.type,h=Qt(c,t.pendingProps),h=Qt(c.type,h),Vu(e,t,c,h,i);case 15:return Gu(e,t,t.type,t.pendingProps,i);case 17:return c=t.type,h=t.pendingProps,h=t.elementType===c?h:Qt(c,h),e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,vt(c)?(e=!0,Qa(t)):e=!1,gr(t,i),su(t,c,h),Ho(t,c,h,i),ss(null,t,c,!0,e,i);case 19:return ec(e,t,i);case 22:return Yu(e,t,i)}throw Error(s(156,t.tag))};function Ac(e,t){return Io(e,t)}function Lp(e,t,i,c){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bt(e,t,i,c){return new Lp(e,t,i,c)}function Ms(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Cp(e){if(typeof e=="function")return Ms(e)?1:0;if(e!=null){if(e=e.$$typeof,e===A)return 11;if(e===x)return 14}return 2}function Nn(e,t){var i=e.alternate;return i===null?(i=Bt(e.tag,t,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Di(e,t,i,c,h,y){var T=2;if(c=e,typeof e=="function")Ms(e)&&(T=1);else if(typeof e=="string")T=5;else e:switch(e){case p:return nr(i.children,h,y,t);case m:T=8,h|=8;break;case g:return e=Bt(12,i,t,h|2),e.elementType=g,e.lanes=y,e;case _:return e=Bt(13,i,t,h),e.elementType=_,e.lanes=y,e;case w:return e=Bt(19,i,t,h),e.elementType=w,e.lanes=y,e;case E:return Ui(i,h,y,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case v:T=10;break e;case b:T=9;break e;case A:T=11;break e;case x:T=14;break e;case S:T=16,c=null;break e}throw Error(s(130,e==null?e:typeof e,""))}return t=Bt(T,i,t,h),t.elementType=e,t.type=c,t.lanes=y,t}function nr(e,t,i,c){return e=Bt(7,e,c,t),e.lanes=i,e}function Ui(e,t,i,c){return e=Bt(22,e,c,t),e.elementType=E,e.lanes=i,e.stateNode={},e}function Ls(e,t,i){return e=Bt(6,e,null,t),e.lanes=i,e}function Cs(e,t,i){return t=Bt(4,e.children!==null?e.children:[],e.key,t),t.lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Rp(e,t,i,c,h){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=_n,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Co(0),this.expirationTimes=Co(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Co(0),this.identifierPrefix=c,this.onRecoverableError=h,te&&(this.mutableSourceEagerHydrationData=null)}function Tc(e,t,i,c,h,y,T,I,H){return e=new Rp(e,t,i,I,H),t===1?(t=1,y===!0&&(t|=8)):t=0,y=Bt(3,null,null,t),e.current=y,y.stateNode=e,y.memoizedState={element:c,isDehydrated:i,cache:null,transitions:null},Uo(y),e}function Pc(e){if(!e)return Mn;e=e._reactInternals;e:{if(N(e)!==e||e.tag!==1)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(vt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(s(171))}if(e.tag===1){var i=e.type;if(vt(i))return Xl(e,i,t)}return t}function Mc(e){var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(s(188)):(e=Object.keys(e).join(","),Error(s(268,e)));return e=B(t),e===null?null:e.stateNode}function Lc(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<t?i:t}}function Rs(e,t){Lc(e,t),(e=e.alternate)&&Lc(e,t)}function Ip(e){return e=B(e),e===null?null:e.stateNode}function zp(){return null}return r.attemptContinuousHydration=function(e){if(e.tag===13){var t=ht();jt(e,134217728,t),Rs(e,134217728)}},r.attemptHydrationAtCurrentPriority=function(e){if(e.tag===13){var t=ht(),i=zn(e);jt(e,i,t),Rs(e,i)}},r.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=ia(t.pendingLanes);i!==0&&(Ro(t,i|1),bt(t,Xe()),!(ye&6)&&(Tr(),tn()))}break;case 13:var c=ht();vc(function(){return jt(e,1,c)}),Rs(e,1)}},r.batchedUpdates=function(e,t){var i=ye;ye|=1;try{return e(t)}finally{ye=i,ye===0&&(Tr(),Ja&&tn())}},r.createComponentSelector=function(e){return{$$typeof:Ai,value:e}},r.createContainer=function(e,t,i,c,h,y,T){return Tc(e,t,!1,null,i,c,h,y,T)},r.createHasPseudoClassSelector=function(e){return{$$typeof:Ti,value:e}},r.createHydrationContainer=function(e,t,i,c,h,y,T,I,H){return e=Tc(i,c,!0,e,h,y,T,I,H),e.context=Pc(null),i=e.current,c=ht(),h=zn(i),y=hn(c,h),y.callback=t??null,Cn(i,y),e.current.lanes=h,oa(e,h,c),bt(e,c),e},r.createPortal=function(e,t,i){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:d,key:c==null?null:""+c,children:e,containerInfo:t,implementation:i}},r.createRoleSelector=function(e){return{$$typeof:Pi,value:e}},r.createTestNameSelector=function(e){return{$$typeof:Mi,value:e}},r.createTextSelector=function(e){return{$$typeof:Li,value:e}},r.deferredUpdates=function(e){var t=_e,i=Ve.transition;try{return Ve.transition=null,_e=16,e()}finally{_e=t,Ve.transition=i}},r.discreteUpdates=function(e,t,i,c,h){var y=_e,T=Ve.transition;try{return Ve.transition=null,_e=1,e(t,i,c,h)}finally{_e=y,Ve.transition=T,ye===0&&Tr()}},r.findAllNodes=vs,r.findBoundingRects=function(e,t){if(!et)throw Error(s(363));t=vs(e,t),e=[];for(var i=0;i<t.length;i++)e.push(Jr(t[i]));for(t=e.length-1;0<t;t--){i=e[t];for(var c=i.x,h=c+i.width,y=i.y,T=y+i.height,I=t-1;0<=I;I--)if(t!==I){var H=e[I],W=H.x,J=W+H.width,ce=H.y,oe=ce+H.height;if(c>=W&&y>=ce&&h<=J&&T<=oe){e.splice(t,1);break}else if(c!==W||i.width!==H.width||oe<y||ce>T){if(!(y!==ce||i.height!==H.height||J<c||W>h)){W>c&&(H.width+=W-c,H.x=c),J<h&&(H.width=h-W),e.splice(t,1);break}}else{ce>y&&(H.height+=ce-y,H.y=y),oe<T&&(H.height=T-ce),e.splice(t,1);break}}}return e},r.findHostInstance=Mc,r.findHostInstanceWithNoPortals=function(e){return e=O(e),e=e!==null?K(e):null,e===null?null:e.stateNode},r.findHostInstanceWithWarning=function(e){return Mc(e)},r.flushControlled=function(e){var t=ye;ye|=1;var i=Ve.transition,c=_e;try{Ve.transition=null,_e=1,e()}finally{_e=c,Ve.transition=i,ye=t,ye===0&&(Tr(),tn())}},r.flushPassiveEffects=tr,r.flushSync=vc,r.focusWithin=function(e,t){if(!et)throw Error(s(363));for(e=hs(e),t=hc(e,t),t=Array.from(t),e=0;e<t.length;){var i=t[e++];if(!En(i)){if(i.tag===5&&xo(i.stateNode))return!0;for(i=i.child;i!==null;)t.push(i),i=i.sibling}}return!1},r.getCurrentUpdatePriority=function(){return _e},r.getFindAllNodesFailureDescription=function(e,t){if(!et)throw Error(s(363));var i=0,c=[];e=[hs(e),0];for(var h=0;h<e.length;){var y=e[h++],T=e[h++],I=t[T];if((y.tag!==5||!En(y))&&(ms(y,I)&&(c.push(gs(I)),T++,T>i&&(i=T)),T<t.length))for(y=y.child;y!==null;)e.push(y,T),y=y.sibling}if(i<t.length){for(e=[];i<t.length;i++)e.push(gs(t[i]));return`findAllNodes was able to match part of the selector:
  `+(c.join(" > ")+`

No matching component was found for:
  `)+e.join(" > ")}return null},r.getPublicRootInstance=function(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return le(e.child.stateNode);default:return e.child.stateNode}},r.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:u.ReactCurrentDispatcher,findHostInstanceByFiber:Ip,findFiberByHostInstance:e.findFiberByHostInstance||zp,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{$a=t.inject(e),Jt=t}catch{}e=!!t.checkDCE}}return e},r.isAlreadyRendering=function(){return!1},r.observeVisibleRects=function(e,t,i,c){if(!et)throw Error(s(363));e=vs(e,t);var h=Ha(e,i,c).disconnect;return{disconnect:function(){h()}}},r.registerMutableSourceForHydration=function(e,t){var i=t._getVersion;i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i)},r.runWithPriority=function(e,t){var i=_e;try{return _e=e,t()}finally{_e=i}},r.shouldError=function(){return null},r.shouldSuspend=function(){return!1},r.updateContainer=function(e,t,i,c){var h=t.current,y=ht(),T=zn(h);return i=Pc(i),t.context===null?t.context=i:t.pendingContext=i,t=hn(y,T),t.payload={element:e},c=c===void 0?null:c,c!==null&&(t.callback=c),Cn(h,t),e=jt(h,T,y),e!==null&&ri(e,h,T),T},r};Vd.exports=kh;var Nh=Vd.exports;const jh=Id(Nh),Bh=a=>typeof a=="object"&&typeof a.then=="function",Fi=[];function Oh(a,r,n=(l,o)=>l===o){if(a===r)return!0;if(!a||!r)return!1;const l=a.length;if(r.length!==l)return!1;for(let o=0;o<l;o++)if(!n(a[o],r[o]))return!1;return!0}function Dh(a,r=null,n=!1,l={}){r===null&&(r=[a]);for(const s of Fi)if(Oh(r,s.keys,s.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return l.lifespan&&l.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,l.lifespan)),s.response;if(!n)throw s.promise}const o={keys:r,equal:l.equal,remove:()=>{const s=Fi.indexOf(o);s!==-1&&Fi.splice(s,1)},promise:(Bh(a)?a:a(...r)).then(s=>{o.response=s,l.lifespan&&l.lifespan>0&&(o.timeout=setTimeout(o.remove,l.lifespan))}).catch(s=>o.error=s)};if(Fi.push(o),!n)throw o.promise}const kc=(a,r,n)=>Dh(a,r,!1,n),jl={},Bl=a=>void Object.assign(jl,a);function Uh(a,r){function n(p,{args:m=[],attach:g,...v},b){let A=`${p[0].toUpperCase()}${p.slice(1)}`,_;if(p==="primitive"){if(v.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const w=v.object;_=Hr(w,{type:p,root:b,attach:g,primitive:!0})}else{const w=jl[A];if(!w)throw new Error(`R3F: ${A} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(m))throw new Error("R3F: The args prop must be an array!");_=Hr(new w(...m),{type:p,root:b,attach:g,memoizedProps:{args:m}})}return _.__r3f.attach===void 0&&(_ instanceof zl?_.__r3f.attach="geometry":_ instanceof uo&&(_.__r3f.attach="material")),A!=="inject"&&js(_,v),_}function l(p,m){let g=!1;if(m){var v,b;(v=m.__r3f)!=null&&v.attach?Ns(p,m,m.__r3f.attach):m.isObject3D&&p.isObject3D&&(p.add(m),g=!0),g||(b=p.__r3f)==null||b.objects.push(m),m.__r3f||Hr(m,{}),m.__r3f.parent=p,gl(m),Vr(m)}}function o(p,m,g){let v=!1;if(m){var b,A;if((b=m.__r3f)!=null&&b.attach)Ns(p,m,m.__r3f.attach);else if(m.isObject3D&&p.isObject3D){m.parent=p,m.dispatchEvent({type:"added"});const _=p.children.filter(x=>x!==m),w=_.indexOf(g);p.children=[..._.slice(0,w),m,..._.slice(w)],v=!0}v||(A=p.__r3f)==null||A.objects.push(m),m.__r3f||Hr(m,{}),m.__r3f.parent=p,gl(m),Vr(m)}}function s(p,m,g=!1){p&&[...p].forEach(v=>u(m,v,g))}function u(p,m,g){if(m){var v,b,A;if(m.__r3f&&(m.__r3f.parent=null),(v=p.__r3f)!=null&&v.objects&&(p.__r3f.objects=p.__r3f.objects.filter(E=>E!==m)),(b=m.__r3f)!=null&&b.attach)Dc(p,m,m.__r3f.attach);else if(m.isObject3D&&p.isObject3D){var _;p.remove(m),(_=m.__r3f)!=null&&_.root&&Kh(co(m),m)}const x=(A=m.__r3f)==null?void 0:A.primitive,S=!x&&(g===void 0?m.dispose!==null:g);if(!x){var w;s((w=m.__r3f)==null?void 0:w.objects,m,S),s(m.children,m,S)}if(delete m.__r3f,S&&m.dispose&&m.type!=="Scene"){const E=()=>{try{m.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?hl.unstable_scheduleCallback(hl.unstable_IdlePriority,E):E()}Vr(p)}}function f(p,m,g,v){var b;const A=(b=p.__r3f)==null?void 0:b.parent;if(!A)return;const _=n(m,g,p.__r3f.root);if(p.children){for(const w of p.children)w.__r3f&&l(_,w);p.children=p.children.filter(w=>!w.__r3f)}p.__r3f.objects.forEach(w=>l(_,w)),p.__r3f.objects=[],p.__r3f.autoRemovedBeforeAppend||u(A,p),_.parent&&(_.__r3f.autoRemovedBeforeAppend=!0),l(A,_),_.raycast&&_.__r3f.eventCount&&co(_).getState().internal.interaction.push(_),[v,v.alternate].forEach(w=>{w!==null&&(w.stateNode=_,w.ref&&(typeof w.ref=="function"?w.ref(_):w.ref.current=_))})}const d=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:jh({createInstance:n,removeChild:u,appendChild:l,appendInitialChild:l,insertBefore:o,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(p,m)=>{if(!m)return;const g=p.getState().scene;g.__r3f&&(g.__r3f.root=p,l(g,m))},removeChildFromContainer:(p,m)=>{m&&u(p.getState().scene,m)},insertInContainerBefore:(p,m,g)=>{if(!m||!g)return;const v=p.getState().scene;v.__r3f&&o(v,m,g)},getRootHostContext:()=>null,getChildHostContext:p=>p,finalizeInitialChildren(p){var m;return!!((m=p==null?void 0:p.__r3f)!=null?m:{}).handlers},prepareUpdate(p,m,g,v){var b;if(((b=p==null?void 0:p.__r3f)!=null?b:{}).primitive&&v.object&&v.object!==p)return[!0];{const{args:A=[],children:_,...w}=v,{args:x=[],children:S,...E}=g;if(!Array.isArray(A))throw new Error("R3F: the args prop must be an array!");if(A.some((M,R)=>M!==x[R]))return[!0];const P=$d(p,w,E,!0);return P.changes.length?[!1,P]:null}},commitUpdate(p,[m,g],v,b,A,_){m?f(p,v,A,_):js(p,g)},commitMount(p,m,g,v){var b;const A=(b=p.__r3f)!=null?b:{};p.raycast&&A.handlers&&A.eventCount&&co(p).getState().internal.interaction.push(p)},getPublicInstance:p=>p,prepareForCommit:()=>null,preparePortalMount:p=>Hr(p.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(p){var m;const{attach:g,parent:v}=(m=p.__r3f)!=null?m:{};g&&v&&Dc(v,p,g),p.isObject3D&&(p.visible=!1),Vr(p)},unhideInstance(p,m){var g;const{attach:v,parent:b}=(g=p.__r3f)!=null?g:{};v&&b&&Ns(b,p,v),(p.isObject3D&&m.visible==null||m.visible)&&(p.visible=!0),Vr(p)},createTextInstance:d,hideTextInstance:d,unhideTextInstance:d,getCurrentEventPriority:()=>r?r():Kr.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Ne.fun(performance.now)?performance.now:Ne.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Ne.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Ne.fun(clearTimeout)?clearTimeout:void 0}),applyProps:js}}var Nc,jc;const ks=a=>"colorSpace"in a||"outputColorSpace"in a,Kd=()=>{var a;return(a=jl.ColorManagement)!=null?a:null},Wd=a=>a&&a.isOrthographicCamera,Fh=a=>a&&a.hasOwnProperty("current"),Ua=typeof window<"u"&&((Nc=window.document)!=null&&Nc.createElement||((jc=window.navigator)==null?void 0:jc.product)==="ReactNative")?z.useLayoutEffect:z.useEffect;function Qd(a){const r=z.useRef(a);return Ua(()=>void(r.current=a),[a]),r}function Hh({set:a}){return Ua(()=>(a(new Promise(()=>null)),()=>a(!1)),[a]),null}class qd extends z.Component{constructor(...r){super(...r),this.state={error:!1}}componentDidCatch(r){this.props.set(r)}render(){return this.state.error?null:this.props.children}}qd.getDerivedStateFromError=()=>({error:!0});const Xd="__default",Bc=new Map,Vh=a=>a&&!!a.memoized&&!!a.changes;function Zd(a){var r;const n=typeof window<"u"?(r=window.devicePixelRatio)!=null?r:2:1;return Array.isArray(a)?Math.min(Math.max(a[0],n),a[1]):a}const Ea=a=>{var r;return(r=a.__r3f)==null?void 0:r.root.getState()};function co(a){let r=a.__r3f.root;for(;r.getState().previousRoot;)r=r.getState().previousRoot;return r}const Ne={obj:a=>a===Object(a)&&!Ne.arr(a)&&typeof a!="function",fun:a=>typeof a=="function",str:a=>typeof a=="string",num:a=>typeof a=="number",boo:a=>typeof a=="boolean",und:a=>a===void 0,arr:a=>Array.isArray(a),equ(a,r,{arrays:n="shallow",objects:l="reference",strict:o=!0}={}){if(typeof a!=typeof r||!!a!=!!r)return!1;if(Ne.str(a)||Ne.num(a))return a===r;const s=Ne.obj(a);if(s&&l==="reference")return a===r;const u=Ne.arr(a);if(u&&n==="reference")return a===r;if((u||s)&&a===r)return!0;let f;for(f in a)if(!(f in r))return!1;if(s&&n==="shallow"&&l==="shallow"){for(f in o?r:a)if(!Ne.equ(a[f],r[f],{strict:o,objects:"reference"}))return!1}else for(f in o?r:a)if(a[f]!==r[f])return!1;if(Ne.und(f)){if(u&&a.length===0&&r.length===0||s&&Object.keys(a).length===0&&Object.keys(r).length===0)return!0;if(a!==r)return!1}return!0}};function Gh(a){a.dispose&&a.type!=="Scene"&&a.dispose();for(const r in a)r.dispose==null||r.dispose(),delete a[r]}function Hr(a,r){const n=a;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...r},a}function ml(a,r){let n=a;if(r.includes("-")){const l=r.split("-"),o=l.pop();return n=l.reduce((s,u)=>s[u],a),{target:n,key:o}}else return{target:n,key:r}}const Oc=/-\d+$/;function Ns(a,r,n){if(Ne.str(n)){if(Oc.test(n)){const s=n.replace(Oc,""),{target:u,key:f}=ml(a,s);Array.isArray(u[f])||(u[f]=[])}const{target:l,key:o}=ml(a,n);r.__r3f.previousAttach=l[o],l[o]=r}else r.__r3f.previousAttach=n(a,r)}function Dc(a,r,n){var l,o;if(Ne.str(n)){const{target:s,key:u}=ml(a,n),f=r.__r3f.previousAttach;f===void 0?delete s[u]:s[u]=f}else(l=r.__r3f)==null||l.previousAttach==null||l.previousAttach(a,r);(o=r.__r3f)==null||delete o.previousAttach}function $d(a,{children:r,key:n,ref:l,...o},{children:s,key:u,ref:f,...d}={},p=!1){var m;const g=(m=a==null?void 0:a.__r3f)!=null?m:{},v=Object.entries(o),b=[];if(p){const _=Object.keys(d);for(let w=0;w<_.length;w++)o.hasOwnProperty(_[w])||v.unshift([_[w],Xd+"remove"])}v.forEach(([_,w])=>{var x;if((x=a.__r3f)!=null&&x.primitive&&_==="object"||Ne.equ(w,d[_]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(_))return b.push([_,w,!0,[]]);let S=[];_.includes("-")&&(S=_.split("-")),b.push([_,w,!1,S]);for(const E in o){const P=o[E];E.startsWith(`${_}-`)&&b.push([E,P,!1,E.split("-")])}});const A={...o};return g.memoizedProps&&g.memoizedProps.args&&(A.args=g.memoizedProps.args),g.memoizedProps&&g.memoizedProps.attach&&(A.attach=g.memoizedProps.attach),{memoized:A,changes:b}}function js(a,r){var n,l,o;const s=(n=a.__r3f)!=null?n:{},u=s.root,f=(l=u==null||u.getState==null?void 0:u.getState())!=null?l:{},{memoized:d,changes:p}=Vh(r)?r:$d(a,r),m=s.eventCount;a.__r3f&&(a.__r3f.memoizedProps=d);for(let g=0;g<p.length;g++){let[v,b,A,_]=p[g];if(ks(a)){const S="srgb",E="srgb-linear";v==="encoding"?(v="colorSpace",b=b===3001?S:E):v==="outputEncoding"&&(v="outputColorSpace",b=b===3001?S:E)}let w=a,x=w[v];if(_.length&&(x=_.reduce((S,E)=>S[E],a),!(x&&x.set))){const[S,...E]=_.reverse();w=E.reverse().reduce((P,M)=>P[M],a),v=S}if(b===Xd+"remove")if(w.constructor){let S=Bc.get(w.constructor);S||(S=new w.constructor,Bc.set(w.constructor,S)),b=S[v]}else b=0;if(A)b?s.handlers[v]=b:delete s.handlers[v],s.eventCount=Object.keys(s.handlers).length;else if(x&&x.set&&(x.copy||x instanceof zs)){if(Array.isArray(b))x.fromArray?x.fromArray(b):x.set(...b);else if(x.copy&&b&&b.constructor&&x.constructor===b.constructor)x.copy(b);else if(b!==void 0){const S=x instanceof xn;!S&&x.setScalar?x.setScalar(b):x instanceof zs&&b instanceof zs?x.mask=b.mask:x.set(b),!Kd()&&!f.linear&&S&&x.convertSRGBToLinear()}}else if(w[v]=b,w[v]instanceof ul&&w[v].format===Wp&&w[v].type===Qp){const S=w[v];ks(S)&&ks(f.gl)?S.colorSpace=f.gl.outputColorSpace:S.encoding=f.gl.outputEncoding}Vr(a)}if(s.parent&&a.raycast&&m!==s.eventCount){const g=co(a).getState().internal,v=g.interaction.indexOf(a);v>-1&&g.interaction.splice(v,1),s.eventCount&&g.interaction.push(a)}return!(p.length===1&&p[0][0]==="onUpdate")&&p.length&&(o=a.__r3f)!=null&&o.parent&&gl(a),a}function Vr(a){var r,n;const l=(r=a.__r3f)==null||(n=r.root)==null||n.getState==null?void 0:n.getState();l&&l.internal.frames===0&&l.invalidate()}function gl(a){a.onUpdate==null||a.onUpdate(a)}function Jd(a,r){a.manual||(Wd(a)?(a.left=r.width/-2,a.right=r.width/2,a.top=r.height/2,a.bottom=r.height/-2):a.aspect=r.width/r.height,a.updateProjectionMatrix(),a.updateMatrixWorld())}function Hi(a){return(a.eventObject||a.object).uuid+"/"+a.index+a.instanceId}function Yh(){var a;const r=typeof self<"u"&&self||typeof window<"u"&&window;if(!r)return Kr.DefaultEventPriority;switch((a=r.event)==null?void 0:a.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Kr.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Kr.ContinuousEventPriority;default:return Kr.DefaultEventPriority}}function ef(a,r,n,l){const o=n.get(r);o&&(n.delete(r),n.size===0&&(a.delete(l),o.target.releasePointerCapture(l)))}function Kh(a,r){const{internal:n}=a.getState();n.interaction=n.interaction.filter(l=>l!==r),n.initialHits=n.initialHits.filter(l=>l!==r),n.hovered.forEach((l,o)=>{(l.eventObject===r||l.object===r)&&n.hovered.delete(o)}),n.capturedMap.forEach((l,o)=>{ef(n.capturedMap,r,l,o)})}function Wh(a){function r(d){const{internal:p}=a.getState(),m=d.offsetX-p.initialClick[0],g=d.offsetY-p.initialClick[1];return Math.round(Math.sqrt(m*m+g*g))}function n(d){return d.filter(p=>["Move","Over","Enter","Out","Leave"].some(m=>{var g;return(g=p.__r3f)==null?void 0:g.handlers["onPointer"+m]}))}function l(d,p){const m=a.getState(),g=new Set,v=[],b=p?p(m.internal.interaction):m.internal.interaction;for(let x=0;x<b.length;x++){const S=Ea(b[x]);S&&(S.raycaster.camera=void 0)}m.previousRoot||m.events.compute==null||m.events.compute(d,m);function A(x){const S=Ea(x);if(!S||!S.events.enabled||S.raycaster.camera===null)return[];if(S.raycaster.camera===void 0){var E;S.events.compute==null||S.events.compute(d,S,(E=S.previousRoot)==null?void 0:E.getState()),S.raycaster.camera===void 0&&(S.raycaster.camera=null)}return S.raycaster.camera?S.raycaster.intersectObject(x,!0):[]}let _=b.flatMap(A).sort((x,S)=>{const E=Ea(x.object),P=Ea(S.object);return!E||!P?x.distance-S.distance:P.events.priority-E.events.priority||x.distance-S.distance}).filter(x=>{const S=Hi(x);return g.has(S)?!1:(g.add(S),!0)});m.events.filter&&(_=m.events.filter(_,m));for(const x of _){let S=x.object;for(;S;){var w;(w=S.__r3f)!=null&&w.eventCount&&v.push({...x,eventObject:S}),S=S.parent}}if("pointerId"in d&&m.internal.capturedMap.has(d.pointerId))for(let x of m.internal.capturedMap.get(d.pointerId).values())g.has(Hi(x.intersection))||v.push(x.intersection);return v}function o(d,p,m,g){const v=a.getState();if(d.length){const b={stopped:!1};for(const A of d){const _=Ea(A.object)||v,{raycaster:w,pointer:x,camera:S,internal:E}=_,P=new V(x.x,x.y,0).unproject(S),M=O=>{var B,F;return(B=(F=E.capturedMap.get(O))==null?void 0:F.has(A.eventObject))!=null?B:!1},R=O=>{const B={intersection:A,target:p.target};E.capturedMap.has(O)?E.capturedMap.get(O).set(A.eventObject,B):E.capturedMap.set(O,new Map([[A.eventObject,B]])),p.target.setPointerCapture(O)},L=O=>{const B=E.capturedMap.get(O);B&&ef(E.capturedMap,A.eventObject,B,O)};let N={};for(let O in p){let B=p[O];typeof B!="function"&&(N[O]=B)}let C={...A,...N,pointer:x,intersections:d,stopped:b.stopped,delta:m,unprojectedPoint:P,ray:w.ray,camera:S,stopPropagation(){const O="pointerId"in p&&E.capturedMap.get(p.pointerId);if((!O||O.has(A.eventObject))&&(C.stopped=b.stopped=!0,E.hovered.size&&Array.from(E.hovered.values()).find(B=>B.eventObject===A.eventObject))){const B=d.slice(0,d.indexOf(A));s([...B,A])}},target:{hasPointerCapture:M,setPointerCapture:R,releasePointerCapture:L},currentTarget:{hasPointerCapture:M,setPointerCapture:R,releasePointerCapture:L},nativeEvent:p};if(g(C),b.stopped===!0)break}}return d}function s(d){const{internal:p}=a.getState();for(const m of p.hovered.values())if(!d.length||!d.find(g=>g.object===m.object&&g.index===m.index&&g.instanceId===m.instanceId)){const g=m.eventObject.__r3f,v=g==null?void 0:g.handlers;if(p.hovered.delete(Hi(m)),g!=null&&g.eventCount){const b={...m,intersections:d};v.onPointerOut==null||v.onPointerOut(b),v.onPointerLeave==null||v.onPointerLeave(b)}}}function u(d,p){for(let m=0;m<p.length;m++){const g=p[m].__r3f;g==null||g.handlers.onPointerMissed==null||g.handlers.onPointerMissed(d)}}function f(d){switch(d){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return p=>{const{internal:m}=a.getState();"pointerId"in p&&m.capturedMap.has(p.pointerId)&&requestAnimationFrame(()=>{m.capturedMap.has(p.pointerId)&&(m.capturedMap.delete(p.pointerId),s([]))})}}return function(p){const{onPointerMissed:m,internal:g}=a.getState();g.lastEvent.current=p;const v=d==="onPointerMove",b=d==="onClick"||d==="onContextMenu"||d==="onDoubleClick",A=l(p,v?n:void 0),_=b?r(p):0;d==="onPointerDown"&&(g.initialClick=[p.offsetX,p.offsetY],g.initialHits=A.map(x=>x.eventObject)),b&&!A.length&&_<=2&&(u(p,g.interaction),m&&m(p)),v&&s(A);function w(x){const S=x.eventObject,E=S.__r3f,P=E==null?void 0:E.handlers;if(E!=null&&E.eventCount)if(v){if(P.onPointerOver||P.onPointerEnter||P.onPointerOut||P.onPointerLeave){const M=Hi(x),R=g.hovered.get(M);R?R.stopped&&x.stopPropagation():(g.hovered.set(M,x),P.onPointerOver==null||P.onPointerOver(x),P.onPointerEnter==null||P.onPointerEnter(x))}P.onPointerMove==null||P.onPointerMove(x)}else{const M=P[d];M?(!b||g.initialHits.includes(S))&&(u(p,g.interaction.filter(R=>!g.initialHits.includes(R))),M(x)):b&&g.initialHits.includes(S)&&u(p,g.interaction.filter(R=>!g.initialHits.includes(R)))}}o(A,p,_,w)}}return{handlePointer:f}}const Qh=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],tf=a=>!!(a!=null&&a.render),Ol=z.createContext(null),qh=(a,r)=>{const n=go((f,d)=>{const p=new V,m=new V,g=new V;function v(w=d().camera,x=m,S=d().size){const{width:E,height:P,top:M,left:R}=S,L=E/P;x instanceof V?g.copy(x):g.set(...x);const N=w.getWorldPosition(p).distanceTo(g);if(Wd(w))return{width:E/w.zoom,height:P/w.zoom,top:M,left:R,factor:1,distance:N,aspect:L};{const C=w.fov*Math.PI/180,O=2*Math.tan(C/2)*N,B=O*(E/P);return{width:B,height:O,top:M,left:R,factor:E/B,distance:N,aspect:L}}}let b;const A=w=>f(x=>({performance:{...x.performance,current:w}})),_=new be;return{set:f,get:d,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(w=1)=>a(d(),w),advance:(w,x)=>r(w,x,d()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Fp,pointer:_,mouse:_,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const w=d();b&&clearTimeout(b),w.performance.current!==w.performance.min&&A(w.performance.min),b=setTimeout(()=>A(d().performance.max),w.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:v},setEvents:w=>f(x=>({...x,events:{...x.events,...w}})),setSize:(w,x,S,E,P)=>{const M=d().camera,R={width:w,height:x,top:E||0,left:P||0,updateStyle:S};f(L=>({size:R,viewport:{...L.viewport,...v(M,m,R)}}))},setDpr:w=>f(x=>{const S=Zd(w);return{viewport:{...x.viewport,dpr:S,initialDpr:x.viewport.initialDpr||S}}}),setFrameloop:(w="always")=>{const x=d().clock;x.stop(),x.elapsedTime=0,w!=="never"&&(x.start(),x.elapsedTime=0),f(()=>({frameloop:w}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:z.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(w,x,S)=>{const E=d().internal;return E.priority=E.priority+(x>0?1:0),E.subscribers.push({ref:w,priority:x,store:S}),E.subscribers=E.subscribers.sort((P,M)=>P.priority-M.priority),()=>{const P=d().internal;P!=null&&P.subscribers&&(P.priority=P.priority-(x>0?1:0),P.subscribers=P.subscribers.filter(M=>M.ref!==w))}}}}}),l=n.getState();let o=l.size,s=l.viewport.dpr,u=l.camera;return n.subscribe(()=>{const{camera:f,size:d,viewport:p,gl:m,set:g}=n.getState();if(d.width!==o.width||d.height!==o.height||p.dpr!==s){var v;o=d,s=p.dpr,Jd(f,d),m.setPixelRatio(p.dpr);const b=(v=d.updateStyle)!=null?v:typeof HTMLCanvasElement<"u"&&m.domElement instanceof HTMLCanvasElement;m.setSize(d.width,d.height,b)}f!==u&&(u=f,g(b=>({viewport:{...b.viewport,...b.viewport.getCurrentViewport(f)}})))}),n.subscribe(f=>a(f)),n};let Vi,Xh=new Set,Zh=new Set,$h=new Set;function Bs(a,r){if(a.size)for(const{callback:n}of a.values())n(r)}function Aa(a,r){switch(a){case"before":return Bs(Xh,r);case"after":return Bs(Zh,r);case"tail":return Bs($h,r)}}let Os,Ds;function Us(a,r,n){let l=r.clock.getDelta();for(r.frameloop==="never"&&typeof a=="number"&&(l=a-r.clock.elapsedTime,r.clock.oldTime=r.clock.elapsedTime,r.clock.elapsedTime=a),Os=r.internal.subscribers,Vi=0;Vi<Os.length;Vi++)Ds=Os[Vi],Ds.ref.current(Ds.store.getState(),l,n);return!r.internal.priority&&r.gl.render&&r.gl.render(r.scene,r.camera),r.internal.frames=Math.max(0,r.internal.frames-1),r.frameloop==="always"?1:r.internal.frames}function Jh(a){let r=!1,n,l,o;function s(d){l=requestAnimationFrame(s),r=!0,n=0,Aa("before",d);for(const m of a.values()){var p;o=m.store.getState(),o.internal.active&&(o.frameloop==="always"||o.internal.frames>0)&&!((p=o.gl.xr)!=null&&p.isPresenting)&&(n+=Us(d,o))}if(Aa("after",d),n===0)return Aa("tail",d),r=!1,cancelAnimationFrame(l)}function u(d,p=1){var m;if(!d)return a.forEach(g=>u(g.store.getState(),p));(m=d.gl.xr)!=null&&m.isPresenting||!d.internal.active||d.frameloop==="never"||(d.internal.frames=Math.min(60,d.internal.frames+p),r||(r=!0,requestAnimationFrame(s)))}function f(d,p=!0,m,g){if(p&&Aa("before",d),m)Us(d,m,g);else for(const v of a.values())Us(d,v.store.getState());p&&Aa("after",d)}return{loop:s,invalidate:u,advance:f}}function Dl(){const a=z.useContext(Ol);if(!a)throw new Error("R3F: Hooks can only be used within the Canvas component!");return a}function at(a=n=>n,r){return Dl()(a,r)}function dr(a,r=0){const n=Dl(),l=n.getState().internal.subscribe,o=Qd(a);return Ua(()=>l(o,r,n),[r,l,n]),null}const Xr=new Map,{invalidate:Uc,advance:Fc}=Jh(Xr),{reconciler:Oa,applyProps:Lr}=Uh(Xr,Yh),Cr={objects:"shallow",strict:!1},em=(a,r)=>{const n=typeof a=="function"?a(r):a;return tf(n)?n:new Hp({powerPreference:"high-performance",canvas:r,antialias:!0,alpha:!0,...a})};function tm(a,r){const n=typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement;if(r){const{width:l,height:o,top:s,left:u,updateStyle:f=n}=r;return{width:l,height:o,top:s,left:u,updateStyle:f}}else if(typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement&&a.parentElement){const{width:l,height:o,top:s,left:u}=a.parentElement.getBoundingClientRect();return{width:l,height:o,top:s,left:u,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas)return{width:a.width,height:a.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function nm(a){const r=Xr.get(a),n=r==null?void 0:r.fiber,l=r==null?void 0:r.store;r&&console.warn("R3F.createRoot should only be called once!");const o=typeof reportError=="function"?reportError:console.error,s=l||qh(Uc,Fc),u=n||Oa.createContainer(s,Kr.ConcurrentRoot,null,!1,null,"",o,null);r||Xr.set(a,{fiber:u,store:s});let f,d=!1,p;return{configure(m={}){let{gl:g,size:v,scene:b,events:A,onCreated:_,shadows:w=!1,linear:x=!1,flat:S=!1,legacy:E=!1,orthographic:P=!1,frameloop:M="always",dpr:R=[1,2],performance:L,raycaster:N,camera:C,onPointerMissed:O}=m,B=s.getState(),F=B.gl;B.gl||B.set({gl:F=em(g,a)});let K=B.raycaster;K||B.set({raycaster:K=new zd});const{params:$,...le}=N||{};if(Ne.equ(le,K,Cr)||Lr(K,{...le}),Ne.equ($,K.params,Cr)||Lr(K,{params:{...K.params,...$}}),!B.camera||B.camera===p&&!Ne.equ(p,C,Cr)){p=C;const Z=C instanceof Vp,ie=Z?C:P?new Gr(0,0,0,0,.1,1e3):new Yr(75,0,.1,1e3);Z||(ie.position.z=5,C&&Lr(ie,C),!B.camera&&!(C!=null&&C.rotation)&&ie.lookAt(0,0,0)),B.set({camera:ie}),K.camera=ie}if(!B.scene){let Z;b instanceof ll?Z=b:(Z=new ll,b&&Lr(Z,b)),B.set({scene:Hr(Z)})}if(!B.xr){var fe;const Z=(Te,ze)=>{const St=s.getState();St.frameloop!=="never"&&Fc(Te,!0,St,ze)},ie=()=>{const Te=s.getState();Te.gl.xr.enabled=Te.gl.xr.isPresenting,Te.gl.xr.setAnimationLoop(Te.gl.xr.isPresenting?Z:null),Te.gl.xr.isPresenting||Uc(Te)},pe={connect(){const Te=s.getState().gl;Te.xr.addEventListener("sessionstart",ie),Te.xr.addEventListener("sessionend",ie)},disconnect(){const Te=s.getState().gl;Te.xr.removeEventListener("sessionstart",ie),Te.xr.removeEventListener("sessionend",ie)}};typeof((fe=F.xr)==null?void 0:fe.addEventListener)=="function"&&pe.connect(),B.set({xr:pe})}if(F.shadowMap){const Z=F.shadowMap.enabled,ie=F.shadowMap.type;if(F.shadowMap.enabled=!!w,Ne.boo(w))F.shadowMap.type=Is;else if(Ne.str(w)){var ve;const pe={basic:Bp,percentage:jp,soft:Is,variance:Np};F.shadowMap.type=(ve=pe[w])!=null?ve:Is}else Ne.obj(w)&&Object.assign(F.shadowMap,w);(Z!==F.shadowMap.enabled||ie!==F.shadowMap.type)&&(F.shadowMap.needsUpdate=!0)}const G=Kd();G&&("enabled"in G?G.enabled=!E:"legacyMode"in G&&(G.legacyMode=E)),d||Lr(F,{outputEncoding:x?3e3:3001,toneMapping:S?Op:Dp}),B.legacy!==E&&B.set(()=>({legacy:E})),B.linear!==x&&B.set(()=>({linear:x})),B.flat!==S&&B.set(()=>({flat:S})),g&&!Ne.fun(g)&&!tf(g)&&!Ne.equ(g,F,Cr)&&Lr(F,g),A&&!B.events.handlers&&B.set({events:A(s)});const ee=tm(a,v);return Ne.equ(ee,B.size,Cr)||B.setSize(ee.width,ee.height,ee.updateStyle,ee.top,ee.left),R&&B.viewport.dpr!==Zd(R)&&B.setDpr(R),B.frameloop!==M&&B.setFrameloop(M),B.onPointerMissed||B.set({onPointerMissed:O}),L&&!Ne.equ(L,B.performance,Cr)&&B.set(Z=>({performance:{...Z.performance,...L}})),f=_,d=!0,this},render(m){return d||this.configure(),Oa.updateContainer(z.createElement(rm,{store:s,children:m,onCreated:f,rootElement:a}),u,null,()=>{}),s},unmount(){nf(a)}}}function rm({store:a,children:r,onCreated:n,rootElement:l}){return Ua(()=>{const o=a.getState();o.set(s=>({internal:{...s.internal,active:!0}})),n&&n(o),a.getState().events.connected||o.events.connect==null||o.events.connect(l)},[]),z.createElement(Ol.Provider,{value:a},r)}function nf(a,r){const n=Xr.get(a),l=n==null?void 0:n.fiber;if(l){const o=n==null?void 0:n.store.getState();o&&(o.internal.active=!1),Oa.updateContainer(null,l,null,()=>{o&&setTimeout(()=>{try{var s,u,f,d;o.events.disconnect==null||o.events.disconnect(),(s=o.gl)==null||(u=s.renderLists)==null||u.dispose==null||u.dispose(),(f=o.gl)==null||f.forceContextLoss==null||f.forceContextLoss(),(d=o.gl)!=null&&d.xr&&o.xr.disconnect(),Gh(o),Xr.delete(a),r&&r(a)}catch{}},500)})}}function vl(a,r,n){return z.createElement(am,{key:r.uuid,children:a,container:r,state:n})}function am({state:a={},children:r,container:n}){const{events:l,size:o,...s}=a,u=Dl(),[f]=z.useState(()=>new zd),[d]=z.useState(()=>new be),p=z.useCallback((g,v)=>{const b={...g};Object.keys(g).forEach(_=>{(Qh.includes(_)||g[_]!==v[_]&&v[_])&&delete b[_]});let A;if(v&&o){const _=v.camera;A=g.viewport.getCurrentViewport(_,new V,o),_!==g.camera&&Jd(_,o)}return{...b,scene:n,raycaster:f,pointer:d,mouse:d,previousRoot:u,events:{...g.events,...v==null?void 0:v.events,...l},size:{...g.size,...o},viewport:{...g.viewport,...A},...s}},[a]),[m]=z.useState(()=>{const g=u.getState();return go((v,b)=>({...g,scene:n,raycaster:f,pointer:d,mouse:d,previousRoot:u,events:{...g.events,...l},size:{...g.size,...o},...s,set:v,get:b,setEvents:A=>v(_=>({..._,events:{..._.events,...A}}))}))});return z.useEffect(()=>{const g=u.subscribe(v=>m.setState(b=>p(v,b)));return()=>{g(),m.destroy()}},[]),z.useEffect(()=>{m.setState(g=>p(u.getState(),g))},[p]),z.createElement(z.Fragment,null,Oa.createPortal(z.createElement(Ol.Provider,{value:m},r),m,null))}Oa.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:z.version});function yl(a,r,n){var l,o,s,u,f;r==null&&(r=100);function d(){var m=Date.now()-u;m<r&&m>=0?l=setTimeout(d,r-m):(l=null,n||(f=a.apply(s,o),s=o=null))}var p=function(){s=this,o=arguments,u=Date.now();var m=n&&!l;return l||(l=setTimeout(d,r)),m&&(f=a.apply(s,o),s=o=null),f};return p.clear=function(){l&&(clearTimeout(l),l=null)},p.flush=function(){l&&(f=a.apply(s,o),s=o=null,clearTimeout(l),l=null)},p}yl.debounce=yl;var im=yl;const Hc=Id(im);function om(a){let{debounce:r,scroll:n,polyfill:l,offsetSize:o}=a===void 0?{debounce:0,scroll:!1,offsetSize:!1}:a;const s=l||(typeof window>"u"?class{}:window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[u,f]=z.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),d=z.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:u}),p=r?typeof r=="number"?r:r.scroll:null,m=r?typeof r=="number"?r:r.resize:null,g=z.useRef(!1);z.useEffect(()=>(g.current=!0,()=>void(g.current=!1)));const[v,b,A]=z.useMemo(()=>{const S=()=>{if(!d.current.element)return;const{left:E,top:P,width:M,height:R,bottom:L,right:N,x:C,y:O}=d.current.element.getBoundingClientRect(),B={left:E,top:P,width:M,height:R,bottom:L,right:N,x:C,y:O};d.current.element instanceof HTMLElement&&o&&(B.height=d.current.element.offsetHeight,B.width=d.current.element.offsetWidth),Object.freeze(B),g.current&&!cm(d.current.lastBounds,B)&&f(d.current.lastBounds=B)};return[S,m?Hc(S,m):S,p?Hc(S,p):S]},[f,o,p,m]);function _(){d.current.scrollContainers&&(d.current.scrollContainers.forEach(S=>S.removeEventListener("scroll",A,!0)),d.current.scrollContainers=null),d.current.resizeObserver&&(d.current.resizeObserver.disconnect(),d.current.resizeObserver=null)}function w(){d.current.element&&(d.current.resizeObserver=new s(A),d.current.resizeObserver.observe(d.current.element),n&&d.current.scrollContainers&&d.current.scrollContainers.forEach(S=>S.addEventListener("scroll",A,{capture:!0,passive:!0})))}const x=S=>{!S||S===d.current.element||(_(),d.current.element=S,d.current.scrollContainers=rf(S),w())};return lm(A,!!n),sm(b),z.useEffect(()=>{_(),w()},[n,A,b]),z.useEffect(()=>_,[]),[x,u,v]}function sm(a){z.useEffect(()=>{const r=a;return window.addEventListener("resize",r),()=>void window.removeEventListener("resize",r)},[a])}function lm(a,r){z.useEffect(()=>{if(r){const n=a;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[a,r])}function rf(a){const r=[];if(!a||a===document.body)return r;const{overflow:n,overflowX:l,overflowY:o}=window.getComputedStyle(a);return[n,l,o].some(s=>s==="auto"||s==="scroll")&&r.push(a),[...r,...rf(a.parentElement)]}const um=["x","y","top","bottom","left","right","width","height"],cm=(a,r)=>um.every(n=>a[n]===r[n]);var dm=Object.defineProperty,fm=Object.defineProperties,pm=Object.getOwnPropertyDescriptors,Vc=Object.getOwnPropertySymbols,hm=Object.prototype.hasOwnProperty,mm=Object.prototype.propertyIsEnumerable,Gc=(a,r,n)=>r in a?dm(a,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[r]=n,Yc=(a,r)=>{for(var n in r||(r={}))hm.call(r,n)&&Gc(a,n,r[n]);if(Vc)for(var n of Vc(r))mm.call(r,n)&&Gc(a,n,r[n]);return a},gm=(a,r)=>fm(a,pm(r));function af(a,r,n){if(!a)return;if(n(a)===!0)return a;let l=a.child;for(;l;){const o=af(l,r,n);if(o)return o;l=l.sibling}}function of(a){try{return Object.defineProperties(a,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return a}}const Ul=of(z.createContext(null));class sf extends z.Component{render(){return z.createElement(Ul.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:Fs,ReactCurrentDispatcher:Hs}=z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function vm(){const a=z.useContext(Ul);if(a===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const r=z.useId();return z.useMemo(()=>{for(const n of[Fs==null?void 0:Fs.current,a,a==null?void 0:a.alternate]){if(!n)continue;const l=af(n,!1,o=>{let s=o.memoizedState;for(;s;){if(s.memoizedState===r)return!0;s=s.next}});if(l)return l}},[a,r])}function ym(){var a,r;const n=vm(),[l]=z.useState(()=>new Map);l.clear();let o=n;for(;o;){const s=(a=o.type)==null?void 0:a._context;s&&s!==Ul&&!l.has(s)&&l.set(s,(r=Hs==null?void 0:Hs.current)==null?void 0:r.readContext(of(s))),o=o.return}return l}function bm(){const a=ym();return z.useMemo(()=>Array.from(a.keys()).reduce((r,n)=>l=>z.createElement(r,null,z.createElement(n.Provider,gm(Yc({},l),{value:a.get(n)}))),r=>z.createElement(sf,Yc({},r))),[a])}const Vs={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function xm(a){const{handlePointer:r}=Wh(a);return{priority:1,enabled:!0,compute(n,l,o){l.pointer.set(n.offsetX/l.size.width*2-1,-(n.offsetY/l.size.height)*2+1),l.raycaster.setFromCamera(l.pointer,l.camera)},connected:void 0,handlers:Object.keys(Vs).reduce((n,l)=>({...n,[l]:r(l)}),{}),update:()=>{var n;const{events:l,internal:o}=a.getState();(n=o.lastEvent)!=null&&n.current&&l.handlers&&l.handlers.onPointerMove(o.lastEvent.current)},connect:n=>{var l;const{set:o,events:s}=a.getState();s.disconnect==null||s.disconnect(),o(u=>({events:{...u.events,connected:n}})),Object.entries((l=s.handlers)!=null?l:[]).forEach(([u,f])=>{const[d,p]=Vs[u];n.addEventListener(d,f,{passive:p})})},disconnect:()=>{const{set:n,events:l}=a.getState();if(l.connected){var o;Object.entries((o=l.handlers)!=null?o:[]).forEach(([s,u])=>{if(l&&l.connected instanceof HTMLElement){const[f]=Vs[s];l.connected.removeEventListener(f,u)}}),n(s=>({events:{...s.events,connected:void 0}}))}}}}const wm=z.forwardRef(function({children:a,fallback:r,resize:n,style:l,gl:o,events:s=xm,eventSource:u,eventPrefix:f,shadows:d,linear:p,flat:m,legacy:g,orthographic:v,frameloop:b,dpr:A,performance:_,raycaster:w,camera:x,scene:S,onPointerMissed:E,onCreated:P,...M},R){z.useMemo(()=>Bl(Ch),[]);const L=bm(),[N,C]=om({scroll:!0,debounce:{scroll:50,resize:0},...n}),O=z.useRef(null),B=z.useRef(null);z.useImperativeHandle(R,()=>O.current);const F=Qd(E),[K,$]=z.useState(!1),[le,fe]=z.useState(!1);if(K)throw K;if(le)throw le;const ve=z.useRef(null);Ua(()=>{const ee=O.current;C.width>0&&C.height>0&&ee&&(ve.current||(ve.current=nm(ee)),ve.current.configure({gl:o,events:s,shadows:d,linear:p,flat:m,legacy:g,orthographic:v,frameloop:b,dpr:A,performance:_,raycaster:w,camera:x,scene:S,size:C,onPointerMissed:(...Z)=>F.current==null?void 0:F.current(...Z),onCreated:Z=>{Z.events.connect==null||Z.events.connect(u?Fh(u)?u.current:u:B.current),f&&Z.setEvents({compute:(ie,pe)=>{const Te=ie[f+"X"],ze=ie[f+"Y"];pe.pointer.set(Te/pe.size.width*2-1,-(ze/pe.size.height)*2+1),pe.raycaster.setFromCamera(pe.pointer,pe.camera)}}),P==null||P(Z)}}),ve.current.render(z.createElement(L,null,z.createElement(qd,{set:fe},z.createElement(z.Suspense,{fallback:z.createElement(Hh,{set:$})},a)))))}),z.useEffect(()=>{const ee=O.current;if(ee)return()=>nf(ee)},[]);const G=u?"none":"auto";return z.createElement("div",Hn({ref:B,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:G,...l}},M),z.createElement("div",{ref:N,style:{width:"100%",height:"100%"}},z.createElement("canvas",{ref:O,style:{display:"block"}},r)))}),Sm=z.forwardRef(function(a,r){return z.createElement(sf,null,z.createElement(wm,Hn({},a,{ref:r})))});class _m extends or{constructor(r,n){super(),this.inputSource=null,this.xrControllerModel=null,this.index=r,this.controller=n.xr.getController(r),this.grip=n.xr.getControllerGrip(r),this.hand=n.xr.getHand(r),this.grip.userData.name="grip",this.controller.userData.name="controller",this.hand.userData.name="hand",this.visible=!1,this.add(this.controller,this.grip,this.hand),this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.controller.addEventListener("connected",this._onConnected),this.controller.addEventListener("disconnected",this._onDisconnected)}_onConnected(r){r.fake||r.data&&(this.visible=!0,this.inputSource=r.data,this.dispatchEvent(r))}_onDisconnected(r){r.fake||(this.visible=!1,this.inputSource=null,this.dispatchEvent(r))}dispose(){this.controller.removeEventListener("connected",this._onConnected),this.controller.removeEventListener("disconnected",this._onDisconnected)}}var Kc,Wc;const Em=a=>Array.from(new Set(a)),Ft=typeof window<"u"&&((Kc=window.document)!=null&&Kc.createElement||((Wc=window.navigator)==null?void 0:Wc.product)==="ReactNative")?z.useLayoutEffect:z.useEffect;function cn(a){const r=z.useRef(a);return Ft(()=>void(r.current=a),[a]),r}function Rr(a,r,{handedness:n}={}){const l=cn(r),o=He(s=>s.controllers);Ft(()=>{const s=o.map(u=>{if(n&&u.inputSource&&u.inputSource.handedness!==n)return;const f=d=>l.current({nativeEvent:d,target:u});return u.controller.addEventListener(a,f),()=>u.controller.removeEventListener(a,f)});return()=>s.forEach(u=>u==null?void 0:u())},[o,n,a])}const Qc=new Je;function Am({children:a}){const r=at(g=>g.events),n=at(g=>g.get),l=at(g=>g.raycaster),o=He(g=>g.controllers),s=He(g=>g.interactions),u=He(g=>g.hoverState),f=He(g=>g.hasInteraction),d=He(g=>g.getInteraction),p=z.useCallback(g=>{const v=Array.from(s.keys());return Qc.identity().extractRotation(g.matrixWorld),l.ray.origin.setFromMatrixPosition(g.matrixWorld),l.ray.direction.set(0,0,-1).applyMatrix4(Qc),l.intersectObjects(v,!0)},[s,l]);dr(()=>{var g;if(s.size!==0)for(const v of o){if(!((g=v.inputSource)!=null&&g.handedness))return;const b=u[v.inputSource.handedness],A=new Set;let _=p(v.controller);if(r.filter)_=r.filter(_,n());else{const w=_.find(x=>x==null?void 0:x.object);w&&(_=[w])}for(const w of _){let x=w.object;for(;x;){if(f(x,"onHover")&&!b.has(x)){const E=d(x,"onHover");for(const P of E)P({target:v,intersection:w,intersections:_})}const S=d(x,"onMove");S==null||S.forEach(E=>E({target:v,intersection:w,intersections:_})),b.set(x,w),A.add(x.id),x=x.parent}}for(const w of b.keys())if(!A.has(w.id)){b.delete(w);const x=d(w,"onBlur");if(!x)continue;for(const S of x)S({target:v,intersections:_})}}});const m=z.useCallback(g=>v=>{var b;if(!((b=v.target.inputSource)!=null&&b.handedness))return;const A=u[v.target.inputSource.handedness],_=Array.from(new Set(A.values()));s.forEach((w,x)=>{var S,E,P;if(A.has(x)){if(!w[g])return;for(const M of w[g])(S=M.current)==null||S.call(M,{target:v.target,intersection:A.get(x),intersections:_})}else if(g==="onSelect"&&w.onSelectMissed)for(const M of w.onSelectMissed)(E=M.current)==null||E.call(M,{target:v.target,intersections:_});else if(g==="onSqueeze"&&w.onSqueezeMissed)for(const M of w.onSqueezeMissed)(P=M.current)==null||P.call(M,{target:v.target,intersections:_})})},[u,s]);return Rr("select",m("onSelect")),Rr("selectstart",m("onSelectStart")),Rr("selectend",m("onSelectEnd")),Rr("squeeze",m("onSqueeze")),Rr("squeezeend",m("onSqueezeEnd")),Rr("squeezestart",m("onSqueezeStart")),z.createElement(z.Fragment,null,a)}function Xt(a,r,n){const l=He(u=>u.addInteraction),o=He(u=>u.removeInteraction),s=cn(n);Ft(()=>{const u=a.current;if(!(!u||!s.current))return l(u,r,s),()=>o(u,r,s)},[a,r,l,o])}const Tm=z.forwardRef(function({onHover:a,onBlur:r,onSelectStart:n,onSelectEnd:l,onSelectMissed:o,onSelect:s,onSqueezeStart:u,onSqueezeEnd:f,onSqueezeMissed:d,onSqueeze:p,onMove:m,children:g},v){const b=z.useRef(null);return z.useImperativeHandle(v,()=>b.current),Xt(b,"onHover",a),Xt(b,"onBlur",r),Xt(b,"onSelectStart",n),Xt(b,"onSelectEnd",l),Xt(b,"onSelectMissed",o),Xt(b,"onSelect",s),Xt(b,"onSqueezeStart",u),Xt(b,"onSqueezeEnd",f),Xt(b,"onSqueezeMissed",d),Xt(b,"onSqueeze",p),Xt(b,"onMove",m),z.createElement("group",{ref:b},g)}),Pm=z.forwardRef(function({onSelectStart:a,onSelectEnd:r,children:n,...l},o){const s=z.useRef(),u=z.useRef(null),f=z.useMemo(()=>new Je,[]);return z.useImperativeHandle(o,()=>u.current),dr(()=>{const d=s.current,p=u.current;d&&(p.applyMatrix4(f),p.applyMatrix4(d.matrixWorld),p.updateMatrixWorld(),f.copy(d.matrixWorld).invert())}),z.createElement(Tm,{ref:u,onSelectStart:d=>{s.current=d.target.controller,f.copy(d.target.controller.matrixWorld).invert(),a==null||a(d)},onSelectEnd:d=>{d.target.controller===s.current&&(s.current=void 0),r==null||r(d)},...l},n)}),lf=z.createContext(null),lr=go((a,r)=>({set:a,get:r,session:null,referenceSpaceType:null}));function Mm({foveation:a=0,frameRate:r=void 0,referenceSpace:n="local-floor",onSessionStart:l,onSessionEnd:o,onVisibilityChange:s,onInputSourcesChange:u,children:f}){const d=at(E=>E.gl),p=at(E=>E.camera),m=He(E=>E.player),g=He(E=>E.get),v=He(E=>E.set),b=He(E=>E.session),A=He(E=>E.controllers),_=cn(l),w=cn(o),x=cn(s),S=cn(u);return Ft(()=>{const E=[0,1].map(P=>{const M=new _m(P,d),R=()=>v(N=>({controllers:[...N.controllers,M]})),L=()=>v(N=>({controllers:N.controllers.filter(C=>C!==M)}));return M.addEventListener("connected",R),M.addEventListener("disconnected",L),()=>{M.removeEventListener("connected",R),M.removeEventListener("disconnected",L)}});return()=>E.forEach(P=>P())},[d,v]),Ft(()=>lr.subscribe(({session:E})=>v(()=>({session:E}))),[d.xr,v]),Ft(()=>{d.xr.setFoveation(a),v(()=>({foveation:a}))},[d.xr,a,v]),Ft(()=>{var E;try{r&&((E=b==null?void 0:b.updateTargetFrameRate)==null||E.call(b,r))}catch{}v(()=>({frameRate:r}))},[b,r,v]),Ft(()=>{const E=lr.getState();d.xr.setReferenceSpaceType(n),v(()=>({referenceSpace:n})),E.set({referenceSpaceType:n})},[d.xr,n,v]),Ft(()=>{if(!b)return void d.xr.setSession(null);const E=L=>{var N;v(()=>({isPresenting:!0})),(N=_.current)==null||N.call(_,{nativeEvent:{...L,target:b},target:b})},P=L=>{var N;v(()=>({isPresenting:!1,session:null})),lr.setState(()=>({session:null})),(N=w.current)==null||N.call(w,{nativeEvent:{...L,target:b},target:b})},M=L=>{var N;(N=x.current)==null||N.call(x,{nativeEvent:L,target:b})},R=L=>{var N;const C=Object.values(b.inputSources).some(O=>O.hand);v(()=>({isHandTracking:C})),(N=S.current)==null||N.call(S,{nativeEvent:L,target:b})};return d.xr.addEventListener("sessionstart",E),d.xr.addEventListener("sessionend",P),b.addEventListener("visibilitychange",M),b.addEventListener("inputsourceschange",R),d.xr.setSession(b).then(()=>{d.xr.setFoveation(g().foveation)}),()=>{d.xr.removeEventListener("sessionstart",E),d.xr.removeEventListener("sessionend",P),b.removeEventListener("visibilitychange",M),b.removeEventListener("inputsourceschange",R)}},[b,d.xr,v,g]),z.createElement(Am,null,z.createElement("primitive",{object:m},z.createElement("primitive",{object:p}),A.map(E=>z.createElement("primitive",{key:E.index,object:E}))),f)}function Lm(a){const r=z.useMemo(()=>go((n,l)=>({set:n,get:l,controllers:[],isPresenting:!1,isHandTracking:!1,player:new or,session:null,foveation:0,referenceSpace:"local-floor",hoverState:{left:new Map,right:new Map,none:new Map},interactions:new Map,hasInteraction(o,s){var u;return!!((u=l().interactions.get(o))!=null&&u[s].some(f=>f.current))},getInteraction(o,s){var u;return(u=l().interactions.get(o))==null?void 0:u[s].reduce((f,d)=>(d.current&&f.push(d.current),f),[])},addInteraction(o,s,u){const f=l().interactions;f.has(o)||f.set(o,{onHover:[],onBlur:[],onSelect:[],onSelectEnd:[],onSelectStart:[],onSelectMissed:[],onSqueeze:[],onSqueezeEnd:[],onSqueezeStart:[],onSqueezeMissed:[],onMove:[]}),f.get(o)[s].push(u)},removeInteraction(o,s,u){const f=l().interactions.get(o);if(f){const d=f[s].indexOf(u);d!==-1&&f[s].splice(d,1)}}})),[]);return z.createElement(lf.Provider,{value:r},z.createElement(Mm,{...a}))}const Cm=(a,r)=>{var n;if(!(!a&&!r))return a&&!r?{optionalFeatures:[a]}:a&&r?{...r,optionalFeatures:Em([...(n=r.optionalFeatures)!=null?n:[],a])}:r},Rm=async(a,r)=>{const n=lr.getState();if(n.session){console.warn("@react-three/xr: session already started, please stop it first");return}const l=Cm(n.referenceSpaceType,r),o=await navigator.xr.requestSession(a,l);return n.set(()=>({session:o})),o},Im=async()=>{const a=lr.getState();if(!a.session){console.warn("@react-three/xr: no session to stop, please start it first");return}await a.session.end(),a.set({session:null})},zm=async(a,{sessionInit:r,enterOnly:n,exitOnly:l}={})=>{const o=lr.getState();if(!(o.session&&n)&&!(!o.session&&l))return o.session?await Im():await Rm(a,r)},km=(a,r,n)=>{switch(a){case"entered":return`Exit ${r}`;case"exited":return`Enter ${r}`;case"unsupported":default:switch(n){case"https":return"HTTPS needed";case"security":return`${r} blocked`;case"unknown":default:return`${r} unsupported`}}},Fl=z.forwardRef(function({mode:a,sessionInit:r,enterOnly:n=!1,exitOnly:l=!1,onClick:o,onError:s,children:u,...f},d){var p;const[m,g]=z.useState("exited"),[v,b]=z.useState("unknown"),A=km(m,a,v),_=a==="inline"?a:`immersive-${a.toLowerCase()}`,w=cn(s);Ft(()=>{if(!(navigator!=null&&navigator.xr))return void g("unsupported");navigator.xr.isSessionSupported(_).then(S=>{if(S)g("exited");else{const E=location.protocol==="https:";g("unsupported"),b(E?"unknown":"https")}}).catch(S=>{g("unsupported"),"name"in S&&S.name==="SecurityError"?b("security"):b("unknown")})},[_]),Ft(()=>lr.subscribe(S=>{S.session?g("entered"):m!=="unsupported"&&g("exited")}),[m]);const x=z.useCallback(async S=>{o==null||o(S);try{zm(_,{sessionInit:r,enterOnly:n,exitOnly:l})}catch(E){const P=w.current;if(P&&E instanceof Error)P(E);else throw E}},[o,_,r,n,l,w]);return z.createElement("button",{...f,ref:d,onClick:m==="unsupported"?o:x},(p=typeof u=="function"?u(m):u)!=null?p:A)}),uf={position:"absolute",bottom:"24px",left:"50%",transform:"translateX(-50%)",padding:"12px 24px",border:"1px solid white",borderRadius:"4px",background:"rgba(0, 0, 0, 0.1)",color:"white",font:"normal 0.8125rem sans-serif",outline:"none",zIndex:99999,cursor:"pointer"};z.forwardRef(({style:a=uf,sessionInit:r={domOverlay:typeof document<"u"?{root:document.body}:void 0,optionalFeatures:["hit-test","dom-overlay","dom-overlay-for-handheld-ar"]},children:n,...l},o)=>z.createElement(Fl,{...l,ref:o,mode:"AR",style:a,sessionInit:r},n));z.forwardRef(({style:a=uf,sessionInit:r={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]},children:n,...l},o)=>z.createElement(Fl,{...l,ref:o,mode:"VR",style:a,sessionInit:r},n));function He(a=n=>n,r){const n=z.useContext(lf);if(!n)throw new Error("useXR must be used within an <XR /> component!");return n(a,r)}function qc(a,r){if(r===Mh)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),a;if(r===pl||r===Fd){let n=a.getIndex();if(n===null){const u=[],f=a.getAttribute("position");if(f!==void 0){for(let d=0;d<f.count;d++)u.push(d);a.setIndex(u),n=a.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const l=n.count-2,o=[];if(n)if(r===pl)for(let u=1;u<=l;u++)o.push(n.getX(0)),o.push(n.getX(u)),o.push(n.getX(u+1));else for(let u=0;u<l;u++)u%2===0?(o.push(n.getX(u)),o.push(n.getX(u+1)),o.push(n.getX(u+2))):(o.push(n.getX(u+2)),o.push(n.getX(u+1)),o.push(n.getX(u)));o.length/3!==l&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=a.clone();return s.setIndex(o),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",r),a}const Nm=parseInt(jd.replace(/\D+/g,""));var jm=Object.defineProperty,Bm=(a,r,n)=>r in a?jm(a,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[r]=n,ue=(a,r,n)=>(Bm(a,typeof r!="symbol"?r+"":r,n),n);const Gi=new kd,Xc=new kl,Om=Math.cos(70*(Math.PI/180)),Zc=(a,r)=>(a%r+r)%r;let Dm=class extends Up{constructor(a,r){super(),ue(this,"object"),ue(this,"domElement"),ue(this,"enabled",!0),ue(this,"target",new V),ue(this,"minDistance",0),ue(this,"maxDistance",1/0),ue(this,"minZoom",0),ue(this,"maxZoom",1/0),ue(this,"minPolarAngle",0),ue(this,"maxPolarAngle",Math.PI),ue(this,"minAzimuthAngle",-1/0),ue(this,"maxAzimuthAngle",1/0),ue(this,"enableDamping",!1),ue(this,"dampingFactor",.05),ue(this,"enableZoom",!0),ue(this,"zoomSpeed",1),ue(this,"enableRotate",!0),ue(this,"rotateSpeed",1),ue(this,"enablePan",!0),ue(this,"panSpeed",1),ue(this,"screenSpacePanning",!0),ue(this,"keyPanSpeed",7),ue(this,"zoomToCursor",!1),ue(this,"autoRotate",!1),ue(this,"autoRotateSpeed",2),ue(this,"reverseOrbit",!1),ue(this,"reverseHorizontalOrbit",!1),ue(this,"reverseVerticalOrbit",!1),ue(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),ue(this,"mouseButtons",{LEFT:Pr.ROTATE,MIDDLE:Pr.DOLLY,RIGHT:Pr.PAN}),ue(this,"touches",{ONE:Mr.ROTATE,TWO:Mr.DOLLY_PAN}),ue(this,"target0"),ue(this,"position0"),ue(this,"zoom0"),ue(this,"_domElementKeyEvents",null),ue(this,"getPolarAngle"),ue(this,"getAzimuthalAngle"),ue(this,"setPolarAngle"),ue(this,"setAzimuthalAngle"),ue(this,"getDistance"),ue(this,"listenToKeyEvents"),ue(this,"stopListenToKeyEvents"),ue(this,"saveState"),ue(this,"reset"),ue(this,"update"),ue(this,"connect"),ue(this,"dispose"),this.object=a,this.domElement=r,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>p.phi,this.getAzimuthalAngle=()=>p.theta,this.setPolarAngle=j=>{let Q=Zc(j,2*Math.PI),se=p.phi;se<0&&(se+=2*Math.PI),Q<0&&(Q+=2*Math.PI);let Se=Math.abs(Q-se);2*Math.PI-Se<Se&&(Q<se?Q+=2*Math.PI:se+=2*Math.PI),m.phi=Q-se,n.update()},this.setAzimuthalAngle=j=>{let Q=Zc(j,2*Math.PI),se=p.theta;se<0&&(se+=2*Math.PI),Q<0&&(Q+=2*Math.PI);let Se=Math.abs(Q-se);2*Math.PI-Se<Se&&(Q<se?Q+=2*Math.PI:se+=2*Math.PI),m.theta=Q-se,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=j=>{j.addEventListener("keydown",ta),this._domElementKeyEvents=j},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",ta),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(l),n.update(),f=u.NONE},this.update=(()=>{const j=new V,Q=new V(0,1,0),se=new po().setFromUnitVectors(a.up,Q),Se=se.clone().invert(),ft=new V,_t=new po,fr=2*Math.PI;return function(){const Ka=n.object.position;se.setFromUnitVectors(a.up,Q),Se.copy(se).invert(),j.copy(Ka).sub(n.target),j.applyQuaternion(se),p.setFromVector3(j),n.autoRotate&&f===u.NONE&&K(B()),n.enableDamping?(p.theta+=m.theta*n.dampingFactor,p.phi+=m.phi*n.dampingFactor):(p.theta+=m.theta,p.phi+=m.phi);let Lt=n.minAzimuthAngle,Ct=n.maxAzimuthAngle;isFinite(Lt)&&isFinite(Ct)&&(Lt<-Math.PI?Lt+=fr:Lt>Math.PI&&(Lt-=fr),Ct<-Math.PI?Ct+=fr:Ct>Math.PI&&(Ct-=fr),Lt<=Ct?p.theta=Math.max(Lt,Math.min(Ct,p.theta)):p.theta=p.theta>(Lt+Ct)/2?Math.max(Lt,p.theta):Math.min(Ct,p.theta)),p.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,p.phi)),p.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(v,n.dampingFactor):n.target.add(v),n.zoomToCursor&&N||n.object.isOrthographicCamera?p.radius=ie(p.radius):p.radius=ie(p.radius*g),j.setFromSpherical(p),j.applyQuaternion(Se),Ka.copy(n.target).add(j),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(m.theta*=1-n.dampingFactor,m.phi*=1-n.dampingFactor,v.multiplyScalar(1-n.dampingFactor)):(m.set(0,0,0),v.set(0,0,0));let Yn=!1;if(n.zoomToCursor&&N){let An=null;if(n.object instanceof Yr&&n.object.isPerspectiveCamera){const Tn=j.length();An=ie(Tn*g);const Kn=Tn-An;n.object.position.addScaledVector(R,Kn),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const Tn=new V(L.x,L.y,0);Tn.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/g)),n.object.updateProjectionMatrix(),Yn=!0;const Kn=new V(L.x,L.y,0);Kn.unproject(n.object),n.object.position.sub(Kn).add(Tn),n.object.updateMatrixWorld(),An=j.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;An!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(An).add(n.object.position):(Gi.origin.copy(n.object.position),Gi.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(Gi.direction))<Om?a.lookAt(n.target):(Xc.setFromNormalAndCoplanarPoint(n.object.up,n.target),Gi.intersectPlane(Xc,n.target))))}else n.object instanceof Gr&&n.object.isOrthographicCamera&&(Yn=g!==1,Yn&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/g)),n.object.updateProjectionMatrix()));return g=1,N=!1,Yn||ft.distanceToSquared(n.object.position)>d||8*(1-_t.dot(n.object.quaternion))>d?(n.dispatchEvent(l),ft.copy(n.object.position),_t.copy(n.object.quaternion),Yn=!1,!0):!1}})(),this.connect=j=>{j===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),n.domElement=j,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",Va),n.domElement.addEventListener("pointerdown",Fa),n.domElement.addEventListener("pointercancel",En),n.domElement.addEventListener("wheel",Ha)},this.dispose=()=>{var j,Q,se,Se,ft,_t;(j=n.domElement)==null||j.removeEventListener("contextmenu",Va),(Q=n.domElement)==null||Q.removeEventListener("pointerdown",Fa),(se=n.domElement)==null||se.removeEventListener("pointercancel",En),(Se=n.domElement)==null||Se.removeEventListener("wheel",Ha),(ft=n.domElement)==null||ft.ownerDocument.removeEventListener("pointermove",Jr),(_t=n.domElement)==null||_t.ownerDocument.removeEventListener("pointerup",ea),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",ta)};const n=this,l={type:"change"},o={type:"start"},s={type:"end"},u={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let f=u.NONE;const d=1e-6,p=new Cc,m=new Cc;let g=1;const v=new V,b=new be,A=new be,_=new be,w=new be,x=new be,S=new be,E=new be,P=new be,M=new be,R=new V,L=new be;let N=!1;const C=[],O={};function B(){return 2*Math.PI/60/60*n.autoRotateSpeed}function F(){return Math.pow(.95,n.zoomSpeed)}function K(j){n.reverseOrbit||n.reverseHorizontalOrbit?m.theta+=j:m.theta-=j}function $(j){n.reverseOrbit||n.reverseVerticalOrbit?m.phi+=j:m.phi-=j}const le=(()=>{const j=new V;return function(Q,se){j.setFromMatrixColumn(se,0),j.multiplyScalar(-Q),v.add(j)}})(),fe=(()=>{const j=new V;return function(Q,se){n.screenSpacePanning===!0?j.setFromMatrixColumn(se,1):(j.setFromMatrixColumn(se,0),j.crossVectors(n.object.up,j)),j.multiplyScalar(Q),v.add(j)}})(),ve=(()=>{const j=new V;return function(Q,se){const Se=n.domElement;if(Se&&n.object instanceof Yr&&n.object.isPerspectiveCamera){const ft=n.object.position;j.copy(ft).sub(n.target);let _t=j.length();_t*=Math.tan(n.object.fov/2*Math.PI/180),le(2*Q*_t/Se.clientHeight,n.object.matrix),fe(2*se*_t/Se.clientHeight,n.object.matrix)}else Se&&n.object instanceof Gr&&n.object.isOrthographicCamera?(le(Q*(n.object.right-n.object.left)/n.object.zoom/Se.clientWidth,n.object.matrix),fe(se*(n.object.top-n.object.bottom)/n.object.zoom/Se.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function G(j){n.object instanceof Yr&&n.object.isPerspectiveCamera||n.object instanceof Gr&&n.object.isOrthographicCamera?g/=j:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ee(j){n.object instanceof Yr&&n.object.isPerspectiveCamera||n.object instanceof Gr&&n.object.isOrthographicCamera?g*=j:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Z(j){if(!n.zoomToCursor||!n.domElement)return;N=!0;const Q=n.domElement.getBoundingClientRect(),se=j.clientX-Q.left,Se=j.clientY-Q.top,ft=Q.width,_t=Q.height;L.x=se/ft*2-1,L.y=-(Se/_t)*2+1,R.set(L.x,L.y,1).unproject(n.object).sub(n.object.position).normalize()}function ie(j){return Math.max(n.minDistance,Math.min(n.maxDistance,j))}function pe(j){b.set(j.clientX,j.clientY)}function Te(j){Z(j),E.set(j.clientX,j.clientY)}function ze(j){w.set(j.clientX,j.clientY)}function St(j){A.set(j.clientX,j.clientY),_.subVectors(A,b).multiplyScalar(n.rotateSpeed);const Q=n.domElement;Q&&(K(2*Math.PI*_.x/Q.clientHeight),$(2*Math.PI*_.y/Q.clientHeight)),b.copy(A),n.update()}function dt(j){P.set(j.clientX,j.clientY),M.subVectors(P,E),M.y>0?G(F()):M.y<0&&ee(F()),E.copy(P),n.update()}function Kt(j){x.set(j.clientX,j.clientY),S.subVectors(x,w).multiplyScalar(n.panSpeed),ve(S.x,S.y),w.copy(x),n.update()}function _n(j){Z(j),j.deltaY<0?ee(F()):j.deltaY>0&&G(F()),n.update()}function fn(j){let Q=!1;switch(j.code){case n.keys.UP:ve(0,n.keyPanSpeed),Q=!0;break;case n.keys.BOTTOM:ve(0,-n.keyPanSpeed),Q=!0;break;case n.keys.LEFT:ve(n.keyPanSpeed,0),Q=!0;break;case n.keys.RIGHT:ve(-n.keyPanSpeed,0),Q=!0;break}Q&&(j.preventDefault(),n.update())}function me(){if(C.length==1)b.set(C[0].pageX,C[0].pageY);else{const j=.5*(C[0].pageX+C[1].pageX),Q=.5*(C[0].pageY+C[1].pageY);b.set(j,Q)}}function Y(){if(C.length==1)w.set(C[0].pageX,C[0].pageY);else{const j=.5*(C[0].pageX+C[1].pageX),Q=.5*(C[0].pageY+C[1].pageY);w.set(j,Q)}}function te(){const j=C[0].pageX-C[1].pageX,Q=C[0].pageY-C[1].pageY,se=Math.sqrt(j*j+Q*Q);E.set(0,se)}function Me(){n.enableZoom&&te(),n.enablePan&&Y()}function he(){n.enableZoom&&te(),n.enableRotate&&me()}function Ge(j){if(C.length==1)A.set(j.pageX,j.pageY);else{const se=na(j),Se=.5*(j.pageX+se.x),ft=.5*(j.pageY+se.y);A.set(Se,ft)}_.subVectors(A,b).multiplyScalar(n.rotateSpeed);const Q=n.domElement;Q&&(K(2*Math.PI*_.x/Q.clientHeight),$(2*Math.PI*_.y/Q.clientHeight)),b.copy(A)}function we(j){if(C.length==1)x.set(j.pageX,j.pageY);else{const Q=na(j),se=.5*(j.pageX+Q.x),Se=.5*(j.pageY+Q.y);x.set(se,Se)}S.subVectors(x,w).multiplyScalar(n.panSpeed),ve(S.x,S.y),w.copy(x)}function Le(j){const Q=na(j),se=j.pageX-Q.x,Se=j.pageY-Q.y,ft=Math.sqrt(se*se+Se*Se);P.set(0,ft),M.set(0,Math.pow(P.y/E.y,n.zoomSpeed)),G(M.y),E.copy(P)}function je(j){n.enableZoom&&Le(j),n.enablePan&&we(j)}function et(j){n.enableZoom&&Le(j),n.enableRotate&&Ge(j)}function Fa(j){var Q,se;n.enabled!==!1&&(C.length===0&&((Q=n.domElement)==null||Q.ownerDocument.addEventListener("pointermove",Jr),(se=n.domElement)==null||se.ownerDocument.addEventListener("pointerup",ea)),_o(j),j.pointerType==="touch"?wo(j):bo(j))}function Jr(j){n.enabled!==!1&&(j.pointerType==="touch"?So(j):xo(j))}function ea(j){var Q,se,Se;Ga(j),C.length===0&&((Q=n.domElement)==null||Q.releasePointerCapture(j.pointerId),(se=n.domElement)==null||se.ownerDocument.removeEventListener("pointermove",Jr),(Se=n.domElement)==null||Se.ownerDocument.removeEventListener("pointerup",ea)),n.dispatchEvent(s),f=u.NONE}function En(j){Ga(j)}function bo(j){let Q;switch(j.button){case 0:Q=n.mouseButtons.LEFT;break;case 1:Q=n.mouseButtons.MIDDLE;break;case 2:Q=n.mouseButtons.RIGHT;break;default:Q=-1}switch(Q){case Pr.DOLLY:if(n.enableZoom===!1)return;Te(j),f=u.DOLLY;break;case Pr.ROTATE:if(j.ctrlKey||j.metaKey||j.shiftKey){if(n.enablePan===!1)return;ze(j),f=u.PAN}else{if(n.enableRotate===!1)return;pe(j),f=u.ROTATE}break;case Pr.PAN:if(j.ctrlKey||j.metaKey||j.shiftKey){if(n.enableRotate===!1)return;pe(j),f=u.ROTATE}else{if(n.enablePan===!1)return;ze(j),f=u.PAN}break;default:f=u.NONE}f!==u.NONE&&n.dispatchEvent(o)}function xo(j){if(n.enabled!==!1)switch(f){case u.ROTATE:if(n.enableRotate===!1)return;St(j);break;case u.DOLLY:if(n.enableZoom===!1)return;dt(j);break;case u.PAN:if(n.enablePan===!1)return;Kt(j);break}}function Ha(j){n.enabled===!1||n.enableZoom===!1||f!==u.NONE&&f!==u.ROTATE||(j.preventDefault(),n.dispatchEvent(o),_n(j),n.dispatchEvent(s))}function ta(j){n.enabled===!1||n.enablePan===!1||fn(j)}function wo(j){switch(Ya(j),C.length){case 1:switch(n.touches.ONE){case Mr.ROTATE:if(n.enableRotate===!1)return;me(),f=u.TOUCH_ROTATE;break;case Mr.PAN:if(n.enablePan===!1)return;Y(),f=u.TOUCH_PAN;break;default:f=u.NONE}break;case 2:switch(n.touches.TWO){case Mr.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Me(),f=u.TOUCH_DOLLY_PAN;break;case Mr.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;he(),f=u.TOUCH_DOLLY_ROTATE;break;default:f=u.NONE}break;default:f=u.NONE}f!==u.NONE&&n.dispatchEvent(o)}function So(j){switch(Ya(j),f){case u.TOUCH_ROTATE:if(n.enableRotate===!1)return;Ge(j),n.update();break;case u.TOUCH_PAN:if(n.enablePan===!1)return;we(j),n.update();break;case u.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;je(j),n.update();break;case u.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;et(j),n.update();break;default:f=u.NONE}}function Va(j){n.enabled!==!1&&j.preventDefault()}function _o(j){C.push(j)}function Ga(j){delete O[j.pointerId];for(let Q=0;Q<C.length;Q++)if(C[Q].pointerId==j.pointerId){C.splice(Q,1);return}}function Ya(j){let Q=O[j.pointerId];Q===void 0&&(Q=new be,O[j.pointerId]=Q),Q.set(j.pageX,j.pageY)}function na(j){const Q=j.pointerId===C[0].pointerId?C[1]:C[0];return O[Q.pointerId]}r!==void 0&&this.connect(r),this.update()}};class cf extends Zp{constructor(r){super(r),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Gm(n)}),this.register(function(n){return new $m(n)}),this.register(function(n){return new Jm(n)}),this.register(function(n){return new eg(n)}),this.register(function(n){return new Km(n)}),this.register(function(n){return new Wm(n)}),this.register(function(n){return new Qm(n)}),this.register(function(n){return new qm(n)}),this.register(function(n){return new Vm(n)}),this.register(function(n){return new Xm(n)}),this.register(function(n){return new Ym(n)}),this.register(function(n){return new Zm(n)}),this.register(function(n){return new Fm(n)}),this.register(function(n){return new tg(n)}),this.register(function(n){return new ng(n)})}load(r,n,l,o){const s=this;let u;this.resourcePath!==""?u=this.resourcePath:this.path!==""?u=this.path:u=sr.extractUrlBase(r),this.manager.itemStart(r);const f=function(p){o?o(p):console.error(p),s.manager.itemError(r),s.manager.itemEnd(r)},d=new Nd(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(r,function(p){try{s.parse(p,u,function(m){n(m),s.manager.itemEnd(r)},f)}catch(m){f(m)}},l,f)}setDRACOLoader(r){return this.dracoLoader=r,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(r){return this.ktx2Loader=r,this}setMeshoptDecoder(r){return this.meshoptDecoder=r,this}register(r){return this.pluginCallbacks.indexOf(r)===-1&&this.pluginCallbacks.push(r),this}unregister(r){return this.pluginCallbacks.indexOf(r)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(r),1),this}parse(r,n,l,o){let s;const u={},f={};if(typeof r=="string")s=JSON.parse(r);else if(r instanceof ArrayBuffer)if(sr.decodeText(new Uint8Array(r.slice(0,4)))===df){try{u[xe.KHR_BINARY_GLTF]=new rg(r)}catch(p){o&&o(p);return}s=JSON.parse(u[xe.KHR_BINARY_GLTF].content)}else s=JSON.parse(sr.decodeText(new Uint8Array(r)));else s=r;if(s.asset===void 0||s.asset.version[0]<2){o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const d=new gg(s,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(let p=0;p<this.pluginCallbacks.length;p++){const m=this.pluginCallbacks[p](d);f[m.name]=m,u[m.name]=!0}if(s.extensionsUsed)for(let p=0;p<s.extensionsUsed.length;++p){const m=s.extensionsUsed[p],g=s.extensionsRequired||[];switch(m){case xe.KHR_MATERIALS_UNLIT:u[m]=new Hm;break;case xe.KHR_DRACO_MESH_COMPRESSION:u[m]=new ag(s,this.dracoLoader);break;case xe.KHR_TEXTURE_TRANSFORM:u[m]=new ig;break;case xe.KHR_MESH_QUANTIZATION:u[m]=new og;break;default:g.indexOf(m)>=0&&f[m]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+m+'".')}}d.setExtensions(u),d.setPlugins(f),d.parse(l,o)}parseAsync(r,n){const l=this;return new Promise(function(o,s){l.parse(r,n,o,s)})}}function Um(){let a={};return{get:function(r){return a[r]},add:function(r,n){a[r]=n},remove:function(r){delete a[r]},removeAll:function(){a={}}}}const xe={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Fm{constructor(r){this.parser=r,this.name=xe.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const r=this.parser,n=this.parser.json.nodes||[];for(let l=0,o=n.length;l<o;l++){const s=n[l];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&r._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(r){const n=this.parser,l="light:"+r;let o=n.cache.get(l);if(o)return o;const s=n.json,u=((s.extensions&&s.extensions[this.name]||{}).lights||[])[r];let f;const d=new xn(16777215);u.color!==void 0&&d.fromArray(u.color);const p=u.range!==void 0?u.range:0;switch(u.type){case"directional":f=new rh(d),f.target.position.set(0,0,-1),f.add(f.target);break;case"point":f=new nh(d),f.distance=p;break;case"spot":f=new th(d),f.distance=p,u.spot=u.spot||{},u.spot.innerConeAngle=u.spot.innerConeAngle!==void 0?u.spot.innerConeAngle:0,u.spot.outerConeAngle=u.spot.outerConeAngle!==void 0?u.spot.outerConeAngle:Math.PI/4,f.angle=u.spot.outerConeAngle,f.penumbra=1-u.spot.innerConeAngle/u.spot.outerConeAngle,f.target.position.set(0,0,-1),f.add(f.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+u.type)}return f.position.set(0,0,0),f.decay=2,Dn(f,u),u.intensity!==void 0&&(f.intensity=u.intensity),f.name=n.createUniqueName(u.name||"light_"+r),o=Promise.resolve(f),n.cache.add(l,o),o}getDependency(r,n){if(r==="light")return this._loadLight(n)}createNodeAttachment(r){const n=this,l=this.parser,o=l.json.nodes[r],s=(o.extensions&&o.extensions[this.name]||{}).light;return s===void 0?null:this._loadLight(s).then(function(u){return l._getNodeRef(n.cache,s,u)})}}class Hm{constructor(){this.name=xe.KHR_MATERIALS_UNLIT}getMaterialType(){return ar}extendParams(r,n,l){const o=[];r.color=new xn(1,1,1),r.opacity=1;const s=n.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const u=s.baseColorFactor;r.color.fromArray(u),r.opacity=u[3]}s.baseColorTexture!==void 0&&o.push(l.assignTexture(r,"map",s.baseColorTexture,3001))}return Promise.all(o)}}class Vm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(r,n){const l=this.parser.json.materials[r];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const o=l.extensions[this.name].emissiveStrength;return o!==void 0&&(n.emissiveIntensity=o),Promise.resolve()}}class Gm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_CLEARCOAT}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],u=o.extensions[this.name];if(u.clearcoatFactor!==void 0&&(n.clearcoat=u.clearcoatFactor),u.clearcoatTexture!==void 0&&s.push(l.assignTexture(n,"clearcoatMap",u.clearcoatTexture)),u.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=u.clearcoatRoughnessFactor),u.clearcoatRoughnessTexture!==void 0&&s.push(l.assignTexture(n,"clearcoatRoughnessMap",u.clearcoatRoughnessTexture)),u.clearcoatNormalTexture!==void 0&&(s.push(l.assignTexture(n,"clearcoatNormalMap",u.clearcoatNormalTexture)),u.clearcoatNormalTexture.scale!==void 0)){const f=u.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new be(f,f)}return Promise.all(s)}}class Ym{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_IRIDESCENCE}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],u=o.extensions[this.name];return u.iridescenceFactor!==void 0&&(n.iridescence=u.iridescenceFactor),u.iridescenceTexture!==void 0&&s.push(l.assignTexture(n,"iridescenceMap",u.iridescenceTexture)),u.iridescenceIor!==void 0&&(n.iridescenceIOR=u.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),u.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=u.iridescenceThicknessMinimum),u.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=u.iridescenceThicknessMaximum),u.iridescenceThicknessTexture!==void 0&&s.push(l.assignTexture(n,"iridescenceThicknessMap",u.iridescenceThicknessTexture)),Promise.all(s)}}class Km{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_SHEEN}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[];n.sheenColor=new xn(0,0,0),n.sheenRoughness=0,n.sheen=1;const u=o.extensions[this.name];return u.sheenColorFactor!==void 0&&n.sheenColor.fromArray(u.sheenColorFactor),u.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=u.sheenRoughnessFactor),u.sheenColorTexture!==void 0&&s.push(l.assignTexture(n,"sheenColorMap",u.sheenColorTexture,3001)),u.sheenRoughnessTexture!==void 0&&s.push(l.assignTexture(n,"sheenRoughnessMap",u.sheenRoughnessTexture)),Promise.all(s)}}class Wm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_TRANSMISSION}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],u=o.extensions[this.name];return u.transmissionFactor!==void 0&&(n.transmission=u.transmissionFactor),u.transmissionTexture!==void 0&&s.push(l.assignTexture(n,"transmissionMap",u.transmissionTexture)),Promise.all(s)}}class Qm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_VOLUME}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],u=o.extensions[this.name];n.thickness=u.thicknessFactor!==void 0?u.thicknessFactor:0,u.thicknessTexture!==void 0&&s.push(l.assignTexture(n,"thicknessMap",u.thicknessTexture)),n.attenuationDistance=u.attenuationDistance||1/0;const f=u.attenuationColor||[1,1,1];return n.attenuationColor=new xn(f[0],f[1],f[2]),Promise.all(s)}}class qm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_IOR}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser.json.materials[r];if(!l.extensions||!l.extensions[this.name])return Promise.resolve();const o=l.extensions[this.name];return n.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class Xm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_SPECULAR}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],u=o.extensions[this.name];n.specularIntensity=u.specularFactor!==void 0?u.specularFactor:1,u.specularTexture!==void 0&&s.push(l.assignTexture(n,"specularIntensityMap",u.specularTexture));const f=u.specularColorFactor||[1,1,1];return n.specularColor=new xn(f[0],f[1],f[2]),u.specularColorTexture!==void 0&&s.push(l.assignTexture(n,"specularColorMap",u.specularColorTexture,3001)),Promise.all(s)}}class Zm{constructor(r){this.parser=r,this.name=xe.KHR_MATERIALS_ANISOTROPY}getMaterialType(r){const n=this.parser.json.materials[r];return!n.extensions||!n.extensions[this.name]?null:Sn}extendMaterialParams(r,n){const l=this.parser,o=l.json.materials[r];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const s=[],u=o.extensions[this.name];return u.anisotropyStrength!==void 0&&(n.anisotropy=u.anisotropyStrength),u.anisotropyRotation!==void 0&&(n.anisotropyRotation=u.anisotropyRotation),u.anisotropyTexture!==void 0&&s.push(l.assignTexture(n,"anisotropyMap",u.anisotropyTexture)),Promise.all(s)}}class $m{constructor(r){this.parser=r,this.name=xe.KHR_TEXTURE_BASISU}loadTexture(r){const n=this.parser,l=n.json,o=l.textures[r];if(!o.extensions||!o.extensions[this.name])return null;const s=o.extensions[this.name],u=n.options.ktx2Loader;if(!u){if(l.extensionsRequired&&l.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(r,s.source,u)}}class Jm{constructor(r){this.parser=r,this.name=xe.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(r){const n=this.name,l=this.parser,o=l.json,s=o.textures[r];if(!s.extensions||!s.extensions[n])return null;const u=s.extensions[n],f=o.images[u.source];let d=l.textureLoader;if(f.uri){const p=l.options.manager.getHandler(f.uri);p!==null&&(d=p)}return this.detectSupport().then(function(p){if(p)return l.loadTextureImage(r,u.source,d);if(o.extensionsRequired&&o.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return l.loadTexture(r)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(r){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){r(n.height===1)}})),this.isSupported}}class eg{constructor(r){this.parser=r,this.name=xe.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(r){const n=this.name,l=this.parser,o=l.json,s=o.textures[r];if(!s.extensions||!s.extensions[n])return null;const u=s.extensions[n],f=o.images[u.source];let d=l.textureLoader;if(f.uri){const p=l.options.manager.getHandler(f.uri);p!==null&&(d=p)}return this.detectSupport().then(function(p){if(p)return l.loadTextureImage(r,u.source,d);if(o.extensionsRequired&&o.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return l.loadTexture(r)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(r){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){r(n.height===1)}})),this.isSupported}}class tg{constructor(r){this.name=xe.EXT_MESHOPT_COMPRESSION,this.parser=r}loadBufferView(r){const n=this.parser.json,l=n.bufferViews[r];if(l.extensions&&l.extensions[this.name]){const o=l.extensions[this.name],s=this.parser.getDependency("buffer",o.buffer),u=this.parser.options.meshoptDecoder;if(!u||!u.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(f){const d=o.byteOffset||0,p=o.byteLength||0,m=o.count,g=o.byteStride,v=new Uint8Array(f,d,p);return u.decodeGltfBufferAsync?u.decodeGltfBufferAsync(m,g,v,o.mode,o.filter).then(function(b){return b.buffer}):u.ready.then(function(){const b=new ArrayBuffer(m*g);return u.decodeGltfBuffer(new Uint8Array(b),m,g,v,o.mode,o.filter),b})})}else return null}}class ng{constructor(r){this.name=xe.EXT_MESH_GPU_INSTANCING,this.parser=r}createNodeMesh(r){const n=this.parser.json,l=n.nodes[r];if(!l.extensions||!l.extensions[this.name]||l.mesh===void 0)return null;const o=n.meshes[l.mesh];for(const d of o.primitives)if(d.mode!==Ut.TRIANGLES&&d.mode!==Ut.TRIANGLE_STRIP&&d.mode!==Ut.TRIANGLE_FAN&&d.mode!==void 0)return null;const s=l.extensions[this.name].attributes,u=[],f={};for(const d in s)u.push(this.parser.getDependency("accessor",s[d]).then(p=>(f[d]=p,f[d])));return u.length<1?null:(u.push(this.parser.createNodeMesh(r)),Promise.all(u).then(d=>{const p=d.pop(),m=p.isGroup?p.children:[p],g=d[0].count,v=[];for(const b of m){const A=new Je,_=new V,w=new po,x=new V(1,1,1),S=new ah(b.geometry,b.material,g);for(let E=0;E<g;E++)f.TRANSLATION&&_.fromBufferAttribute(f.TRANSLATION,E),f.ROTATION&&w.fromBufferAttribute(f.ROTATION,E),f.SCALE&&x.fromBufferAttribute(f.SCALE,E),S.setMatrixAt(E,A.compose(_,w,x));for(const E in f)E!=="TRANSLATION"&&E!=="ROTATION"&&E!=="SCALE"&&b.geometry.setAttribute(E,f[E]);Nl.prototype.copy.call(S,b),this.parser.assignFinalMaterial(S),v.push(S)}return p.isGroup?(p.clear(),p.add(...v),p):v[0]}))}}const df="glTF",Ta=12,$c={JSON:1313821514,BIN:5130562};class rg{constructor(r){this.name=xe.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(r,0,Ta);if(this.header={magic:sr.decodeText(new Uint8Array(r.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==df)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const l=this.header.length-Ta,o=new DataView(r,Ta);let s=0;for(;s<l;){const u=o.getUint32(s,!0);s+=4;const f=o.getUint32(s,!0);if(s+=4,f===$c.JSON){const d=new Uint8Array(r,Ta+s,u);this.content=sr.decodeText(d)}else if(f===$c.BIN){const d=Ta+s;this.body=r.slice(d,d+u)}s+=u}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ag{constructor(r,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=xe.KHR_DRACO_MESH_COMPRESSION,this.json=r,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(r,n){const l=this.json,o=this.dracoLoader,s=r.extensions[this.name].bufferView,u=r.extensions[this.name].attributes,f={},d={},p={};for(const m in u){const g=bl[m]||m.toLowerCase();f[g]=u[m]}for(const m in r.attributes){const g=bl[m]||m.toLowerCase();if(u[m]!==void 0){const v=l.accessors[r.attributes[m]],b=Qr[v.componentType];p[g]=b.name,d[g]=v.normalized===!0}}return n.getDependency("bufferView",s).then(function(m){return new Promise(function(g){o.decodeDracoFile(m,function(v){for(const b in v.attributes){const A=v.attributes[b],_=d[b];_!==void 0&&(A.normalized=_)}g(v)},f,p)})})}}class ig{constructor(){this.name=xe.KHR_TEXTURE_TRANSFORM}extendTexture(r,n){return(n.texCoord===void 0||n.texCoord===r.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(r=r.clone(),n.texCoord!==void 0&&(r.channel=n.texCoord),n.offset!==void 0&&r.offset.fromArray(n.offset),n.rotation!==void 0&&(r.rotation=n.rotation),n.scale!==void 0&&r.repeat.fromArray(n.scale),r.needsUpdate=!0),r}}class og{constructor(){this.name=xe.KHR_MESH_QUANTIZATION}}class ff extends Lh{constructor(r,n,l,o){super(r,n,l,o)}copySampleValue_(r){const n=this.resultBuffer,l=this.sampleValues,o=this.valueSize,s=r*o*3+o;for(let u=0;u!==o;u++)n[u]=l[s+u];return n}interpolate_(r,n,l,o){const s=this.resultBuffer,u=this.sampleValues,f=this.valueSize,d=f*2,p=f*3,m=o-n,g=(l-n)/m,v=g*g,b=v*g,A=r*p,_=A-p,w=-2*b+3*v,x=b-v,S=1-w,E=x-v+g;for(let P=0;P!==f;P++){const M=u[_+P+f],R=u[_+P+d]*m,L=u[A+P+f],N=u[A+P]*m;s[P]=S*M+E*R+w*L+x*N}return s}}const sg=new po;class lg extends ff{interpolate_(r,n,l,o){const s=super.interpolate_(r,n,l,o);return sg.fromArray(s).normalize().toArray(s),s}}const Ut={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Qr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Jc={9728:dh,9729:ho,9984:ch,9985:uh,9986:lh,9987:Bd},ed={33071:ph,33648:fh,10497:fl},Gs={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bl={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Nm>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Bn={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ug={CUBICSPLINE:void 0,LINEAR:Ud,STEP:_h},Ys={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function cg(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new Il({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:qr})),a.DefaultMaterial}function rr(a,r,n){for(const l in n.extensions)a[l]===void 0&&(r.userData.gltfExtensions=r.userData.gltfExtensions||{},r.userData.gltfExtensions[l]=n.extensions[l])}function Dn(a,r){r.extras!==void 0&&(typeof r.extras=="object"?Object.assign(a.userData,r.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+r.extras))}function dg(a,r,n){let l=!1,o=!1,s=!1;for(let p=0,m=r.length;p<m;p++){const g=r[p];if(g.POSITION!==void 0&&(l=!0),g.NORMAL!==void 0&&(o=!0),g.COLOR_0!==void 0&&(s=!0),l&&o&&s)break}if(!l&&!o&&!s)return Promise.resolve(a);const u=[],f=[],d=[];for(let p=0,m=r.length;p<m;p++){const g=r[p];if(l){const v=g.POSITION!==void 0?n.getDependency("accessor",g.POSITION):a.attributes.position;u.push(v)}if(o){const v=g.NORMAL!==void 0?n.getDependency("accessor",g.NORMAL):a.attributes.normal;f.push(v)}if(s){const v=g.COLOR_0!==void 0?n.getDependency("accessor",g.COLOR_0):a.attributes.color;d.push(v)}}return Promise.all([Promise.all(u),Promise.all(f),Promise.all(d)]).then(function(p){const m=p[0],g=p[1],v=p[2];return l&&(a.morphAttributes.position=m),o&&(a.morphAttributes.normal=g),s&&(a.morphAttributes.color=v),a.morphTargetsRelative=!0,a})}function fg(a,r){if(a.updateMorphTargets(),r.weights!==void 0)for(let n=0,l=r.weights.length;n<l;n++)a.morphTargetInfluences[n]=r.weights[n];if(r.extras&&Array.isArray(r.extras.targetNames)){const n=r.extras.targetNames;if(a.morphTargetInfluences.length===n.length){a.morphTargetDictionary={};for(let l=0,o=n.length;l<o;l++)a.morphTargetDictionary[n[l]]=l}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function pg(a){let r;const n=a.extensions&&a.extensions[xe.KHR_DRACO_MESH_COMPRESSION];if(n?r="draco:"+n.bufferView+":"+n.indices+":"+Ks(n.attributes):r=a.indices+":"+Ks(a.attributes)+":"+a.mode,a.targets!==void 0)for(let l=0,o=a.targets.length;l<o;l++)r+=":"+Ks(a.targets[l]);return r}function Ks(a){let r="";const n=Object.keys(a).sort();for(let l=0,o=n.length;l<o;l++)r+=n[l]+":"+a[n[l]]+";";return r}function xl(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function hg(a){return a.search(/\.jpe?g($|\?)/i)>0||a.search(/^data\:image\/jpeg/)===0?"image/jpeg":a.search(/\.webp($|\?)/i)>0||a.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const mg=new Je;class gg{constructor(r={},n={}){this.json=r,this.extensions={},this.plugins={},this.options=n,this.cache=new Um,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let l=!1,o=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(l=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,o=navigator.userAgent.indexOf("Firefox")>-1,s=o?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||l||o&&s<98?this.textureLoader=new ih(this.options.manager):this.textureLoader=new oh(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Nd(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(r){this.extensions=r}setPlugins(r){this.plugins=r}parse(r,n){const l=this,o=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(u){return u._markDefs&&u._markDefs()}),Promise.all(this._invokeAll(function(u){return u.beforeRoot&&u.beforeRoot()})).then(function(){return Promise.all([l.getDependencies("scene"),l.getDependencies("animation"),l.getDependencies("camera")])}).then(function(u){const f={scene:u[0][o.scene||0],scenes:u[0],animations:u[1],cameras:u[2],asset:o.asset,parser:l,userData:{}};rr(s,f,o),Dn(f,o),Promise.all(l._invokeAll(function(d){return d.afterRoot&&d.afterRoot(f)})).then(function(){r(f)})}).catch(n)}_markDefs(){const r=this.json.nodes||[],n=this.json.skins||[],l=this.json.meshes||[];for(let o=0,s=n.length;o<s;o++){const u=n[o].joints;for(let f=0,d=u.length;f<d;f++)r[u[f]].isBone=!0}for(let o=0,s=r.length;o<s;o++){const u=r[o];u.mesh!==void 0&&(this._addNodeRef(this.meshCache,u.mesh),u.skin!==void 0&&(l[u.mesh].isSkinnedMesh=!0)),u.camera!==void 0&&this._addNodeRef(this.cameraCache,u.camera)}}_addNodeRef(r,n){n!==void 0&&(r.refs[n]===void 0&&(r.refs[n]=r.uses[n]=0),r.refs[n]++)}_getNodeRef(r,n,l){if(r.refs[n]<=1)return l;const o=l.clone(),s=(u,f)=>{const d=this.associations.get(u);d!=null&&this.associations.set(f,d);for(const[p,m]of u.children.entries())s(m,f.children[p])};return s(l,o),o.name+="_instance_"+r.uses[n]++,o}_invokeOne(r){const n=Object.values(this.plugins);n.push(this);for(let l=0;l<n.length;l++){const o=r(n[l]);if(o)return o}return null}_invokeAll(r){const n=Object.values(this.plugins);n.unshift(this);const l=[];for(let o=0;o<n.length;o++){const s=r(n[o]);s&&l.push(s)}return l}getDependency(r,n){const l=r+":"+n;let o=this.cache.get(l);if(!o){switch(r){case"scene":o=this.loadScene(n);break;case"node":o=this._invokeOne(function(s){return s.loadNode&&s.loadNode(n)});break;case"mesh":o=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(n)});break;case"accessor":o=this.loadAccessor(n);break;case"bufferView":o=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(n)});break;case"buffer":o=this.loadBuffer(n);break;case"material":o=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(n)});break;case"texture":o=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(n)});break;case"skin":o=this.loadSkin(n);break;case"animation":o=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(n)});break;case"camera":o=this.loadCamera(n);break;default:if(o=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(r,n)}),!o)throw new Error("Unknown type: "+r);break}this.cache.add(l,o)}return o}getDependencies(r){let n=this.cache.get(r);if(!n){const l=this,o=this.json[r+(r==="mesh"?"es":"s")]||[];n=Promise.all(o.map(function(s,u){return l.getDependency(r,u)})),this.cache.add(r,n)}return n}loadBuffer(r){const n=this.json.buffers[r],l=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&r===0)return Promise.resolve(this.extensions[xe.KHR_BINARY_GLTF].body);const o=this.options;return new Promise(function(s,u){l.load(sr.resolveURL(n.uri,o.path),s,void 0,function(){u(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(r){const n=this.json.bufferViews[r];return this.getDependency("buffer",n.buffer).then(function(l){const o=n.byteLength||0,s=n.byteOffset||0;return l.slice(s,s+o)})}loadAccessor(r){const n=this,l=this.json,o=this.json.accessors[r];if(o.bufferView===void 0&&o.sparse===void 0){const u=Gs[o.type],f=Qr[o.componentType],d=o.normalized===!0,p=new f(o.count*u);return Promise.resolve(new Na(p,u,d))}const s=[];return o.bufferView!==void 0?s.push(this.getDependency("bufferView",o.bufferView)):s.push(null),o.sparse!==void 0&&(s.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(s).then(function(u){const f=u[0],d=Gs[o.type],p=Qr[o.componentType],m=p.BYTES_PER_ELEMENT,g=m*d,v=o.byteOffset||0,b=o.bufferView!==void 0?l.bufferViews[o.bufferView].byteStride:void 0,A=o.normalized===!0;let _,w;if(b&&b!==g){const x=Math.floor(v/b),S="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+x+":"+o.count;let E=n.cache.get(S);E||(_=new p(f,x*b,o.count*b/m),E=new sh(_,b/m),n.cache.add(S,E)),w=new ir(E,d,v%b/m,A)}else f===null?_=new p(o.count*d):_=new p(f,v,o.count*d),w=new Na(_,d,A);if(o.sparse!==void 0){const x=Gs.SCALAR,S=Qr[o.sparse.indices.componentType],E=o.sparse.indices.byteOffset||0,P=o.sparse.values.byteOffset||0,M=new S(u[1],E,o.sparse.count*x),R=new p(u[2],P,o.sparse.count*d);f!==null&&(w=new Na(w.array.slice(),w.itemSize,w.normalized));for(let L=0,N=M.length;L<N;L++){const C=M[L];if(w.setX(C,R[L*d]),d>=2&&w.setY(C,R[L*d+1]),d>=3&&w.setZ(C,R[L*d+2]),d>=4&&w.setW(C,R[L*d+3]),d>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return w})}loadTexture(r){const n=this.json,l=this.options,o=n.textures[r].source,s=n.images[o];let u=this.textureLoader;if(s.uri){const f=l.manager.getHandler(s.uri);f!==null&&(u=f)}return this.loadTextureImage(r,o,u)}loadTextureImage(r,n,l){const o=this,s=this.json,u=s.textures[r],f=s.images[n],d=(f.uri||f.bufferView)+":"+u.sampler;if(this.textureCache[d])return this.textureCache[d];const p=this.loadImageSource(n,l).then(function(m){m.flipY=!1,m.name=u.name||f.name||"",m.name===""&&typeof f.uri=="string"&&f.uri.startsWith("data:image/")===!1&&(m.name=f.uri);const g=(s.samplers||{})[u.sampler]||{};return m.magFilter=Jc[g.magFilter]||ho,m.minFilter=Jc[g.minFilter]||Bd,m.wrapS=ed[g.wrapS]||fl,m.wrapT=ed[g.wrapT]||fl,o.associations.set(m,{textures:r}),m}).catch(function(){return null});return this.textureCache[d]=p,p}loadImageSource(r,n){const l=this,o=this.json,s=this.options;if(this.sourceCache[r]!==void 0)return this.sourceCache[r].then(g=>g.clone());const u=o.images[r],f=self.URL||self.webkitURL;let d=u.uri||"",p=!1;if(u.bufferView!==void 0)d=l.getDependency("bufferView",u.bufferView).then(function(g){p=!0;const v=new Blob([g],{type:u.mimeType});return d=f.createObjectURL(v),d});else if(u.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+r+" is missing URI and bufferView");const m=Promise.resolve(d).then(function(g){return new Promise(function(v,b){let A=v;n.isImageBitmapLoader===!0&&(A=function(_){const w=new ul(_);w.needsUpdate=!0,v(w)}),n.load(sr.resolveURL(g,s.path),A,void 0,b)})}).then(function(g){return p===!0&&f.revokeObjectURL(d),g.userData.mimeType=u.mimeType||hg(u.uri),g}).catch(function(g){throw console.error("THREE.GLTFLoader: Couldn't load texture",d),g});return this.sourceCache[r]=m,m}assignTexture(r,n,l,o){const s=this;return this.getDependency("texture",l.index).then(function(u){if(!u)return null;if(l.texCoord!==void 0&&l.texCoord>0&&(u=u.clone(),u.channel=l.texCoord),s.extensions[xe.KHR_TEXTURE_TRANSFORM]){const f=l.extensions!==void 0?l.extensions[xe.KHR_TEXTURE_TRANSFORM]:void 0;if(f){const d=s.associations.get(u);u=s.extensions[xe.KHR_TEXTURE_TRANSFORM].extendTexture(u,f),s.associations.set(u,d)}}return o!==void 0&&("colorSpace"in u?u.colorSpace=o===3001?"srgb":"srgb-linear":u.encoding=o),r[n]=u,u})}assignFinalMaterial(r){const n=r.geometry;let l=r.material;const o=n.attributes.tangent===void 0,s=n.attributes.color!==void 0,u=n.attributes.normal===void 0;if(r.isPoints){const f="PointsMaterial:"+l.uuid;let d=this.cache.get(f);d||(d=new hh,uo.prototype.copy.call(d,l),d.color.copy(l.color),d.map=l.map,d.sizeAttenuation=!1,this.cache.add(f,d)),l=d}else if(r.isLine){const f="LineBasicMaterial:"+l.uuid;let d=this.cache.get(f);d||(d=new mh,uo.prototype.copy.call(d,l),d.color.copy(l.color),d.map=l.map,this.cache.add(f,d)),l=d}if(o||s||u){let f="ClonedMaterial:"+l.uuid+":";o&&(f+="derivative-tangents:"),s&&(f+="vertex-colors:"),u&&(f+="flat-shading:");let d=this.cache.get(f);d||(d=l.clone(),s&&(d.vertexColors=!0),u&&(d.flatShading=!0),o&&(d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(f,d),this.associations.set(d,this.associations.get(l))),l=d}r.material=l}getMaterialType(){return Il}loadMaterial(r){const n=this,l=this.json,o=this.extensions,s=l.materials[r];let u;const f={},d=s.extensions||{},p=[];if(d[xe.KHR_MATERIALS_UNLIT]){const g=o[xe.KHR_MATERIALS_UNLIT];u=g.getMaterialType(),p.push(g.extendParams(f,s,n))}else{const g=s.pbrMetallicRoughness||{};if(f.color=new xn(1,1,1),f.opacity=1,Array.isArray(g.baseColorFactor)){const v=g.baseColorFactor;f.color.fromArray(v),f.opacity=v[3]}g.baseColorTexture!==void 0&&p.push(n.assignTexture(f,"map",g.baseColorTexture,3001)),f.metalness=g.metallicFactor!==void 0?g.metallicFactor:1,f.roughness=g.roughnessFactor!==void 0?g.roughnessFactor:1,g.metallicRoughnessTexture!==void 0&&(p.push(n.assignTexture(f,"metalnessMap",g.metallicRoughnessTexture)),p.push(n.assignTexture(f,"roughnessMap",g.metallicRoughnessTexture))),u=this._invokeOne(function(v){return v.getMaterialType&&v.getMaterialType(r)}),p.push(Promise.all(this._invokeAll(function(v){return v.extendMaterialParams&&v.extendMaterialParams(r,f)})))}s.doubleSided===!0&&(f.side=Od);const m=s.alphaMode||Ys.OPAQUE;if(m===Ys.BLEND?(f.transparent=!0,f.depthWrite=!1):(f.transparent=!1,m===Ys.MASK&&(f.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&u!==ar&&(p.push(n.assignTexture(f,"normalMap",s.normalTexture)),f.normalScale=new be(1,1),s.normalTexture.scale!==void 0)){const g=s.normalTexture.scale;f.normalScale.set(g,g)}return s.occlusionTexture!==void 0&&u!==ar&&(p.push(n.assignTexture(f,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(f.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&u!==ar&&(f.emissive=new xn().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&u!==ar&&p.push(n.assignTexture(f,"emissiveMap",s.emissiveTexture,3001)),Promise.all(p).then(function(){const g=new u(f);return s.name&&(g.name=s.name),Dn(g,s),n.associations.set(g,{materials:r}),s.extensions&&rr(o,g,s),g})}createUniqueName(r){const n=gh.sanitizeNodeName(r||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(r){const n=this,l=this.extensions,o=this.primitiveCache;function s(f){return l[xe.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(f,n).then(function(d){return td(d,f,n)})}const u=[];for(let f=0,d=r.length;f<d;f++){const p=r[f],m=pg(p),g=o[m];if(g)u.push(g.promise);else{let v;p.extensions&&p.extensions[xe.KHR_DRACO_MESH_COMPRESSION]?v=s(p):v=td(new zl,p,n),o[m]={primitive:p,promise:v},u.push(v)}}return Promise.all(u)}loadMesh(r){const n=this,l=this.json,o=this.extensions,s=l.meshes[r],u=s.primitives,f=[];for(let d=0,p=u.length;d<p;d++){const m=u[d].material===void 0?cg(this.cache):this.getDependency("material",u[d].material);f.push(m)}return f.push(n.loadGeometries(u)),Promise.all(f).then(function(d){const p=d.slice(0,d.length-1),m=d[d.length-1],g=[];for(let b=0,A=m.length;b<A;b++){const _=m[b],w=u[b];let x;const S=p[b];if(w.mode===Ut.TRIANGLES||w.mode===Ut.TRIANGLE_STRIP||w.mode===Ut.TRIANGLE_FAN||w.mode===void 0)x=s.isSkinnedMesh===!0?new vh(_,S):new Vn(_,S),x.isSkinnedMesh===!0&&x.normalizeSkinWeights(),w.mode===Ut.TRIANGLE_STRIP?x.geometry=qc(x.geometry,Fd):w.mode===Ut.TRIANGLE_FAN&&(x.geometry=qc(x.geometry,pl));else if(w.mode===Ut.LINES)x=new yh(_,S);else if(w.mode===Ut.LINE_STRIP)x=new bh(_,S);else if(w.mode===Ut.LINE_LOOP)x=new xh(_,S);else if(w.mode===Ut.POINTS)x=new wh(_,S);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+w.mode);Object.keys(x.geometry.morphAttributes).length>0&&fg(x,s),x.name=n.createUniqueName(s.name||"mesh_"+r),Dn(x,s),w.extensions&&rr(o,x,w),n.assignFinalMaterial(x),g.push(x)}for(let b=0,A=g.length;b<A;b++)n.associations.set(g[b],{meshes:r,primitives:b});if(g.length===1)return s.extensions&&rr(o,g[0],s),g[0];const v=new or;s.extensions&&rr(o,v,s),n.associations.set(v,{meshes:r});for(let b=0,A=g.length;b<A;b++)v.add(g[b]);return v})}loadCamera(r){let n;const l=this.json.cameras[r],o=l[l.type];if(!o){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return l.type==="perspective"?n=new Yr(Dd.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):l.type==="orthographic"&&(n=new Gr(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),l.name&&(n.name=this.createUniqueName(l.name)),Dn(n,l),Promise.resolve(n)}loadSkin(r){const n=this.json.skins[r],l=[];for(let o=0,s=n.joints.length;o<s;o++)l.push(this._loadNodeShallow(n.joints[o]));return n.inverseBindMatrices!==void 0?l.push(this.getDependency("accessor",n.inverseBindMatrices)):l.push(null),Promise.all(l).then(function(o){const s=o.pop(),u=o,f=[],d=[];for(let p=0,m=u.length;p<m;p++){const g=u[p];if(g){f.push(g);const v=new Je;s!==null&&v.fromArray(s.array,p*16),d.push(v)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[p])}return new Sh(f,d)})}loadAnimation(r){const n=this.json.animations[r],l=n.name?n.name:"animation_"+r,o=[],s=[],u=[],f=[],d=[];for(let p=0,m=n.channels.length;p<m;p++){const g=n.channels[p],v=n.samplers[g.sampler],b=g.target,A=b.node,_=n.parameters!==void 0?n.parameters[v.input]:v.input,w=n.parameters!==void 0?n.parameters[v.output]:v.output;b.node!==void 0&&(o.push(this.getDependency("node",A)),s.push(this.getDependency("accessor",_)),u.push(this.getDependency("accessor",w)),f.push(v),d.push(b))}return Promise.all([Promise.all(o),Promise.all(s),Promise.all(u),Promise.all(f),Promise.all(d)]).then(function(p){const m=p[0],g=p[1],v=p[2],b=p[3],A=p[4],_=[];for(let w=0,x=m.length;w<x;w++){const S=m[w],E=g[w],P=v[w],M=b[w],R=A[w];if(S===void 0)continue;S.updateMatrix();let L;switch(Bn[R.path]){case Bn.weights:L=Ph;break;case Bn.rotation:L=zc;break;case Bn.position:case Bn.scale:default:L=Th;break}const N=S.name?S.name:S.uuid,C=M.interpolation!==void 0?ug[M.interpolation]:Ud,O=[];Bn[R.path]===Bn.weights?S.traverse(function(F){F.morphTargetInfluences&&O.push(F.name?F.name:F.uuid)}):O.push(N);let B=P.array;if(P.normalized){const F=xl(B.constructor),K=new Float32Array(B.length);for(let $=0,le=B.length;$<le;$++)K[$]=B[$]*F;B=K}for(let F=0,K=O.length;F<K;F++){const $=new L(O[F]+"."+Bn[R.path],E.array,B,C);M.interpolation==="CUBICSPLINE"&&($.createInterpolant=function(le){const fe=this instanceof zc?lg:ff;return new fe(this.times,this.values,this.getValueSize()/3,le)},$.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),_.push($)}}return new Eh(l,void 0,_)})}createNodeMesh(r){const n=this.json,l=this,o=n.nodes[r];return o.mesh===void 0?null:l.getDependency("mesh",o.mesh).then(function(s){const u=l._getNodeRef(l.meshCache,o.mesh,s);return o.weights!==void 0&&u.traverse(function(f){if(f.isMesh)for(let d=0,p=o.weights.length;d<p;d++)f.morphTargetInfluences[d]=o.weights[d]}),u})}loadNode(r){const n=this.json,l=this,o=n.nodes[r],s=l._loadNodeShallow(r),u=[],f=o.children||[];for(let p=0,m=f.length;p<m;p++)u.push(l.getDependency("node",f[p]));const d=o.skin===void 0?Promise.resolve(null):l.getDependency("skin",o.skin);return Promise.all([s,Promise.all(u),d]).then(function(p){const m=p[0],g=p[1],v=p[2];v!==null&&m.traverse(function(b){b.isSkinnedMesh&&b.bind(v,mg)});for(let b=0,A=g.length;b<A;b++)m.add(g[b]);return m})}_loadNodeShallow(r){const n=this.json,l=this.extensions,o=this;if(this.nodeCache[r]!==void 0)return this.nodeCache[r];const s=n.nodes[r],u=s.name?o.createUniqueName(s.name):"",f=[],d=o._invokeOne(function(p){return p.createNodeMesh&&p.createNodeMesh(r)});return d&&f.push(d),s.camera!==void 0&&f.push(o.getDependency("camera",s.camera).then(function(p){return o._getNodeRef(o.cameraCache,s.camera,p)})),o._invokeAll(function(p){return p.createNodeAttachment&&p.createNodeAttachment(r)}).forEach(function(p){f.push(p)}),this.nodeCache[r]=Promise.all(f).then(function(p){let m;if(s.isBone===!0?m=new Ah:p.length>1?m=new or:p.length===1?m=p[0]:m=new Nl,m!==p[0])for(let g=0,v=p.length;g<v;g++)m.add(p[g]);if(s.name&&(m.userData.name=s.name,m.name=u),Dn(m,s),s.extensions&&rr(l,m,s),s.matrix!==void 0){const g=new Je;g.fromArray(s.matrix),m.applyMatrix4(g)}else s.translation!==void 0&&m.position.fromArray(s.translation),s.rotation!==void 0&&m.quaternion.fromArray(s.rotation),s.scale!==void 0&&m.scale.fromArray(s.scale);return o.associations.has(m)||o.associations.set(m,{}),o.associations.get(m).nodes=r,m}),this.nodeCache[r]}loadScene(r){const n=this.extensions,l=this.json.scenes[r],o=this,s=new or;l.name&&(s.name=o.createUniqueName(l.name)),Dn(s,l),l.extensions&&rr(n,s,l);const u=l.nodes||[],f=[];for(let d=0,p=u.length;d<p;d++)f.push(o.getDependency("node",u[d]));return Promise.all(f).then(function(d){for(let m=0,g=d.length;m<g;m++)s.add(d[m]);const p=m=>{const g=new Map;for(const[v,b]of o.associations)(v instanceof uo||v instanceof ul)&&g.set(v,b);return m.traverse(v=>{const b=o.associations.get(v);b!=null&&g.set(v,b)}),g};return o.associations=p(s),s})}}function vg(a,r,n){const l=r.attributes,o=new Qe;if(l.POSITION!==void 0){const f=n.json.accessors[l.POSITION],d=f.min,p=f.max;if(d!==void 0&&p!==void 0){if(o.set(new V(d[0],d[1],d[2]),new V(p[0],p[1],p[2])),f.normalized){const m=xl(Qr[f.componentType]);o.min.multiplyScalar(m),o.max.multiplyScalar(m)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=r.targets;if(s!==void 0){const f=new V,d=new V;for(let p=0,m=s.length;p<m;p++){const g=s[p];if(g.POSITION!==void 0){const v=n.json.accessors[g.POSITION],b=v.min,A=v.max;if(b!==void 0&&A!==void 0){if(d.setX(Math.max(Math.abs(b[0]),Math.abs(A[0]))),d.setY(Math.max(Math.abs(b[1]),Math.abs(A[1]))),d.setZ(Math.max(Math.abs(b[2]),Math.abs(A[2]))),v.normalized){const _=xl(Qr[v.componentType]);d.multiplyScalar(_)}f.max(d)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(f)}a.boundingBox=o;const u=new Zr;o.getCenter(u.center),u.radius=o.min.distanceTo(o.max)/2,a.boundingSphere=u}function td(a,r,n){const l=r.attributes,o=[];function s(u,f){return n.getDependency("accessor",u).then(function(d){a.setAttribute(f,d)})}for(const u in l){const f=bl[u]||u.toLowerCase();f in a.attributes||o.push(s(l[u],f))}if(r.indices!==void 0&&!a.index){const u=n.getDependency("accessor",r.indices).then(function(f){a.setIndex(f)});o.push(u)}return Dn(a,r),vg(a,r,n),Promise.all(o).then(function(){return r.targets!==void 0?dg(a,r.targets,n):a})}var yg=Object.defineProperty,bg=(a,r,n)=>r in a?yg(a,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[r]=n,Oe=(a,r,n)=>(bg(a,typeof r!="symbol"?r+"":r,n),n);const Fe={ComponentState:{DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"},ComponentProperty:{BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"},ComponentType:{TOUCHPAD:"touchpad"},ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:{TRANSFORM:"transform",VISIBILITY:"visibility"}};async function pf(a){const r=await fetch(a);if(r.ok)return r.json();throw new Error(r.statusText)}async function xg(a){if(!a)throw new Error("No basePath supplied");return await pf(`${a}/profilesList.json`)}async function wg(a,r,n=null,l=!0){if(!a)throw new Error("No xrInputSource supplied");if(!r)throw new Error("No basePath supplied");const o=await xg(r);let s;if(a.profiles.some(d=>{const p=o[d];return p&&(s={profileId:d,profilePath:`${r}/${p.path}`,deprecated:!!p.deprecated}),!!s}),!s){if(!n)throw new Error("No matching profile name found");const d=o[n];if(!d)throw new Error(`No matching profile name found and default profile "${n}" missing.`);s={profileId:n,profilePath:`${r}/${d.path}`,deprecated:!!d.deprecated}}const u=await pf(s.profilePath);let f;if(l){let d;if(a.handedness==="any"?d=u.layouts[Object.keys(u.layouts)[0]]:d=u.layouts[a.handedness],!d)throw new Error(`No matching handedness, ${a.handedness}, in profile ${s.profileId}`);d.assetPath&&(f=s.profilePath.replace("profile.json",d.assetPath))}return{profile:u,assetPath:f}}const Sg={xAxis:0,yAxis:0,button:0,state:Fe.ComponentState.DEFAULT};function _g(a=0,r=0){let n=a,l=r;if(Math.sqrt(a*a+r*r)>1){const o=Math.atan2(r,a);n=Math.cos(o),l=Math.sin(o)}return{normalizedXAxis:n*.5+.5,normalizedYAxis:l*.5+.5}}class Eg{constructor(r){Oe(this,"value"),Oe(this,"componentProperty"),Oe(this,"states"),Oe(this,"valueNodeName"),Oe(this,"valueNodeProperty"),Oe(this,"minNodeName"),Oe(this,"maxNodeName"),Oe(this,"valueNode"),Oe(this,"minNode"),Oe(this,"maxNode"),this.componentProperty=r.componentProperty,this.states=r.states,this.valueNodeName=r.valueNodeName,this.valueNodeProperty=r.valueNodeProperty,this.valueNodeProperty===Fe.VisualResponseProperty.TRANSFORM&&(this.minNodeName=r.minNodeName,this.maxNodeName=r.maxNodeName),this.value=0,this.updateFromComponent(Sg)}updateFromComponent({xAxis:r,yAxis:n,button:l,state:o}){const{normalizedXAxis:s,normalizedYAxis:u}=_g(r,n);switch(this.componentProperty){case Fe.ComponentProperty.X_AXIS:this.value=this.states.includes(o)?s:.5;break;case Fe.ComponentProperty.Y_AXIS:this.value=this.states.includes(o)?u:.5;break;case Fe.ComponentProperty.BUTTON:this.value=this.states.includes(o)&&l?l:0;break;case Fe.ComponentProperty.STATE:this.valueNodeProperty===Fe.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(o):this.value=this.states.includes(o)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Ag{constructor(r,n){if(Oe(this,"id"),Oe(this,"values"),Oe(this,"type"),Oe(this,"gamepadIndices"),Oe(this,"rootNodeName"),Oe(this,"visualResponses"),Oe(this,"touchPointNodeName"),Oe(this,"touchPointNode"),!r||!n||!n.visualResponses||!n.gamepadIndices||Object.keys(n.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=r,this.type=n.type,this.rootNodeName=n.rootNodeName,this.touchPointNodeName=n.touchPointNodeName,this.visualResponses={},Object.keys(n.visualResponses).forEach(l=>{const o=new Eg(n.visualResponses[l]);this.visualResponses[l]=o}),this.gamepadIndices=Object.assign({},n.gamepadIndices),this.values={state:Fe.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(r){if(this.values.state=Fe.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&r.buttons.length>this.gamepadIndices.button){const n=r.buttons[this.gamepadIndices.button];this.values.button=n.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,n.pressed||this.values.button===1?this.values.state=Fe.ComponentState.PRESSED:(n.touched||this.values.button>Fe.ButtonTouchThreshold)&&(this.values.state=Fe.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&r.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=r.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Fe.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Fe.AxisTouchThreshold&&(this.values.state=Fe.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&r.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=r.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Fe.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Fe.AxisTouchThreshold&&(this.values.state=Fe.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(n=>{n.updateFromComponent(this.values)})}}class Tg{constructor(r,n,l){if(Oe(this,"xrInputSource"),Oe(this,"assetUrl"),Oe(this,"layoutDescription"),Oe(this,"id"),Oe(this,"components"),!r)throw new Error("No xrInputSource supplied");if(!n)throw new Error("No profile supplied");if(!n.layouts[r.handedness])throw new Error("No layout for "+r.handedness+" handedness");this.xrInputSource=r,this.assetUrl=l,this.id=n.profileId,this.layoutDescription=n.layouts[r.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(o=>{const s=this.layoutDescription.components[o];this.components[o]=new Ag(o,s)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const r=[];return Object.values(this.components).forEach(n=>{r.push(n.data)}),r}updateFromGamepad(){Object.values(this.components).forEach(r=>{r.updateFromGamepad(this.xrInputSource.gamepad)})}}const nd=new Qe,Yi=new V;class Hl extends Jp{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const r=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],n=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],l=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(l),this.setAttribute("position",new Ic(r,3)),this.setAttribute("uv",new Ic(n,2))}applyMatrix4(r){const n=this.attributes.instanceStart,l=this.attributes.instanceEnd;return n!==void 0&&(n.applyMatrix4(r),l.applyMatrix4(r),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(r){let n;r instanceof Float32Array?n=r:Array.isArray(r)&&(n=new Float32Array(r));const l=new cl(n,6,1);return this.setAttribute("instanceStart",new ir(l,3,0)),this.setAttribute("instanceEnd",new ir(l,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(r,n=3){let l;r instanceof Float32Array?l=r:Array.isArray(r)&&(l=new Float32Array(r));const o=new cl(l,n*2,1);return this.setAttribute("instanceColorStart",new ir(o,n,0)),this.setAttribute("instanceColorEnd",new ir(o,n,n)),this}fromWireframeGeometry(r){return this.setPositions(r.attributes.position.array),this}fromEdgesGeometry(r){return this.setPositions(r.attributes.position.array),this}fromMesh(r){return this.fromWireframeGeometry(new eh(r.geometry)),this}fromLineSegments(r){const n=r.geometry;return this.setPositions(n.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Qe);const r=this.attributes.instanceStart,n=this.attributes.instanceEnd;r!==void 0&&n!==void 0&&(this.boundingBox.setFromBufferAttribute(r),nd.setFromBufferAttribute(n),this.boundingBox.union(nd))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zr),this.boundingBox===null&&this.computeBoundingBox();const r=this.attributes.instanceStart,n=this.attributes.instanceEnd;if(r!==void 0&&n!==void 0){const l=this.boundingSphere.center;this.boundingBox.getCenter(l);let o=0;for(let s=0,u=r.count;s<u;s++)Yi.fromBufferAttribute(r,s),o=Math.max(o,l.distanceToSquared(Yi)),Yi.fromBufferAttribute(n,s),o=Math.max(o,l.distanceToSquared(Yi));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(r){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(r)}}class hf extends Hl{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(r){const n=r.length-3,l=new Float32Array(2*n);for(let o=0;o<n;o+=3)l[2*o]=r[o],l[2*o+1]=r[o+1],l[2*o+2]=r[o+2],l[2*o+3]=r[o+3],l[2*o+4]=r[o+4],l[2*o+5]=r[o+5];return super.setPositions(l),this}setColors(r,n=3){const l=r.length-n,o=new Float32Array(2*l);if(n===3)for(let s=0;s<l;s+=n)o[2*s]=r[s],o[2*s+1]=r[s+1],o[2*s+2]=r[s+2],o[2*s+3]=r[s+3],o[2*s+4]=r[s+4],o[2*s+5]=r[s+5];else for(let s=0;s<l;s+=n)o[2*s]=r[s],o[2*s+1]=r[s+1],o[2*s+2]=r[s+2],o[2*s+3]=r[s+3],o[2*s+4]=r[s+4],o[2*s+5]=r[s+5],o[2*s+6]=r[s+6],o[2*s+7]=r[s+7];return super.setColors(o,n),this}fromLine(r){const n=r.geometry;return this.setPositions(n.attributes.position.array),this}}class Vl extends $p{constructor(r){super({type:"LineMaterial",uniforms:dl.clone(dl.merge([Rc.common,Rc.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new be(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${parseInt(jd.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(n){this.uniforms.diffuse.value=n}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(n){n===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(n){this.uniforms.linewidth.value=n}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(n){!!n!="USE_DASH"in this.defines&&(this.needsUpdate=!0),n===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(n){this.uniforms.dashScale.value=n}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(n){this.uniforms.dashSize.value=n}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(n){this.uniforms.dashOffset.value=n}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(n){this.uniforms.gapSize.value=n}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(n){this.uniforms.opacity.value=n}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(n){this.uniforms.resolution.value.copy(n)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(n){!!n!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),n===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(r)}}const rd=new V,ad=new V,nt=new Da,rt=new Da,sn=new Da,Ws=new V,Qs=new Je,ct=new dn,id=new V,Ki=new Qe,Wi=new Zr,ln=new Da;let un,wl,mf,ur;function od(a,r,n){return ln.set(0,0,-r,1).applyMatrix4(a.projectionMatrix),ln.multiplyScalar(1/ln.w),ln.x=ur/n.width,ln.y=ur/n.height,ln.applyMatrix4(a.projectionMatrixInverse),ln.multiplyScalar(1/ln.w),Math.abs(Math.max(ln.x,ln.y))}function Pg(a,r){for(let n=0,l=wl.count;n<l;n++){ct.start.fromBufferAttribute(wl,n),ct.end.fromBufferAttribute(mf,n);const o=new V,s=new V;un.distanceSqToSegment(ct.start,ct.end,s,o),s.distanceTo(o)<ur*.5&&r.push({point:s,pointOnLine:o,distance:un.origin.distanceTo(s),object:a,face:null,faceIndex:n,uv:null,uv2:null})}}function Mg(a,r,n){const l=r.projectionMatrix,o=a.material.resolution,s=a.matrixWorld,u=a.geometry,f=u.attributes.instanceStart,d=u.attributes.instanceEnd,p=-r.near;un.at(1,sn),sn.w=1,sn.applyMatrix4(r.matrixWorldInverse),sn.applyMatrix4(l),sn.multiplyScalar(1/sn.w),sn.x*=o.x/2,sn.y*=o.y/2,sn.z=0,Ws.copy(sn),Qs.multiplyMatrices(r.matrixWorldInverse,s);for(let m=0,g=f.count;m<g;m++){if(nt.fromBufferAttribute(f,m),rt.fromBufferAttribute(d,m),nt.w=1,rt.w=1,nt.applyMatrix4(Qs),rt.applyMatrix4(Qs),nt.z>p&&rt.z>p)continue;if(nt.z>p){const w=nt.z-rt.z,x=(nt.z-p)/w;nt.lerp(rt,x)}else if(rt.z>p){const w=rt.z-nt.z,x=(rt.z-p)/w;rt.lerp(nt,x)}nt.applyMatrix4(l),rt.applyMatrix4(l),nt.multiplyScalar(1/nt.w),rt.multiplyScalar(1/rt.w),nt.x*=o.x/2,nt.y*=o.y/2,rt.x*=o.x/2,rt.y*=o.y/2,ct.start.copy(nt),ct.start.z=0,ct.end.copy(rt),ct.end.z=0;const v=ct.closestPointToPointParameter(Ws,!0);ct.at(v,id);const b=Dd.lerp(nt.z,rt.z,v),A=b>=-1&&b<=1,_=Ws.distanceTo(id)<ur*.5;if(A&&_){ct.start.fromBufferAttribute(f,m),ct.end.fromBufferAttribute(d,m),ct.start.applyMatrix4(s),ct.end.applyMatrix4(s);const w=new V,x=new V;un.distanceSqToSegment(ct.start,ct.end,x,w),n.push({point:x,pointOnLine:w,distance:un.origin.distanceTo(x),object:a,face:null,faceIndex:m,uv:null,uv2:null})}}}class gf extends Vn{constructor(r=new Hl,n=new Vl({color:Math.random()*16777215})){super(r,n),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const r=this.geometry,n=r.attributes.instanceStart,l=r.attributes.instanceEnd,o=new Float32Array(2*n.count);for(let u=0,f=0,d=n.count;u<d;u++,f+=2)rd.fromBufferAttribute(n,u),ad.fromBufferAttribute(l,u),o[f]=f===0?0:o[f-1],o[f+1]=o[f]+rd.distanceTo(ad);const s=new cl(o,2,1);return r.setAttribute("instanceDistanceStart",new ir(s,1,0)),r.setAttribute("instanceDistanceEnd",new ir(s,1,1)),this}raycast(r,n){const l=this.material.worldUnits,o=r.camera;o===null&&!l&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=r.params.Line2!==void 0&&r.params.Line2.threshold||0;un=r.ray;const u=this.matrixWorld,f=this.geometry,d=this.material;ur=d.linewidth+s,wl=f.attributes.instanceStart,mf=f.attributes.instanceEnd,f.boundingSphere===null&&f.computeBoundingSphere(),Wi.copy(f.boundingSphere).applyMatrix4(u);let p;if(l)p=ur*.5;else{const g=Math.max(o.near,Wi.distanceToPoint(un.origin));p=od(o,g,d.resolution)}if(Wi.radius+=p,un.intersectsSphere(Wi)===!1)return;f.boundingBox===null&&f.computeBoundingBox(),Ki.copy(f.boundingBox).applyMatrix4(u);let m;if(l)m=ur*.5;else{const g=Math.max(o.near,Ki.distanceToPoint(un.origin));m=od(o,g,d.resolution)}Ki.expandByScalar(m),un.intersectsBox(Ki)!==!1&&(l?Pg(this,n):Mg(this,o,n))}}class Lg extends gf{constructor(r=new hf,n=new Vl({color:Math.random()*16777215})){super(r,n),this.isLine2=!0,this.type="Line2"}}const Cg="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",Rg="generic-trigger";class Ig{constructor(r=null,n=Cg){this.gltfLoader=r??new cf,this.path=n,this._assetCache={}}initializeControllerModel(r,n){return n.targetRayMode!=="tracked-pointer"||!n.gamepad?Promise.resolve():wg(n,this.path,Rg).then(({profile:l,assetPath:o})=>{if(!o)throw new Error("no asset path");const s=new Tg(n,l,o);r.connectMotionController(s);const u=s.assetUrl,f=this._assetCache[u];if(f){const d=f.scene.clone();r.connectModel(d)}else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(u,d=>{if(!r.motionController){console.warn("motionController gone while gltf load, bailing...");return}this._assetCache[u]=d;const p=d.scene.clone();r.connectModel(p)},void 0,()=>{throw new Error(`Asset ${u} missing or malformed.`)})}}).catch(l=>{console.warn(l)})}}const sd=a=>"envMap"in a,ld=(a,r)=>{a.envMap=r,a.needsUpdate=!0},vf=(a,r)=>{r instanceof Vn&&(Array.isArray(r.material)?r.material.forEach(n=>sd(n)?ld(n,a):void 0):sd(r.material)&&ld(r.material,a))},ud=a=>"envMapIntensity"in a,cd=(a,r)=>{a.envMapIntensity=r,a.needsUpdate=!0},Sl=(a,r)=>{r instanceof Vn&&(Array.isArray(r.material)?r.material.forEach(n=>ud(n)?cd(n,a):void 0):ud(r.material)&&cd(r.material,a))};function zg(a,r){Object.values(a.components).forEach(n=>{const{type:l,touchPointNodeName:o,visualResponses:s}=n;if(l===Fe.ComponentType.TOUCHPAD&&o)if(n.touchPointNode=r.getObjectByName(o),n.touchPointNode){const u=new zh(.001),f=new ar({color:255}),d=new Vn(u,f);n.touchPointNode.add(d)}else console.warn(`Could not find touch dot, ${n.touchPointNodeName}, in touchpad component ${n.id}`);Object.values(s).forEach(u=>{const{valueNodeName:f,minNodeName:d,maxNodeName:p,valueNodeProperty:m}=u;if(m===Fe.VisualResponseProperty.TRANSFORM&&d&&p){if(u.minNode=r.getObjectByName(d),u.maxNode=r.getObjectByName(p),!u.minNode){console.warn(`Could not find ${d} in the model`);return}if(!u.maxNode){console.warn(`Could not find ${p} in the model`);return}}u.valueNode=r.getObjectByName(f),u.valueNode||console.warn(`Could not find ${f} in the model`)})})}function kg(a,r){zg(a.motionController,r),(a.envMap||a.envMapIntensity!=null)&&r.traverse(n=>{a.envMap&&vf(a.envMap,n),a.envMapIntensity!=null&&Sl(a.envMapIntensity,n)}),a.add(r)}class Ng extends or{constructor(){super(),this.motionController=null,this.envMap=null,this.envMapIntensity=1,this.scene=null}setEnvironmentMap(r,n=1){var l;return this.envMap===r&&this.envMapIntensity===n?this:(this.envMap=r,this.envMapIntensity=n,(l=this.scene)==null||l.traverse(o=>{vf(r,o),Sl(n,o)}),this)}setEnvironmentMapIntensity(r){var n;return this.envMapIntensity===r?this:(this.envMapIntensity=r,(n=this.scene)==null||n.traverse(l=>Sl(r,l)),this)}connectModel(r){if(!this.motionController){console.warn("scene tried to add, but no motion controller");return}this.scene=r,kg(this,r),this.dispatchEvent({type:"modelconnected",data:r})}connectMotionController(r){this.motionController=r,this.dispatchEvent({type:"motionconnected",data:r})}updateMatrixWorld(r){super.updateMatrixWorld(r),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(n=>{Object.values(n.visualResponses).forEach(l=>{const{valueNode:o,minNode:s,maxNode:u,value:f,valueNodeProperty:d}=l;o&&(d===Fe.VisualResponseProperty.VISIBILITY&&typeof f=="boolean"?o.visible=f:d===Fe.VisualResponseProperty.TRANSFORM&&s&&u&&typeof f=="number"&&(o.quaternion.slerpQuaternions(s.quaternion,u.quaternion,f),o.position.lerpVectors(s.position,u.position,f)))})}))}disconnect(){this.dispatchEvent({type:"motiondisconnected",data:this.motionController}),this.dispatchEvent({type:"modeldisconnected",data:this.scene}),this.motionController=null,this.scene&&this.remove(this.scene),this.scene=null}dispose(){this.disconnect()}}const jg=z.forwardRef(function({target:a,hideOnBlur:r=!1,...n},l){const o=He(f=>f.hoverState),s=z.useRef(null),u=z.useMemo(()=>new zl().setFromPoints([new V(0,0,0),new V(0,0,-1)]),[]);return z.useImperativeHandle(l,()=>s.current),dr(()=>{if(!a.inputSource)return;let f=1;const d=o[a.inputSource.handedness].values().next().value;d&&a.inputSource.handedness!=="none"?(f=d.distance,r&&(s.current.visible=!1)):r&&(s.current.visible=!0);const p=-.01;s.current.scale.z=f+p}),z.createElement("line",{ref:s,geometry:u,"material-opacity":.8,"material-transparent":!0,...n})}),Bg=new Ig,Og=({target:a,envMap:r,envMapIntensity:n})=>{const l=z.useRef(null),o=cn(d=>{r!=null&&d.setEnvironmentMap(r)}),s=cn(d=>d.setEnvironmentMap(null)),u=cn(d=>{n!=null&&d.setEnvironmentMapIntensity(n)}),f=z.useCallback(d=>{var p,m,g;if(l.current=d,d){if(a.xrControllerModel=d,(p=a.inputSource)!=null&&p.hand)return;o.current(d),u.current(d),a.inputSource?Bg.initializeControllerModel(d,a.inputSource):console.warn("no input source on XRController when handleControllerModel")}else{if((m=a.inputSource)!=null&&m.hand)return;(g=a.xrControllerModel)==null||g.disconnect(),a.xrControllerModel=null}},[a,u,o]);return z.useLayoutEffect(()=>{l.current&&(r?o.current(l.current):s.current(l.current))},[r,o,s]),z.useLayoutEffect(()=>{l.current&&u.current(l.current)},[n,u]),z.createElement("xRControllerModel",{ref:f})};function Dg({rayMaterial:a={},hideRaysOnBlur:r=!1,envMap:n,envMapIntensity:l}){const o=He(f=>f.controllers),s=He(f=>f.isHandTracking),u=z.useMemo(()=>Object.entries(a).reduce((f,[d,p])=>({...f,[`material-${d}`]:p}),{}),[JSON.stringify(a)]);return z.useMemo(()=>Bl({XRControllerModel:Ng}),[]),z.createElement(z.Fragment,null,o.map((f,d)=>z.createElement(z.Fragment,{key:d},vl(z.createElement(Og,{target:f,envMap:n,envMapIntensity:l}),f.grip),vl(z.createElement(jg,{visible:!s,hideOnBlur:r,target:f,...u}),f.controller))))}const Ug="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class Fg{constructor(r,n,l=Ug,o,s){this.controller=n,this.handModel=r,this.bones=[];const u=new cf;s||u.setPath(l),u.load(s??`${o}.glb`,f=>{const d=f.scene.children[0];this.handModel.add(d),this.scene=d;const p=d.getObjectByProperty("type","SkinnedMesh");p.frustumCulled=!1,p.castShadow=!0,p.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(m=>{const g=d.getObjectByName(m);g!==void 0?g.jointName=m:console.warn(`Couldn't find ${m} in ${o} hand mesh`),this.bones.push(g)})})}updateMesh(){const r=this.controller.joints;let n=!0;for(let l=0;l<this.bones.length;l++){const o=this.bones[l];if(o){const s=r[o.jointName];if(s.visible){const u=s.position;o.position.copy(u),o.quaternion.copy(s.quaternion),n=!1}}}n&&this.scene?this.scene.visible=!1:this.scene&&(this.scene.visible=!0)}dispose(){this.scene&&this.handModel.remove(this.scene)}}const Hg=.01,Vg="index-finger-tip";class Gg extends Nl{constructor(r,n,l){super(),this._onConnected=o=>{const s=o.data;s.hand&&!this.motionController&&(this.xrInputSource=s,this.motionController=new Fg(this,this.controller,void 0,s.handedness,s.handedness==="left"?this.leftModelPath:this.rightModelPath))},this._onDisconnected=()=>{var o;(o=this.xrInputSource)!=null&&o.hand&&this.motionControllerCleanup()},this.controller=r,this.motionController=null,this.envMap=null,this.leftModelPath=n,this.rightModelPath=l,this.mesh=null,this.xrInputSource=null,r.addEventListener("connected",this._onConnected),r.addEventListener("disconnected",this._onDisconnected)}motionControllerCleanup(){var r;this.clear(),(r=this.motionController)==null||r.dispose(),this.motionController=null}updateMatrixWorld(r){super.updateMatrixWorld(r),this.motionController&&this.motionController.updateMesh()}getPointerPosition(){const r=this.controller.joints[Vg];return r?r.position:null}intersectBoxObject(r){const n=this.getPointerPosition();if(n){const l=new Zr(n,Hg),o=new Qe().setFromObject(r);return l.intersectsBox(o)}else return!1}checkButton(r){this.intersectBoxObject(r)?r.onPress():r.onClear(),r.isPressed()&&r.whilePressed()}dispose(){this.motionControllerCleanup(),this.controller.removeEventListener("connected",this._onConnected),this.controller.removeEventListener("disconnected",this._onDisconnected)}}function Yg({modelLeft:a,modelRight:r}){const n=He(l=>l.controllers);return z.useMemo(()=>Bl({OculusHandModel:Gg}),[]),Ft(()=>{for(const l of n)l.hand.dispatchEvent({type:"connected",data:l.inputSource,fake:!0})},[n,a,r]),z.createElement(z.Fragment,null,n.map(({hand:l})=>vl(z.createElement("oculusHandModel",{args:[l,a,r]}),l)))}const Kg=z.forwardRef(function({points:a,color:r=16777215,vertexColors:n,linewidth:l,lineWidth:o,segments:s,dashed:u,...f},d){var p;const m=at(_=>_.size),g=z.useMemo(()=>s?new gf:new Lg,[s]),[v]=z.useState(()=>new Vl),b=(n==null||(p=n[0])==null?void 0:p.length)===4?4:3,A=z.useMemo(()=>{const _=s?new Hl:new hf,w=a.map(x=>{const S=Array.isArray(x);return x instanceof V||x instanceof Da?[x.x,x.y,x.z]:x instanceof be?[x.x,x.y,0]:S&&x.length===3?[x[0],x[1],x[2]]:S&&x.length===2?[x[0],x[1],0]:x});if(_.setPositions(w.flat()),n){r=16777215;const x=n.map(S=>S instanceof xn?S.toArray():S);_.setColors(x.flat(),b)}return _},[a,s,n,b]);return z.useLayoutEffect(()=>{g.computeLineDistances()},[a,g]),z.useLayoutEffect(()=>{u?v.defines.USE_DASH="":delete v.defines.USE_DASH,v.needsUpdate=!0},[u,v]),z.useEffect(()=>()=>A.dispose(),[A]),z.createElement("primitive",Hn({object:g,ref:d},f),z.createElement("primitive",{object:A,attach:"geometry"}),z.createElement("primitive",Hn({object:v,attach:"material",color:r,vertexColors:!!n,resolution:[m.width,m.height],linewidth:l??o,dashed:u,transparent:b===4},f)))}),yf=z.forwardRef(({sdfGlyphSize:a=64,anchorX:r="center",anchorY:n="middle",font:l,fontSize:o=1,children:s,characters:u,onSync:f,...d},p)=>{const{Text:m,preloadFont:g}=kc(async()=>Rh(()=>import("./troika-three-text.esm-4798f478-BteEwe1Y.js"),__vite__mapDeps([0,1,2])),[]),v=at(({invalidate:w})=>w),[b]=z.useState(()=>new m),[A,_]=z.useMemo(()=>{const w=[];let x="";return z.Children.forEach(s,S=>{typeof S=="string"||typeof S=="number"?x+=S:w.push(S)}),[w,x]},[s]);return kc(()=>new Promise(w=>g({font:l,characters:u},w)),["troika-text",l,u]),z.useLayoutEffect(()=>void b.sync(()=>{v(),f&&f(b)})),z.useEffect(()=>()=>b.dispose(),[b]),z.createElement("primitive",Hn({object:b,ref:p,font:l,text:_,anchorX:r,anchorY:n,fontSize:o,sdfGlyphSize:a},d),A)}),Wg=z.forwardRef(({makeDefault:a,camera:r,regress:n,domElement:l,enableDamping:o=!0,keyEvents:s=!1,onChange:u,onStart:f,onEnd:d,...p},m)=>{const g=at(R=>R.invalidate),v=at(R=>R.camera),b=at(R=>R.gl),A=at(R=>R.events),_=at(R=>R.setEvents),w=at(R=>R.set),x=at(R=>R.get),S=at(R=>R.performance),E=r||v,P=l||A.connected||b.domElement,M=z.useMemo(()=>new Dm(E),[E]);return dr(()=>{M.enabled&&M.update()},-1),z.useEffect(()=>(s&&M.connect(s===!0?P:s),M.connect(P),()=>void M.dispose()),[s,P,n,M,g]),z.useEffect(()=>{const R=C=>{g(),n&&S.regress(),u&&u(C)},L=C=>{f&&f(C)},N=C=>{d&&d(C)};return M.addEventListener("change",R),M.addEventListener("start",L),M.addEventListener("end",N),()=>{M.removeEventListener("start",L),M.removeEventListener("end",N),M.removeEventListener("change",R)}},[u,f,d,M,g,_]),z.useEffect(()=>{if(a){const R=x().controls;return w({controls:M}),()=>w({controls:R})}},[a,M]),z.createElement("primitive",Hn({ref:m,object:M,enableDamping:o},p))}),bf=0,Qg=1,xf=2,dd=2,qs=1.25,fd=1,ja=6*4+4+4,vo=65535,qg=Math.pow(2,-24),Xs=Symbol("SKIP_GENERATION");function Xg(a){return a.index?a.index.count:a.attributes.position.count}function $r(a){return Xg(a)/3}function Zg(a,r=ArrayBuffer){return a>65535?new Uint32Array(new r(4*a)):new Uint16Array(new r(2*a))}function $g(a,r){if(!a.index){const n=a.attributes.position.count,l=r.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,o=Zg(n,l);a.setIndex(new Na(o,1));for(let s=0;s<n;s++)o[s]=s}}function wf(a){const r=$r(a),n=a.drawRange,l=n.start/3,o=(n.start+n.count)/3,s=Math.max(0,l),u=Math.min(r,o)-s;return[{offset:Math.floor(s),count:Math.floor(u)}]}function Sf(a){if(!a.groups||!a.groups.length)return wf(a);const r=[],n=new Set,l=a.drawRange,o=l.start/3,s=(l.start+l.count)/3;for(const f of a.groups){const d=f.start/3,p=(f.start+f.count)/3;n.add(Math.max(o,d)),n.add(Math.min(s,p))}const u=Array.from(n.values()).sort((f,d)=>f-d);for(let f=0;f<u.length-1;f++){const d=u[f],p=u[f+1];r.push({offset:Math.floor(d),count:Math.floor(p-d)})}return r}function Jg(a){if(a.groups.length===0)return!1;const r=$r(a),n=Sf(a).sort((s,u)=>s.offset-u.offset),l=n[n.length-1];l.count=Math.min(r-l.offset,l.count);let o=0;return n.forEach(({count:s})=>o+=s),r!==o}function Zs(a,r,n,l,o){let s=1/0,u=1/0,f=1/0,d=-1/0,p=-1/0,m=-1/0,g=1/0,v=1/0,b=1/0,A=-1/0,_=-1/0,w=-1/0;for(let x=r*6,S=(r+n)*6;x<S;x+=6){const E=a[x+0],P=a[x+1],M=E-P,R=E+P;M<s&&(s=M),R>d&&(d=R),E<g&&(g=E),E>A&&(A=E);const L=a[x+2],N=a[x+3],C=L-N,O=L+N;C<u&&(u=C),O>p&&(p=O),L<v&&(v=L),L>_&&(_=L);const B=a[x+4],F=a[x+5],K=B-F,$=B+F;K<f&&(f=K),$>m&&(m=$),B<b&&(b=B),B>w&&(w=B)}l[0]=s,l[1]=u,l[2]=f,l[3]=d,l[4]=p,l[5]=m,o[0]=g,o[1]=v,o[2]=b,o[3]=A,o[4]=_,o[5]=w}function ev(a,r=null,n=null,l=null){const o=a.attributes.position,s=a.index?a.index.array:null,u=$r(a),f=o.normalized;let d;r===null?(d=new Float32Array(u*6*4),n=0,l=u):(d=r,n=n||0,l=l||u);const p=o.array,m=o.offset||0;let g=3;o.isInterleavedBufferAttribute&&(g=o.data.stride);const v=["getX","getY","getZ"];for(let b=n;b<n+l;b++){const A=b*3,_=b*6;let w=A+0,x=A+1,S=A+2;s&&(w=s[w],x=s[x],S=s[S]),f||(w=w*g+m,x=x*g+m,S=S*g+m);for(let E=0;E<3;E++){let P,M,R;f?(P=o[v[E]](w),M=o[v[E]](x),R=o[v[E]](S)):(P=p[w+E],M=p[x+E],R=p[S+E]);let L=P;M<L&&(L=M),R<L&&(L=R);let N=P;M>N&&(N=M),R>N&&(N=R);const C=(N-L)/2,O=E*2;d[_+O+0]=L+C,d[_+O+1]=C+(Math.abs(L)+C)*qg}}return d}function De(a,r,n){return n.min.x=r[a],n.min.y=r[a+1],n.min.z=r[a+2],n.max.x=r[a+3],n.max.y=r[a+4],n.max.z=r[a+5],n}function pd(a){let r=-1,n=-1/0;for(let l=0;l<3;l++){const o=a[l+3]-a[l];o>n&&(n=o,r=l)}return r}function hd(a,r){r.set(a)}function md(a,r,n){let l,o;for(let s=0;s<3;s++){const u=s+3;l=a[s],o=r[s],n[s]=l<o?l:o,l=a[u],o=r[u],n[u]=l>o?l:o}}function Qi(a,r,n){for(let l=0;l<3;l++){const o=r[a+2*l],s=r[a+2*l+1],u=o-s,f=o+s;u<n[l]&&(n[l]=u),f>n[l+3]&&(n[l+3]=f)}}function Pa(a){const r=a[3]-a[0],n=a[4]-a[1],l=a[5]-a[2];return 2*(r*n+n*l+l*r)}const bn=32,tv=(a,r)=>a.candidate-r.candidate,On=new Array(bn).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),qi=new Float32Array(6);function nv(a,r,n,l,o,s){let u=-1,f=0;if(s===bf)u=pd(r),u!==-1&&(f=(r[u]+r[u+3])/2);else if(s===Qg)u=pd(a),u!==-1&&(f=rv(n,l,o,u));else if(s===xf){const d=Pa(a);let p=qs*o;const m=l*6,g=(l+o)*6;for(let v=0;v<3;v++){const b=r[v],A=(r[v+3]-b)/bn;if(o<bn/4){const _=[...On];_.length=o;let w=0;for(let S=m;S<g;S+=6,w++){const E=_[w];E.candidate=n[S+2*v],E.count=0;const{bounds:P,leftCacheBounds:M,rightCacheBounds:R}=E;for(let L=0;L<3;L++)R[L]=1/0,R[L+3]=-1/0,M[L]=1/0,M[L+3]=-1/0,P[L]=1/0,P[L+3]=-1/0;Qi(S,n,P)}_.sort(tv);let x=o;for(let S=0;S<x;S++){const E=_[S];for(;S+1<x&&_[S+1].candidate===E.candidate;)_.splice(S+1,1),x--}for(let S=m;S<g;S+=6){const E=n[S+2*v];for(let P=0;P<x;P++){const M=_[P];E>=M.candidate?Qi(S,n,M.rightCacheBounds):(Qi(S,n,M.leftCacheBounds),M.count++)}}for(let S=0;S<x;S++){const E=_[S],P=E.count,M=o-E.count,R=E.leftCacheBounds,L=E.rightCacheBounds;let N=0;P!==0&&(N=Pa(R)/d);let C=0;M!==0&&(C=Pa(L)/d);const O=fd+qs*(N*P+C*M);O<p&&(u=v,p=O,f=E.candidate)}}else{for(let x=0;x<bn;x++){const S=On[x];S.count=0,S.candidate=b+A+x*A;const E=S.bounds;for(let P=0;P<3;P++)E[P]=1/0,E[P+3]=-1/0}for(let x=m;x<g;x+=6){let S=~~((n[x+2*v]-b)/A);S>=bn&&(S=bn-1);const E=On[S];E.count++,Qi(x,n,E.bounds)}const _=On[bn-1];hd(_.bounds,_.rightCacheBounds);for(let x=bn-2;x>=0;x--){const S=On[x],E=On[x+1];md(S.bounds,E.rightCacheBounds,S.rightCacheBounds)}let w=0;for(let x=0;x<bn-1;x++){const S=On[x],E=S.count,P=S.bounds,M=On[x+1].rightCacheBounds;E!==0&&(w===0?hd(P,qi):md(P,qi,qi)),w+=E;let R=0,L=0;w!==0&&(R=Pa(qi)/d);const N=o-w;N!==0&&(L=Pa(M)/d);const C=fd+qs*(R*w+L*N);C<p&&(u=v,p=C,f=S.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:u,pos:f}}function rv(a,r,n,l){let o=0;for(let s=r,u=r+n;s<u;s++)o+=a[s*6+l*2];return o/n}class $s{constructor(){this.boundingData=new Float32Array(6)}}function av(a,r,n,l,o,s){let u=l,f=l+o-1;const d=s.pos,p=s.axis*2;for(;;){for(;u<=f&&n[u*6+p]<d;)u++;for(;u<=f&&n[f*6+p]>=d;)f--;if(u<f){for(let m=0;m<3;m++){let g=r[u*3+m];r[u*3+m]=r[f*3+m],r[f*3+m]=g}for(let m=0;m<6;m++){let g=n[u*6+m];n[u*6+m]=n[f*6+m],n[f*6+m]=g}u++,f--}else return u}}function iv(a,r,n,l,o,s){let u=l,f=l+o-1;const d=s.pos,p=s.axis*2;for(;;){for(;u<=f&&n[u*6+p]<d;)u++;for(;u<=f&&n[f*6+p]>=d;)f--;if(u<f){let m=a[u];a[u]=a[f],a[f]=m;for(let g=0;g<6;g++){let v=n[u*6+g];n[u*6+g]=n[f*6+g],n[f*6+g]=v}u++,f--}else return u}}function wt(a,r){return r[a+15]===65535}function Mt(a,r){return r[a+6]}function Ht(a,r){return r[a+14]}function Vt(a){return a+8}function Gt(a,r){return r[a+6]}function _f(a,r){return r[a+7]}let Ef,ka,fo,Af;const ov=Math.pow(2,32);function _l(a){return"count"in a?1:1+_l(a.left)+_l(a.right)}function sv(a,r,n){return Ef=new Float32Array(n),ka=new Uint32Array(n),fo=new Uint16Array(n),Af=new Uint8Array(n),El(a,r)}function El(a,r){const n=a/4,l=a/2,o="count"in r,s=r.boundingData;for(let u=0;u<6;u++)Ef[n+u]=s[u];if(o)if(r.buffer){const u=r.buffer;Af.set(new Uint8Array(u),a);for(let f=a,d=a+u.byteLength;f<d;f+=ja){const p=f/2;wt(p,fo)||(ka[f/4+6]+=n)}return a+u.byteLength}else{const u=r.offset,f=r.count;return ka[n+6]=u,fo[l+14]=f,fo[l+15]=vo,a+ja}else{const u=r.left,f=r.right,d=r.splitAxis;let p;if(p=El(a+ja,u),p/4>ov)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return ka[n+6]=p/4,p=El(p,f),ka[n+7]=d,p}}function lv(a,r){const n=(a.index?a.index.count:a.attributes.position.count)/3,l=n>2**16,o=l?4:2,s=r?new SharedArrayBuffer(n*o):new ArrayBuffer(n*o),u=l?new Uint32Array(s):new Uint16Array(s);for(let f=0,d=u.length;f<d;f++)u[f]=f;return u}function uv(a,r,n,l,o){const{maxDepth:s,verbose:u,maxLeafTris:f,strategy:d,onProgress:p,indirect:m}=o,g=a._indirectBuffer,v=a.geometry,b=v.index?v.index.array:null,A=m?iv:av,_=$r(v),w=new Float32Array(6);let x=!1;const S=new $s;return Zs(r,n,l,S.boundingData,w),P(S,n,l,w),S;function E(M){p&&p(M/_)}function P(M,R,L,N=null,C=0){if(!x&&C>=s&&(x=!0,u&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(v))),L<=f||C>=s)return E(R+L),M.offset=R,M.count=L,M;const O=nv(M.boundingData,N,r,R,L,d);if(O.axis===-1)return E(R+L),M.offset=R,M.count=L,M;const B=A(g,b,r,R,L,O);if(B===R||B===R+L)E(R+L),M.offset=R,M.count=L;else{M.splitAxis=O.axis;const F=new $s,K=R,$=B-R;M.left=F,Zs(r,K,$,F.boundingData,w),P(F,K,$,w,C+1);const le=new $s,fe=B,ve=L-$;M.right=le,Zs(r,fe,ve,le.boundingData,w),P(le,fe,ve,w,C+1)}return M}}function cv(a,r){const n=a.geometry;r.indirect&&(a._indirectBuffer=lv(n,r.useSharedArrayBuffer),Jg(n)&&!r.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),a._indirectBuffer||$g(n,r);const l=r.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,o=ev(n),s=r.indirect?wf(n):Sf(n);a._roots=s.map(u=>{const f=uv(a,o,u.offset,u.count,r),d=_l(f),p=new l(ja*d);return sv(0,f,p),p})}class wn{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(r,n){let l=1/0,o=-1/0;for(let s=0,u=r.length;s<u;s++){const f=r[s][n];l=f<l?f:l,o=f>o?f:o}this.min=l,this.max=o}setFromPoints(r,n){let l=1/0,o=-1/0;for(let s=0,u=n.length;s<u;s++){const f=n[s],d=r.dot(f);l=d<l?d:l,o=d>o?d:o}this.min=l,this.max=o}isSeparated(r){return this.min>r.max||r.min>this.max}}wn.prototype.setFromBox=function(){const a=new V;return function(r,n){const l=n.min,o=n.max;let s=1/0,u=-1/0;for(let f=0;f<=1;f++)for(let d=0;d<=1;d++)for(let p=0;p<=1;p++){a.x=l.x*f+o.x*(1-f),a.y=l.y*d+o.y*(1-d),a.z=l.z*p+o.z*(1-p);const m=r.dot(a);s=Math.min(m,s),u=Math.max(m,u)}this.min=s,this.max=u}}();const dv=function(){const a=new V,r=new V,n=new V;return function(l,o,s){const u=l.start,f=a,d=o.start,p=r;n.subVectors(u,d),a.subVectors(l.end,l.start),r.subVectors(o.end,o.start);const m=n.dot(p),g=p.dot(f),v=p.dot(p),b=n.dot(f),A=f.dot(f)*v-g*g;let _,w;A!==0?_=(m*g-b*v)/A:_=0,w=(m+_*g)/v,s.x=_,s.y=w}}(),Gl=function(){const a=new be,r=new V,n=new V;return function(l,o,s,u){dv(l,o,a);let f=a.x,d=a.y;if(f>=0&&f<=1&&d>=0&&d<=1){l.at(f,s),o.at(d,u);return}else if(f>=0&&f<=1){d<0?o.at(0,u):o.at(1,u),l.closestPointToPoint(u,!0,s);return}else if(d>=0&&d<=1){f<0?l.at(0,s):l.at(1,s),o.closestPointToPoint(s,!0,u);return}else{let p;f<0?p=l.start:p=l.end;let m;d<0?m=o.start:m=o.end;const g=r,v=n;if(l.closestPointToPoint(m,!0,r),o.closestPointToPoint(p,!0,n),g.distanceToSquared(m)<=v.distanceToSquared(p)){s.copy(g),u.copy(m);return}else{s.copy(p),u.copy(v);return}}}}(),fv=function(){const a=new V,r=new V,n=new kl,l=new dn;return function(o,s){const{radius:u,center:f}=o,{a:d,b:p,c:m}=s;if(l.start=d,l.end=p,l.closestPointToPoint(f,!0,a).distanceTo(f)<=u||(l.start=d,l.end=m,l.closestPointToPoint(f,!0,a).distanceTo(f)<=u)||(l.start=p,l.end=m,l.closestPointToPoint(f,!0,a).distanceTo(f)<=u))return!0;const g=s.getPlane(n);if(Math.abs(g.distanceToPoint(f))<=u){const v=g.projectPoint(f,r);if(s.containsPoint(v))return!0}return!1}}(),pv=1e-15;function Js(a){return Math.abs(a)<pv}class $t extends za{constructor(...r){super(...r),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new V),this.satBounds=new Array(4).fill().map(()=>new wn),this.points=[this.a,this.b,this.c],this.sphere=new Zr,this.plane=new kl,this.needsUpdate=!0}intersectsSphere(r){return fv(r,this)}update(){const r=this.a,n=this.b,l=this.c,o=this.points,s=this.satAxes,u=this.satBounds,f=s[0],d=u[0];this.getNormal(f),d.setFromPoints(f,o);const p=s[1],m=u[1];p.subVectors(r,n),m.setFromPoints(p,o);const g=s[2],v=u[2];g.subVectors(n,l),v.setFromPoints(g,o);const b=s[3],A=u[3];b.subVectors(l,r),A.setFromPoints(b,o),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(f,r),this.needsUpdate=!1}}$t.prototype.closestPointToSegment=function(){const a=new V,r=new V,n=new dn;return function(l,o=null,s=null){const{start:u,end:f}=l,d=this.points;let p,m=1/0;for(let g=0;g<3;g++){const v=(g+1)%3;n.start.copy(d[g]),n.end.copy(d[v]),Gl(n,l,a,r),p=a.distanceToSquared(r),p<m&&(m=p,o&&o.copy(a),s&&s.copy(r))}return this.closestPointToPoint(u,a),p=u.distanceToSquared(a),p<m&&(m=p,o&&o.copy(a),s&&s.copy(u)),this.closestPointToPoint(f,a),p=f.distanceToSquared(a),p<m&&(m=p,o&&o.copy(a),s&&s.copy(f)),Math.sqrt(m)}}();$t.prototype.intersectsTriangle=function(){const a=new $t,r=new Array(3),n=new Array(3),l=new wn,o=new wn,s=new V,u=new V,f=new V,d=new V,p=new V,m=new dn,g=new dn,v=new dn,b=new V;function A(_,w,x){const S=_.points;let E=0,P=-1;for(let M=0;M<3;M++){const{start:R,end:L}=m;R.copy(S[M]),L.copy(S[(M+1)%3]),m.delta(u);const N=Js(w.distanceToPoint(R));if(Js(w.normal.dot(u))&&N){x.copy(m),E=2;break}const C=w.intersectLine(m,b);if(!C&&N&&b.copy(R),(C||N)&&!Js(b.distanceTo(L))){if(E<=1)(E===1?x.start:x.end).copy(b),N&&(P=E);else if(E>=2){(P===1?x.start:x.end).copy(b),E=2;break}if(E++,E===2&&P===-1)break}}return E}return function(_,w=null,x=!1){this.needsUpdate&&this.update(),_.isExtendedTriangle?_.needsUpdate&&_.update():(a.copy(_),a.update(),_=a);const S=this.plane,E=_.plane;if(Math.abs(S.normal.dot(E.normal))>1-1e-10){const P=this.satBounds,M=this.satAxes;n[0]=_.a,n[1]=_.b,n[2]=_.c;for(let N=0;N<4;N++){const C=P[N],O=M[N];if(l.setFromPoints(O,n),C.isSeparated(l))return!1}const R=_.satBounds,L=_.satAxes;r[0]=this.a,r[1]=this.b,r[2]=this.c;for(let N=0;N<4;N++){const C=R[N],O=L[N];if(l.setFromPoints(O,r),C.isSeparated(l))return!1}for(let N=0;N<4;N++){const C=M[N];for(let O=0;O<4;O++){const B=L[O];if(s.crossVectors(C,B),l.setFromPoints(s,r),o.setFromPoints(s,n),l.isSeparated(o))return!1}}return w&&(x||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),w.start.set(0,0,0),w.end.set(0,0,0)),!0}else{const P=A(this,E,g);if(P===1&&_.containsPoint(g.end))return w&&(w.start.copy(g.end),w.end.copy(g.end)),!0;if(P!==2)return!1;const M=A(_,S,v);if(M===1&&this.containsPoint(v.end))return w&&(w.start.copy(v.end),w.end.copy(v.end)),!0;if(M!==2)return!1;if(g.delta(f),v.delta(d),f.dot(d)<0){let F=v.start;v.start=v.end,v.end=F}const R=g.start.dot(f),L=g.end.dot(f),N=v.start.dot(f),C=v.end.dot(f),O=L<N,B=R<C;return R!==C&&N!==L&&O===B?!1:(w&&(p.subVectors(g.start,v.start),p.dot(f)>0?w.start.copy(g.start):w.start.copy(v.start),p.subVectors(g.end,v.end),p.dot(f)<0?w.end.copy(g.end):w.end.copy(v.end)),!0)}}}();$t.prototype.distanceToPoint=function(){const a=new V;return function(r){return this.closestPointToPoint(r,a),r.distanceTo(a)}}();$t.prototype.distanceToTriangle=function(){const a=new V,r=new V,n=["a","b","c"],l=new dn,o=new dn;return function(s,u=null,f=null){const d=u||f?l:null;if(this.intersectsTriangle(s,d))return(u||f)&&(u&&d.getCenter(u),f&&d.getCenter(f)),0;let p=1/0;for(let m=0;m<3;m++){let g;const v=n[m],b=s[v];this.closestPointToPoint(b,a),g=b.distanceToSquared(a),g<p&&(p=g,u&&u.copy(a),f&&f.copy(b));const A=this[v];s.closestPointToPoint(A,a),g=A.distanceToSquared(a),g<p&&(p=g,u&&u.copy(A),f&&f.copy(a))}for(let m=0;m<3;m++){const g=n[m],v=n[(m+1)%3];l.set(this[g],this[v]);for(let b=0;b<3;b++){const A=n[b],_=n[(b+1)%3];o.set(s[A],s[_]),Gl(l,o,a,r);const w=a.distanceToSquared(r);w<p&&(p=w,u&&u.copy(a),f&&f.copy(r))}}return Math.sqrt(p)}}();class mt{constructor(r,n,l){this.isOrientedBox=!0,this.min=new V,this.max=new V,this.matrix=new Je,this.invMatrix=new Je,this.points=new Array(8).fill().map(()=>new V),this.satAxes=new Array(3).fill().map(()=>new V),this.satBounds=new Array(3).fill().map(()=>new wn),this.alignedSatBounds=new Array(3).fill().map(()=>new wn),this.needsUpdate=!1,r&&this.min.copy(r),n&&this.max.copy(n),l&&this.matrix.copy(l)}set(r,n,l){this.min.copy(r),this.max.copy(n),this.matrix.copy(l),this.needsUpdate=!0}copy(r){this.min.copy(r.min),this.max.copy(r.max),this.matrix.copy(r.matrix),this.needsUpdate=!0}}mt.prototype.update=function(){return function(){const a=this.matrix,r=this.min,n=this.max,l=this.points;for(let d=0;d<=1;d++)for(let p=0;p<=1;p++)for(let m=0;m<=1;m++){const g=1*d|2*p|4*m,v=l[g];v.x=d?n.x:r.x,v.y=p?n.y:r.y,v.z=m?n.z:r.z,v.applyMatrix4(a)}const o=this.satBounds,s=this.satAxes,u=l[0];for(let d=0;d<3;d++){const p=s[d],m=o[d],g=1<<d,v=l[g];p.subVectors(u,v),m.setFromPoints(p,l)}const f=this.alignedSatBounds;f[0].setFromPointsField(l,"x"),f[1].setFromPointsField(l,"y"),f[2].setFromPointsField(l,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();mt.prototype.intersectsBox=function(){const a=new wn;return function(r){this.needsUpdate&&this.update();const n=r.min,l=r.max,o=this.satBounds,s=this.satAxes,u=this.alignedSatBounds;if(a.min=n.x,a.max=l.x,u[0].isSeparated(a)||(a.min=n.y,a.max=l.y,u[1].isSeparated(a))||(a.min=n.z,a.max=l.z,u[2].isSeparated(a)))return!1;for(let f=0;f<3;f++){const d=s[f],p=o[f];if(a.setFromBox(d,r),p.isSeparated(a))return!1}return!0}}();mt.prototype.intersectsTriangle=function(){const a=new $t,r=new Array(3),n=new wn,l=new wn,o=new V;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(a.copy(s),a.update(),s=a);const u=this.satBounds,f=this.satAxes;r[0]=s.a,r[1]=s.b,r[2]=s.c;for(let g=0;g<3;g++){const v=u[g],b=f[g];if(n.setFromPoints(b,r),v.isSeparated(n))return!1}const d=s.satBounds,p=s.satAxes,m=this.points;for(let g=0;g<3;g++){const v=d[g],b=p[g];if(n.setFromPoints(b,m),v.isSeparated(n))return!1}for(let g=0;g<3;g++){const v=f[g];for(let b=0;b<4;b++){const A=p[b];if(o.crossVectors(v,A),n.setFromPoints(o,r),l.setFromPoints(o,m),n.isSeparated(l))return!1}}return!0}}();mt.prototype.closestPointToPoint=function(){return function(a,r){return this.needsUpdate&&this.update(),r.copy(a).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),r}}();mt.prototype.distanceToPoint=function(){const a=new V;return function(r){return this.closestPointToPoint(r,a),r.distanceTo(a)}}();mt.prototype.distanceToBox=function(){const a=["x","y","z"],r=new Array(12).fill().map(()=>new dn),n=new Array(12).fill().map(()=>new dn),l=new V,o=new V;return function(s,u=0,f=null,d=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(f||d)&&(s.getCenter(o),this.closestPointToPoint(o,l),s.closestPointToPoint(l,o),f&&f.copy(l),d&&d.copy(o)),0;const p=u*u,m=s.min,g=s.max,v=this.points;let b=1/0;for(let _=0;_<8;_++){const w=v[_];o.copy(w).clamp(m,g);const x=w.distanceToSquared(o);if(x<b&&(b=x,f&&f.copy(w),d&&d.copy(o),x<p))return Math.sqrt(x)}let A=0;for(let _=0;_<3;_++)for(let w=0;w<=1;w++)for(let x=0;x<=1;x++){const S=(_+1)%3,E=(_+2)%3,P=w<<S|x<<E,M=1<<_|w<<S|x<<E,R=v[P],L=v[M];r[A].set(R,L);const N=a[_],C=a[S],O=a[E],B=n[A],F=B.start,K=B.end;F[N]=m[N],F[C]=w?m[C]:g[C],F[O]=x?m[O]:g[C],K[N]=g[N],K[C]=w?m[C]:g[C],K[O]=x?m[O]:g[C],A++}for(let _=0;_<=1;_++)for(let w=0;w<=1;w++)for(let x=0;x<=1;x++){o.x=_?g.x:m.x,o.y=w?g.y:m.y,o.z=x?g.z:m.z,this.closestPointToPoint(o,l);const S=o.distanceToSquared(l);if(S<b&&(b=S,f&&f.copy(l),d&&d.copy(o),S<p))return Math.sqrt(S)}for(let _=0;_<12;_++){const w=r[_];for(let x=0;x<12;x++){const S=n[x];Gl(w,S,l,o);const E=l.distanceToSquared(o);if(E<b&&(b=E,f&&f.copy(l),d&&d.copy(o),E<p))return Math.sqrt(E)}}return Math.sqrt(b)}}();class Yl{constructor(r){this._getNewPrimitive=r,this._primitives=[]}getPrimitive(){const r=this._primitives;return r.length===0?this._getNewPrimitive():r.pop()}releasePrimitive(r){this._primitives.push(r)}}class hv extends Yl{constructor(){super(()=>new $t)}}const Yt=new hv;class mv{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const r=[];let n=null;this.setBuffer=l=>{n&&r.push(n),n=l,this.float32Array=new Float32Array(l),this.uint16Array=new Uint16Array(l),this.uint32Array=new Uint32Array(l)},this.clearBuffer=()=>{n=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,r.length!==0&&this.setBuffer(r.pop())}}}const Ie=new mv;let Fn,Wr;const Ir=[],Xi=new Yl(()=>new Qe);function gv(a,r,n,l,o,s){Fn=Xi.getPrimitive(),Wr=Xi.getPrimitive(),Ir.push(Fn,Wr),Ie.setBuffer(a._roots[r]);const u=Al(0,a.geometry,n,l,o,s);Ie.clearBuffer(),Xi.releasePrimitive(Fn),Xi.releasePrimitive(Wr),Ir.pop(),Ir.pop();const f=Ir.length;return f>0&&(Wr=Ir[f-1],Fn=Ir[f-2]),u}function Al(a,r,n,l,o=null,s=0,u=0){const{float32Array:f,uint16Array:d,uint32Array:p}=Ie;let m=a*2;if(wt(m,d)){const g=Mt(a,p),v=Ht(m,d);return De(a,f,Fn),l(g,v,!1,u,s+a,Fn)}else{let g=function(B){const{uint16Array:F,uint32Array:K}=Ie;let $=B*2;for(;!wt($,F);)B=Vt(B),$=B*2;return Mt(B,K)},v=function(B){const{uint16Array:F,uint32Array:K}=Ie;let $=B*2;for(;!wt($,F);)B=Gt(B,K),$=B*2;return Mt(B,K)+Ht($,F)};const b=Vt(a),A=Gt(a,p);let _=b,w=A,x,S,E,P;if(o&&(E=Fn,P=Wr,De(_,f,E),De(w,f,P),x=o(E),S=o(P),S<x)){_=A,w=b;const B=x;x=S,S=B,E=P}E||(E=Fn,De(_,f,E));const M=wt(_*2,d),R=n(E,M,x,u+1,s+_);let L;if(R===dd){const B=g(_),F=v(_)-B;L=l(B,F,!0,u+1,s+_,E)}else L=R&&Al(_,r,n,l,o,s,u+1);if(L)return!0;P=Wr,De(w,f,P);const N=wt(w*2,d),C=n(P,N,S,u+1,s+w);let O;if(C===dd){const B=g(w),F=v(w)-B;O=l(B,F,!0,u+1,s+w,P)}else O=C&&Al(w,r,n,l,o,s,u+1);return!!O}}const Ma=new V,el=new V;function vv(a,r,n={},l=0,o=1/0){const s=l*l,u=o*o;let f=1/0,d=null;if(a.shapecast({boundsTraverseOrder:m=>(Ma.copy(r).clamp(m.min,m.max),Ma.distanceToSquared(r)),intersectsBounds:(m,g,v)=>v<f&&v<u,intersectsTriangle:(m,g)=>{m.closestPointToPoint(r,Ma);const v=r.distanceToSquared(Ma);return v<f&&(el.copy(Ma),f=v,d=g),v<s}}),f===1/0)return null;const p=Math.sqrt(f);return n.point?n.point.copy(el):n.point=el.clone(),n.distance=p,n.faceIndex=d,n}const zr=new V,kr=new V,Nr=new V,Zi=new be,$i=new be,Ji=new be,gd=new V,vd=new V,yd=new V,eo=new V;function yv(a,r,n,l,o,s){let u;return s===Rd?u=a.intersectTriangle(l,n,r,!0,o):u=a.intersectTriangle(r,n,l,s!==Od,o),u===null?null:{distance:a.origin.distanceTo(o),point:o.clone()}}function bv(a,r,n,l,o,s,u,f,d){zr.fromBufferAttribute(r,s),kr.fromBufferAttribute(r,u),Nr.fromBufferAttribute(r,f);const p=yv(a,zr,kr,Nr,eo,d);if(p){l&&(Zi.fromBufferAttribute(l,s),$i.fromBufferAttribute(l,u),Ji.fromBufferAttribute(l,f),p.uv=za.getInterpolation(eo,zr,kr,Nr,Zi,$i,Ji,new be)),o&&(Zi.fromBufferAttribute(o,s),$i.fromBufferAttribute(o,u),Ji.fromBufferAttribute(o,f),p.uv1=za.getInterpolation(eo,zr,kr,Nr,Zi,$i,Ji,new be)),n&&(gd.fromBufferAttribute(n,s),vd.fromBufferAttribute(n,u),yd.fromBufferAttribute(n,f),p.normal=za.getInterpolation(eo,zr,kr,Nr,gd,vd,yd,new V),p.normal.dot(a.direction)>0&&p.normal.multiplyScalar(-1));const m={a:s,b:u,c:f,normal:new V,materialIndex:0};za.getNormal(zr,kr,Nr,m.normal),p.face=m,p.faceIndex=s}return p}function yo(a,r,n,l,o){const s=l*3;let u=s+0,f=s+1,d=s+2;const p=a.index;a.index&&(u=p.getX(u),f=p.getX(f),d=p.getX(d));const{position:m,normal:g,uv:v,uv1:b}=a.attributes,A=bv(n,m,g,v,b,u,f,d,r);return A?(A.faceIndex=l,o&&o.push(A),A):null}function We(a,r,n,l){const o=a.a,s=a.b,u=a.c;let f=r,d=r+1,p=r+2;n&&(f=n.getX(f),d=n.getX(d),p=n.getX(p)),o.x=l.getX(f),o.y=l.getY(f),o.z=l.getZ(f),s.x=l.getX(d),s.y=l.getY(d),s.z=l.getZ(d),u.x=l.getX(p),u.y=l.getY(p),u.z=l.getZ(p)}function xv(a,r,n,l,o,s){const{geometry:u,_indirectBuffer:f}=a;for(let d=l,p=l+o;d<p;d++)yo(u,r,n,d,s)}function wv(a,r,n,l,o){const{geometry:s,_indirectBuffer:u}=a;let f=1/0,d=null;for(let p=l,m=l+o;p<m;p++){let g;g=yo(s,r,n,p),g&&g.distance<f&&(d=g,f=g.distance)}return d}function Sv(a,r,n,l,o,s,u){const{geometry:f}=n,{index:d}=f,p=f.attributes.position;for(let m=a,g=r+a;m<g;m++){let v;if(v=m,We(u,v*3,d,p),u.needsUpdate=!0,l(u,v,o,s))return!0}return!1}function _v(a,r=null){r&&Array.isArray(r)&&(r=new Set(r));const n=a.geometry,l=n.index?n.index.array:null,o=n.attributes.position;let s,u,f,d,p=0;const m=a._roots;for(let v=0,b=m.length;v<b;v++)s=m[v],u=new Uint32Array(s),f=new Uint16Array(s),d=new Float32Array(s),g(0,p),p+=s.byteLength;function g(v,b,A=!1){const _=v*2;if(f[_+15]===vo){const w=u[v+6],x=f[_+14];let S=1/0,E=1/0,P=1/0,M=-1/0,R=-1/0,L=-1/0;for(let N=3*w,C=3*(w+x);N<C;N++){let O=l[N];const B=o.getX(O),F=o.getY(O),K=o.getZ(O);B<S&&(S=B),B>M&&(M=B),F<E&&(E=F),F>R&&(R=F),K<P&&(P=K),K>L&&(L=K)}return d[v+0]!==S||d[v+1]!==E||d[v+2]!==P||d[v+3]!==M||d[v+4]!==R||d[v+5]!==L?(d[v+0]=S,d[v+1]=E,d[v+2]=P,d[v+3]=M,d[v+4]=R,d[v+5]=L,!0):!1}else{const w=v+8,x=u[v+6],S=w+b,E=x+b;let P=A,M=!1,R=!1;r?P||(M=r.has(S),R=r.has(E),P=!M&&!R):(M=!0,R=!0);const L=P||M,N=P||R;let C=!1;L&&(C=g(w,b,P));let O=!1;N&&(O=g(x,b,P));const B=C||O;if(B)for(let F=0;F<3;F++){const K=w+F,$=x+F,le=d[K],fe=d[K+3],ve=d[$],G=d[$+3];d[v+F]=le<ve?le:ve,d[v+F+3]=fe>G?fe:G}return B}}}const bd=new Qe;function Gn(a,r,n,l){return De(a,r,bd),n.intersectBox(bd,l)}function Ev(a,r,n,l,o,s){const{geometry:u,_indirectBuffer:f}=a;for(let d=l,p=l+o;d<p;d++){let m=f?f[d]:d;yo(u,r,n,m,s)}}function Av(a,r,n,l,o){const{geometry:s,_indirectBuffer:u}=a;let f=1/0,d=null;for(let p=l,m=l+o;p<m;p++){let g;g=yo(s,r,n,u?u[p]:p),g&&g.distance<f&&(d=g,f=g.distance)}return d}function Tv(a,r,n,l,o,s,u){const{geometry:f}=n,{index:d}=f,p=f.attributes.position;for(let m=a,g=r+a;m<g;m++){let v;if(v=n.resolveTriangleIndex(m),We(u,v*3,d,p),u.needsUpdate=!0,l(u,v,o,s))return!0}return!1}const xd=new V;function Pv(a,r,n,l,o){Ie.setBuffer(a._roots[r]),Tl(0,a,n,l,o),Ie.clearBuffer()}function Tl(a,r,n,l,o){const{float32Array:s,uint16Array:u,uint32Array:f}=Ie,d=a*2;if(wt(d,u)){const p=Mt(a,f),m=Ht(d,u);xv(r,n,l,p,m,o)}else{const p=Vt(a);Gn(p,s,l,xd)&&Tl(p,r,n,l,o);const m=Gt(a,f);Gn(m,s,l,xd)&&Tl(m,r,n,l,o)}}const wd=new V,Mv=["x","y","z"];function Lv(a,r,n,l){Ie.setBuffer(a._roots[r]);const o=Pl(0,a,n,l);return Ie.clearBuffer(),o}function Pl(a,r,n,l){const{float32Array:o,uint16Array:s,uint32Array:u}=Ie;let f=a*2;if(wt(f,s)){const d=Mt(a,u),p=Ht(f,s);return wv(r,n,l,d,p)}else{const d=_f(a,u),p=Mv[d],m=l.direction[p]>=0;let g,v;m?(g=Vt(a),v=Gt(a,u)):(g=Gt(a,u),v=Vt(a));const b=Gn(g,o,l,wd)?Pl(g,r,n,l):null;if(b){const _=b.point[p];if(m?_<=o[v+d]:_>=o[v+d+3])return b}const A=Gn(v,o,l,wd)?Pl(v,r,n,l):null;return b&&A?b.distance<=A.distance?b:A:b||A||null}}const to=new Qe,jr=new $t,Br=new $t,La=new Je,Sd=new mt,no=new mt;function Cv(a,r,n,l){Ie.setBuffer(a._roots[r]);const o=Ml(0,a,n,l);return Ie.clearBuffer(),o}function Ml(a,r,n,l,o=null){const{float32Array:s,uint16Array:u,uint32Array:f}=Ie;let d=a*2;if(o===null&&(n.boundingBox||n.computeBoundingBox(),Sd.set(n.boundingBox.min,n.boundingBox.max,l),o=Sd),wt(d,u)){const p=r.geometry,m=p.index,g=p.attributes.position,v=n.index,b=n.attributes.position,A=Mt(a,f),_=Ht(d,u);if(La.copy(l).invert(),n.boundsTree)return De(a,s,no),no.matrix.copy(La),no.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:w=>no.intersectsBox(w),intersectsTriangle:w=>{w.a.applyMatrix4(l),w.b.applyMatrix4(l),w.c.applyMatrix4(l),w.needsUpdate=!0;for(let x=A*3,S=(_+A)*3;x<S;x+=3)if(We(Br,x,m,g),Br.needsUpdate=!0,w.intersectsTriangle(Br))return!0;return!1}});for(let w=A*3,x=(_+A)*3;w<x;w+=3){We(jr,w,m,g),jr.a.applyMatrix4(La),jr.b.applyMatrix4(La),jr.c.applyMatrix4(La),jr.needsUpdate=!0;for(let S=0,E=v.count;S<E;S+=3)if(We(Br,S,v,b),Br.needsUpdate=!0,jr.intersectsTriangle(Br))return!0}}else{const p=a+8,m=f[a+6];return De(p,s,to),!!(o.intersectsBox(to)&&Ml(p,r,n,l,o)||(De(m,s,to),o.intersectsBox(to)&&Ml(m,r,n,l,o)))}}const ro=new Je,tl=new mt,Ca=new mt,Rv=new V,Iv=new V,zv=new V,kv=new V;function Nv(a,r,n,l={},o={},s=0,u=1/0){r.boundingBox||r.computeBoundingBox(),tl.set(r.boundingBox.min,r.boundingBox.max,n),tl.needsUpdate=!0;const f=a.geometry,d=f.attributes.position,p=f.index,m=r.attributes.position,g=r.index,v=Yt.getPrimitive(),b=Yt.getPrimitive();let A=Rv,_=Iv,w=null,x=null;o&&(w=zv,x=kv);let S=1/0,E=null,P=null;return ro.copy(n).invert(),Ca.matrix.copy(ro),a.shapecast({boundsTraverseOrder:M=>tl.distanceToBox(M),intersectsBounds:(M,R,L)=>L<S&&L<u?(R&&(Ca.min.copy(M.min),Ca.max.copy(M.max),Ca.needsUpdate=!0),!0):!1,intersectsRange:(M,R)=>{if(r.boundsTree)return r.boundsTree.shapecast({boundsTraverseOrder:L=>Ca.distanceToBox(L),intersectsBounds:(L,N,C)=>C<S&&C<u,intersectsRange:(L,N)=>{for(let C=L,O=L+N;C<O;C++){We(b,3*C,g,m),b.a.applyMatrix4(n),b.b.applyMatrix4(n),b.c.applyMatrix4(n),b.needsUpdate=!0;for(let B=M,F=M+R;B<F;B++){We(v,3*B,p,d),v.needsUpdate=!0;const K=v.distanceToTriangle(b,A,w);if(K<S&&(_.copy(A),x&&x.copy(w),S=K,E=B,P=C),K<s)return!0}}}});{const L=$r(r);for(let N=0,C=L;N<C;N++){We(b,3*N,g,m),b.a.applyMatrix4(n),b.b.applyMatrix4(n),b.c.applyMatrix4(n),b.needsUpdate=!0;for(let O=M,B=M+R;O<B;O++){We(v,3*O,p,d),v.needsUpdate=!0;const F=v.distanceToTriangle(b,A,w);if(F<S&&(_.copy(A),x&&x.copy(w),S=F,E=O,P=N),F<s)return!0}}}}}),Yt.releasePrimitive(v),Yt.releasePrimitive(b),S===1/0?null:(l.point?l.point.copy(_):l.point=_.clone(),l.distance=S,l.faceIndex=E,o&&(o.point?o.point.copy(x):o.point=x.clone(),o.point.applyMatrix4(ro),_.applyMatrix4(ro),o.distance=_.sub(o.point).length(),o.faceIndex=P),l)}function jv(a,r=null){r&&Array.isArray(r)&&(r=new Set(r));const n=a.geometry,l=n.index?n.index.array:null,o=n.attributes.position;let s,u,f,d,p=0;const m=a._roots;for(let v=0,b=m.length;v<b;v++)s=m[v],u=new Uint32Array(s),f=new Uint16Array(s),d=new Float32Array(s),g(0,p),p+=s.byteLength;function g(v,b,A=!1){const _=v*2;if(f[_+15]===vo){const w=u[v+6],x=f[_+14];let S=1/0,E=1/0,P=1/0,M=-1/0,R=-1/0,L=-1/0;for(let N=w,C=w+x;N<C;N++){const O=3*a.resolveTriangleIndex(N);for(let B=0;B<3;B++){let F=O+B;F=l?l[F]:F;const K=o.getX(F),$=o.getY(F),le=o.getZ(F);K<S&&(S=K),K>M&&(M=K),$<E&&(E=$),$>R&&(R=$),le<P&&(P=le),le>L&&(L=le)}}return d[v+0]!==S||d[v+1]!==E||d[v+2]!==P||d[v+3]!==M||d[v+4]!==R||d[v+5]!==L?(d[v+0]=S,d[v+1]=E,d[v+2]=P,d[v+3]=M,d[v+4]=R,d[v+5]=L,!0):!1}else{const w=v+8,x=u[v+6],S=w+b,E=x+b;let P=A,M=!1,R=!1;r?P||(M=r.has(S),R=r.has(E),P=!M&&!R):(M=!0,R=!0);const L=P||M,N=P||R;let C=!1;L&&(C=g(w,b,P));let O=!1;N&&(O=g(x,b,P));const B=C||O;if(B)for(let F=0;F<3;F++){const K=w+F,$=x+F,le=d[K],fe=d[K+3],ve=d[$],G=d[$+3];d[v+F]=le<ve?le:ve,d[v+F+3]=fe>G?fe:G}return B}}}const _d=new V;function Bv(a,r,n,l,o){Ie.setBuffer(a._roots[r]),Ll(0,a,n,l,o),Ie.clearBuffer()}function Ll(a,r,n,l,o){const{float32Array:s,uint16Array:u,uint32Array:f}=Ie,d=a*2;if(wt(d,u)){const p=Mt(a,f),m=Ht(d,u);Ev(r,n,l,p,m,o)}else{const p=Vt(a);Gn(p,s,l,_d)&&Ll(p,r,n,l,o);const m=Gt(a,f);Gn(m,s,l,_d)&&Ll(m,r,n,l,o)}}const Ed=new V,Ov=["x","y","z"];function Dv(a,r,n,l){Ie.setBuffer(a._roots[r]);const o=Cl(0,a,n,l);return Ie.clearBuffer(),o}function Cl(a,r,n,l){const{float32Array:o,uint16Array:s,uint32Array:u}=Ie;let f=a*2;if(wt(f,s)){const d=Mt(a,u),p=Ht(f,s);return Av(r,n,l,d,p)}else{const d=_f(a,u),p=Ov[d],m=l.direction[p]>=0;let g,v;m?(g=Vt(a),v=Gt(a,u)):(g=Gt(a,u),v=Vt(a));const b=Gn(g,o,l,Ed)?Cl(g,r,n,l):null;if(b){const _=b.point[p];if(m?_<=o[v+d]:_>=o[v+d+3])return b}const A=Gn(v,o,l,Ed)?Cl(v,r,n,l):null;return b&&A?b.distance<=A.distance?b:A:b||A||null}}const ao=new Qe,Or=new $t,Dr=new $t,Ra=new Je,Ad=new mt,io=new mt;function Uv(a,r,n,l){Ie.setBuffer(a._roots[r]);const o=Rl(0,a,n,l);return Ie.clearBuffer(),o}function Rl(a,r,n,l,o=null){const{float32Array:s,uint16Array:u,uint32Array:f}=Ie;let d=a*2;if(o===null&&(n.boundingBox||n.computeBoundingBox(),Ad.set(n.boundingBox.min,n.boundingBox.max,l),o=Ad),wt(d,u)){const p=r.geometry,m=p.index,g=p.attributes.position,v=n.index,b=n.attributes.position,A=Mt(a,f),_=Ht(d,u);if(Ra.copy(l).invert(),n.boundsTree)return De(a,s,io),io.matrix.copy(Ra),io.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:w=>io.intersectsBox(w),intersectsTriangle:w=>{w.a.applyMatrix4(l),w.b.applyMatrix4(l),w.c.applyMatrix4(l),w.needsUpdate=!0;for(let x=A,S=_+A;x<S;x++)if(We(Dr,3*r.resolveTriangleIndex(x),m,g),Dr.needsUpdate=!0,w.intersectsTriangle(Dr))return!0;return!1}});for(let w=A,x=_+A;w<x;w++){const S=r.resolveTriangleIndex(w);We(Or,3*S,m,g),Or.a.applyMatrix4(Ra),Or.b.applyMatrix4(Ra),Or.c.applyMatrix4(Ra),Or.needsUpdate=!0;for(let E=0,P=v.count;E<P;E+=3)if(We(Dr,E,v,b),Dr.needsUpdate=!0,Or.intersectsTriangle(Dr))return!0}}else{const p=a+8,m=f[a+6];return De(p,s,ao),!!(o.intersectsBox(ao)&&Rl(p,r,n,l,o)||(De(m,s,ao),o.intersectsBox(ao)&&Rl(m,r,n,l,o)))}}const oo=new Je,nl=new mt,Ia=new mt,Fv=new V,Hv=new V,Vv=new V,Gv=new V;function Yv(a,r,n,l={},o={},s=0,u=1/0){r.boundingBox||r.computeBoundingBox(),nl.set(r.boundingBox.min,r.boundingBox.max,n),nl.needsUpdate=!0;const f=a.geometry,d=f.attributes.position,p=f.index,m=r.attributes.position,g=r.index,v=Yt.getPrimitive(),b=Yt.getPrimitive();let A=Fv,_=Hv,w=null,x=null;o&&(w=Vv,x=Gv);let S=1/0,E=null,P=null;return oo.copy(n).invert(),Ia.matrix.copy(oo),a.shapecast({boundsTraverseOrder:M=>nl.distanceToBox(M),intersectsBounds:(M,R,L)=>L<S&&L<u?(R&&(Ia.min.copy(M.min),Ia.max.copy(M.max),Ia.needsUpdate=!0),!0):!1,intersectsRange:(M,R)=>{if(r.boundsTree){const L=r.boundsTree;return L.shapecast({boundsTraverseOrder:N=>Ia.distanceToBox(N),intersectsBounds:(N,C,O)=>O<S&&O<u,intersectsRange:(N,C)=>{for(let O=N,B=N+C;O<B;O++){const F=L.resolveTriangleIndex(O);We(b,3*F,g,m),b.a.applyMatrix4(n),b.b.applyMatrix4(n),b.c.applyMatrix4(n),b.needsUpdate=!0;for(let K=M,$=M+R;K<$;K++){const le=a.resolveTriangleIndex(K);We(v,3*le,p,d),v.needsUpdate=!0;const fe=v.distanceToTriangle(b,A,w);if(fe<S&&(_.copy(A),x&&x.copy(w),S=fe,E=K,P=O),fe<s)return!0}}}})}else{const L=$r(r);for(let N=0,C=L;N<C;N++){We(b,3*N,g,m),b.a.applyMatrix4(n),b.b.applyMatrix4(n),b.c.applyMatrix4(n),b.needsUpdate=!0;for(let O=M,B=M+R;O<B;O++){const F=a.resolveTriangleIndex(O);We(v,3*F,p,d),v.needsUpdate=!0;const K=v.distanceToTriangle(b,A,w);if(K<S&&(_.copy(A),x&&x.copy(w),S=K,E=O,P=N),K<s)return!0}}}}}),Yt.releasePrimitive(v),Yt.releasePrimitive(b),S===1/0?null:(l.point?l.point.copy(_):l.point=_.clone(),l.distance=S,l.faceIndex=E,o&&(o.point?o.point.copy(x):o.point=x.clone(),o.point.applyMatrix4(oo),_.applyMatrix4(oo),o.distance=_.sub(o.point).length(),o.faceIndex=P),l)}function Kv(){return typeof SharedArrayBuffer<"u"}const Ba=new Ie.constructor,mo=new Ie.constructor,Un=new Yl(()=>new Qe),Ur=new Qe,Fr=new Qe,rl=new Qe,al=new Qe;let il=!1;function Wv(a,r,n,l){if(il)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");il=!0;const o=a._roots,s=r._roots;let u,f=0,d=0;const p=new Je().copy(n).invert();for(let m=0,g=o.length;m<g;m++){Ba.setBuffer(o[m]),d=0;const v=Un.getPrimitive();De(0,Ba.float32Array,v),v.applyMatrix4(p);for(let b=0,A=s.length;b<A&&(mo.setBuffer(s[m]),u=Zt(0,0,n,p,l,f,d,0,0,v),mo.clearBuffer(),d+=s[b].length,!u);b++);if(Un.releasePrimitive(v),Ba.clearBuffer(),f+=o[m].length,u)break}return il=!1,u}function Zt(a,r,n,l,o,s=0,u=0,f=0,d=0,p=null,m=!1){let g,v;m?(g=mo,v=Ba):(g=Ba,v=mo);const b=g.float32Array,A=g.uint32Array,_=g.uint16Array,w=v.float32Array,x=v.uint32Array,S=v.uint16Array,E=a*2,P=r*2,M=wt(E,_),R=wt(P,S);let L=!1;if(R&&M)m?L=o(Mt(r,x),Ht(r*2,S),Mt(a,A),Ht(a*2,_),d,u+r,f,s+a):L=o(Mt(a,A),Ht(a*2,_),Mt(r,x),Ht(r*2,S),f,s+a,d,u+r);else if(R){const N=Un.getPrimitive();De(r,w,N),N.applyMatrix4(n);const C=Vt(a),O=Gt(a,A);De(C,b,Ur),De(O,b,Fr);const B=N.intersectsBox(Ur),F=N.intersectsBox(Fr);L=B&&Zt(r,C,l,n,o,u,s,d,f+1,N,!m)||F&&Zt(r,O,l,n,o,u,s,d,f+1,N,!m),Un.releasePrimitive(N)}else{const N=Vt(r),C=Gt(r,x);De(N,w,rl),De(C,w,al);const O=p.intersectsBox(rl),B=p.intersectsBox(al);if(O&&B)L=Zt(a,N,n,l,o,s,u,f,d+1,p,m)||Zt(a,C,n,l,o,s,u,f,d+1,p,m);else if(O)if(M)L=Zt(a,N,n,l,o,s,u,f,d+1,p,m);else{const F=Un.getPrimitive();F.copy(rl).applyMatrix4(n);const K=Vt(a),$=Gt(a,A);De(K,b,Ur),De($,b,Fr);const le=F.intersectsBox(Ur),fe=F.intersectsBox(Fr);L=le&&Zt(N,K,l,n,o,u,s,d,f+1,F,!m)||fe&&Zt(N,$,l,n,o,u,s,d,f+1,F,!m),Un.releasePrimitive(F)}else if(B)if(M)L=Zt(a,C,n,l,o,s,u,f,d+1,p,m);else{const F=Un.getPrimitive();F.copy(al).applyMatrix4(n);const K=Vt(a),$=Gt(a,A);De(K,b,Ur),De($,b,Fr);const le=F.intersectsBox(Ur),fe=F.intersectsBox(Fr);L=le&&Zt(C,K,l,n,o,u,s,d,f+1,F,!m)||fe&&Zt(C,$,l,n,o,u,s,d,f+1,F,!m),Un.releasePrimitive(F)}}return L}const so=new mt,Td=new Qe,Qv={strategy:bf,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0};class Kl{static serialize(r,n={}){n={cloneBuffers:!0,...n};const l=r.geometry,o=r._roots,s=r._indirectBuffer,u=l.getIndex();let f;return n.cloneBuffers?f={roots:o.map(d=>d.slice()),index:u.array.slice(),indirectBuffer:s?s.slice():null}:f={roots:o,index:u.array,indirectBuffer:s},f}static deserialize(r,n,l={}){l={setIndex:!0,indirect:!!r.indirectBuffer,...l};const{index:o,roots:s,indirectBuffer:u}=r,f=new Kl(n,{...l,[Xs]:!0});if(f._roots=s,f._indirectBuffer=u||null,l.setIndex){const d=n.getIndex();if(d===null){const p=new Na(r.index,1,!1);n.setIndex(p)}else d.array!==o&&(d.array.set(o),d.needsUpdate=!0)}return f}get indirect(){return!!this._indirectBuffer}constructor(r,n={}){if(r.isBufferGeometry){if(r.index&&r.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(n=Object.assign({...Qv,[Xs]:!1},n),n.useSharedArrayBuffer&&!Kv())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=r,this._roots=null,this._indirectBuffer=null,n[Xs]||(cv(this,n),!r.boundingBox&&n.setBoundingBox&&(r.boundingBox=this.getBoundingBox(new Qe)));const{_indirectBuffer:l}=this;this.resolveTriangleIndex=n.indirect?o=>l[o]:o=>o}refit(r=null){return(this.indirect?jv:_v)(this,r)}traverse(r,n=0){const l=this._roots[n],o=new Uint32Array(l),s=new Uint16Array(l);u(0);function u(f,d=0){const p=f*2,m=s[p+15]===vo;if(m){const g=o[f+6],v=s[p+14];r(d,m,new Float32Array(l,f*4,6),g,v)}else{const g=f+ja/4,v=o[f+6],b=o[f+7];r(d,m,new Float32Array(l,f*4,6),b)||(u(g,d+1),u(v,d+1))}}}raycast(r,n=qr){const l=this._roots,o=this.geometry,s=[],u=n.isMaterial,f=Array.isArray(n),d=o.groups,p=u?n.side:n,m=this.indirect?Bv:Pv;for(let g=0,v=l.length;g<v;g++){const b=f?n[d[g].materialIndex].side:p,A=s.length;if(m(this,g,b,r,s),f){const _=d[g].materialIndex;for(let w=A,x=s.length;w<x;w++)s[w].face.materialIndex=_}}return s}raycastFirst(r,n=qr){const l=this._roots,o=this.geometry,s=n.isMaterial,u=Array.isArray(n);let f=null;const d=o.groups,p=s?n.side:n,m=this.indirect?Dv:Lv;for(let g=0,v=l.length;g<v;g++){const b=u?n[d[g].materialIndex].side:p,A=m(this,g,b,r);A!=null&&(f==null||A.distance<f.distance)&&(f=A,u&&(A.face.materialIndex=d[g].materialIndex))}return f}intersectsGeometry(r,n){let l=!1;const o=this._roots,s=this.indirect?Uv:Cv;for(let u=0,f=o.length;u<f&&(l=s(this,u,r,n),!l);u++);return l}shapecast(r){const n=Yt.getPrimitive(),l=this.indirect?Tv:Sv;let{boundsTraverseOrder:o,intersectsBounds:s,intersectsRange:u,intersectsTriangle:f}=r;if(u&&f){const g=u;u=(v,b,A,_,w)=>g(v,b,A,_,w)?!0:l(v,b,this,f,A,_,n)}else u||(f?u=(g,v,b,A)=>l(g,v,this,f,b,A,n):u=(g,v,b)=>b);let d=!1,p=0;const m=this._roots;for(let g=0,v=m.length;g<v;g++){const b=m[g];if(d=gv(this,g,s,u,o,p),d)break;p+=b.byteLength}return Yt.releasePrimitive(n),d}bvhcast(r,n,l){let{intersectsRanges:o,intersectsTriangles:s}=l;const u=Yt.getPrimitive(),f=this.geometry.index,d=this.geometry.attributes.position,p=this.indirect?A=>{const _=this.resolveTriangleIndex(A);We(u,_*3,f,d)}:A=>{We(u,A*3,f,d)},m=Yt.getPrimitive(),g=r.geometry.index,v=r.geometry.attributes.position,b=r.indirect?A=>{const _=r.resolveTriangleIndex(A);We(m,_*3,g,v)}:A=>{We(m,A*3,g,v)};if(s){const A=(_,w,x,S,E,P,M,R)=>{for(let L=x,N=x+S;L<N;L++){b(L),m.a.applyMatrix4(n),m.b.applyMatrix4(n),m.c.applyMatrix4(n),m.needsUpdate=!0;for(let C=_,O=_+w;C<O;C++)if(p(C),u.needsUpdate=!0,s(u,m,C,L,E,P,M,R))return!0}return!1};if(o){const _=o;o=function(w,x,S,E,P,M,R,L){return _(w,x,S,E,P,M,R,L)?!0:A(w,x,S,E,P,M,R,L)}}else o=A}return Wv(this,r,n,o)}intersectsBox(r,n){return so.set(r.min,r.max,n),so.needsUpdate=!0,this.shapecast({intersectsBounds:l=>so.intersectsBox(l),intersectsTriangle:l=>so.intersectsTriangle(l)})}intersectsSphere(r){return this.shapecast({intersectsBounds:n=>r.intersectsBox(n),intersectsTriangle:n=>n.intersectsSphere(r)})}closestPointToGeometry(r,n,l={},o={},s=0,u=1/0){return(this.indirect?Yv:Nv)(this,r,n,l,o,s,u)}closestPointToPoint(r,n={},l=0,o=1/0){return vv(this,r,n,l,o)}getBoundingBox(r){return r.makeEmpty(),this._roots.forEach(n=>{De(0,new Float32Array(n),Td),r.union(Td)}),r}}function Pd(a,r,n){return a===null||(a.point.applyMatrix4(r.matrixWorld),a.distance=a.point.distanceTo(n.ray.origin),a.object=r,a.distance<n.near||a.distance>n.far)?null:a}const ol=new kd,Md=new Je,qv=Vn.prototype.raycast;function Xv(a,r){if(this.geometry.boundsTree){if(this.material===void 0)return;Md.copy(this.matrixWorld).invert(),ol.copy(a.ray).applyMatrix4(Md);const n=this.geometry.boundsTree;if(a.firstHitOnly===!0){const l=Pd(n.raycastFirst(ol,this.material),this,a);l&&r.push(l)}else{const l=n.raycast(ol,this.material);for(let o=0,s=l.length;o<s;o++){const u=Pd(l[o],this,a);u&&r.push(u)}}}else qv.call(this,a,r)}function Zv(a){return this.boundsTree=new Kl(this,a),this.boundsTree}function $v(){this.boundsTree=null}const Ld=a=>a.isMesh,Jv=z.forwardRef(({enabled:a=!0,firstHitOnly:r=!1,children:n,strategy:l=xf,verbose:o=!1,setBoundingBox:s=!0,maxDepth:u=40,maxLeafTris:f=10,indirect:d=!1,...p},m)=>{const g=z.useRef(null),v=at(b=>b.raycaster);return z.useImperativeHandle(m,()=>g.current,[]),z.useEffect(()=>{if(a){const b={strategy:l,verbose:o,setBoundingBox:s,maxDepth:u,maxLeafTris:f,indirect:d},A=g.current;return v.firstHitOnly=r,A.traverse(_=>{Ld(_)&&!_.geometry.boundsTree&&_.raycast===Vn.prototype.raycast&&(_.raycast=Xv,_.geometry.computeBoundsTree=Zv,_.geometry.disposeBoundsTree=$v,_.geometry.computeBoundsTree(b))}),()=>{delete v.firstHitOnly,A.traverse(_=>{Ld(_)&&_.geometry.boundsTree&&(_.geometry.disposeBoundsTree(),_.raycast=Vn.prototype.raycast)})}}},[]),z.createElement("group",Hn({ref:g},p),n)}),e0=z.forwardRef(function({children:a,disable:r,disableX:n,disableY:l,disableZ:o,left:s,right:u,top:f,bottom:d,front:p,back:m,onCentered:g,precise:v=!0,cacheKey:b=0,...A},_){const w=z.useRef(null),x=z.useRef(null),S=z.useRef(null);return z.useLayoutEffect(()=>{x.current.matrixWorld.identity();const E=new Qe().setFromObject(S.current,v),P=new V,M=new Zr,R=E.max.x-E.min.x,L=E.max.y-E.min.y,N=E.max.z-E.min.z;E.getCenter(P),E.getBoundingSphere(M);const C=f?L/2:d?-L/2:0,O=s?-R/2:u?R/2:0,B=p?N/2:m?-N/2:0;x.current.position.set(r||n?0:-P.x+O,r||l?0:-P.y+C,r||o?0:-P.z+B),typeof g<"u"&&g({parent:w.current.parent,container:w.current,width:R,height:L,depth:N,boundingBox:E,boundingSphere:M,center:P,verticalAlignment:C,horizontalAlignment:O,depthAlignment:B})},[b,g,f,s,p,r,n,l,o,v,u,d,m]),z.useImperativeHandle(_,()=>w.current,[]),z.createElement("group",Hn({ref:w},A),z.createElement("group",{ref:x},z.createElement("group",{ref:S},a)))});function t0(){const{controllers:a}=He(),r=z.useRef(),n=z.useRef();return dr(()=>{if(a&&a[0]&&a[1]){if(a[0].controller){const l=a[0].hand.joints["index-finger-tip"].position;r.current.position.copy(l)}if(a[1].controller){const l=a[1].hand.joints["index-finger-tip"].position;n.current.position.copy(l)}}}),ne.jsxs(ne.Fragment,{children:[ne.jsxs("mesh",{name:"leftTipBbox",ref:n,children:[ne.jsx("boxGeometry",{args:[.02,.02,.02]}),ne.jsx("meshStandardMaterial",{color:"blue",transparent:!0,opacity:0})]}),ne.jsxs("mesh",{name:"rightTipBbox",ref:r,children:[ne.jsx("boxGeometry",{args:[.02,.02,.02]}),ne.jsx("meshStandardMaterial",{color:"orange",transparent:!0,opacity:0})]})]})}function sl(a){const{currentLine:r,scale:n}=a,l=z.useRef();return ne.jsxs("group",{children:[ne.jsx(e0,{bottom:!0,right:!0,position:[r.midPoint.x,r.midPoint.y,r.midPoint.z],rotation:[0,0,0],children:ne.jsx(yf,{color:"gray",scale:.05,ref:l,children:`${(r.startPoint.distanceTo(r.endPoint)*n).toFixed(2)} µm`})}),ne.jsx(Kg,{points:[r.startPoint,r.endPoint],color:"white",lineWidth:2,dashed:!1,segments:!0})]})}function n0(a){const{segmentationGroup:r,segmentationSettings:n,segmentationSceneScale:l,renderingSettings:o,materialRef:s,highlightEntity:u,setObsHighlight:f}=a,d=z.useRef(),p=z.useRef(),m=z.useRef(),{isPresenting:g}=He();z.useEffect(()=>{g&&(d!=null&&d.current)?s!==null&&(s.current.material.uniforms.u_physical_Pixel.value=.2):g||s!==null&&(s.current.material.uniforms.u_physical_Pixel.value=2.5)},[g]);const{scene:v}=at(),{controllers:b}=He(),[A,_]=z.useState(!1),[w,x]=z.useState(!1),[S,E]=z.useState(!1),[P,M]=z.useState({startPoint:new V,midPoint:new V,endPoint:new V,setStartPoint:!1,setEndPoint:!1}),[R,L]=z.useState([]),[N,C]=z.useState(0);return dr(()=>{if(g){const O=v.getObjectByName("rightTipBbox"),B=v.getObjectByName("leftTipBbox"),F=new Qe().setFromObject(B),K=new Qe().setFromObject(O);let $=!1;if(C(N-1),F.intersectsBox(K)&&F.max.x!==-K.min.x&&(_(!0),E(!0),M({startPoint:new V,midPoint:new V,endPoint:new V,setStartPoint:!1,setEndPoint:!1})),A){let le=b[1].hand.joints["index-finger-tip"].position.clone(),fe=b[0].hand.joints["index-finger-tip"].position.clone();le=le.applyMatrix4(m.current.matrixWorld.clone().invert()),fe=fe.applyMatrix4(m.current.matrixWorld.clone().invert());let ve=le.clone(),G=fe.clone();P.setStartPoint&&(ve=P.startPoint),P.setEndPoint&&(G=P.endPoint),M({startPoint:ve,midPoint:new V().addVectors(ve,G).multiplyScalar(.5),endPoint:G,setStartPoint:P.setStartPoint,setEndPoint:P.setEndPoint}),b[0].hand.inputState.pinching===!0&&M({startPoint:P.startPoint,midPoint:P.midPoint,endPoint:P.endPoint,setStartPoint:P.setStartPoint,setEndPoint:!0}),b[1].hand.inputState.pinching===!0&&M({startPoint:P.startPoint,midPoint:P.midPoint,endPoint:P.endPoint,setStartPoint:!0,setEndPoint:P.setEndPoint}),P.setStartPoint&&P.setEndPoint&&(R.push(P),L(R),E(!1),_(!1),C(8))}else N<=0&&(d!=null&&d.current)&&g&&(d.current.children[0].children.forEach((le,fe)=>{const ve=d.current.children[0].children[fe],G=new Qe().setFromObject(ve),ee=F.intersectsBox(G),Z=K.intersectsBox(G);(ee||Z)&&($=!0,f(ve.name),x(!0),b[1]!==void 0&&ee&&b[1].hand.inputState.pinching===!0&&(C(10),$=!1,b[1].hand.inputState.pinching=!1),b[0]!==void 0&&Z&&b[0].hand.inputState.pinching===!0&&(C(10),$=!1,b[0].hand.inputState.pinching=!1))}),!$&&w&&(f(null),x(!1)))}},[A,w,P,R,S,N,g]),ne.jsx("group",{children:He().isPresenting?ne.jsxs(Pm,{children:[ne.jsxs("group",{ref:m,children:[r!=null&&r.visible?ne.jsxs("group",{children:[ne.jsx("hemisphereLight",{skyColor:8421504,groundColor:6316128}),ne.jsx("directionalLight",{color:16777215,position:[0,-800,0]}),ne.jsx("primitive",{ref:d,object:r,position:[-.18,1.13,-1],scale:[.002*l[0],.002*l[1],.002*l[2]]})]}):null,o.uniforms&&o.shader?ne.jsx("group",{children:ne.jsxs("mesh",{name:"cube",position:[-.18,1.13,-1],rotation:[0,0,0],scale:[.002*o.meshScale[0],.002*o.meshScale[1],.002*o.meshScale[2]],ref:s,children:[ne.jsx("boxGeometry",{args:o.geometrySize}),ne.jsx("shaderMaterial",{customProgramCacheKey:()=>"1",side:qr,uniforms:o.uniforms,needsUpdate:!0,transparent:!0,vertexShader:o.shader.vertexShader,fragmentShader:o.shader.fragmentShader})]})}):null]}),ne.jsx("group",{name:"currentLine",ref:p,children:S?ne.jsx(sl,{currentLine:P,scale:1/.002*.4}):null}),ne.jsx("group",{name:"lines",children:R.map(O=>ne.jsx(sl,{currentLine:O,scale:1/.002*.4}))})]}):ne.jsxs("group",{children:[ne.jsxs("group",{children:[r!=null&&r.visible?ne.jsxs("group",{children:[ne.jsx("hemisphereLight",{skyColor:8421504,groundColor:6316128}),ne.jsx("directionalLight",{color:16777215,position:[0,-800,0]}),ne.jsx("directionalLight",{color:16777215,position:[0,800,0]}),ne.jsx(Jv,{firstHitOnly:!0,children:ne.jsx("primitive",{ref:d,object:r,position:[0,0,0],onClick:O=>{O.object.parent.userData.name==="finalPass"&&u(O.object.name,O.object.userData.layerScope,O.object.userData.channelScope)},onPointerOver:O=>{f(O.object.name)},onPointerOut:O=>f(null)})})]}):null,o.uniforms&&o.shader?ne.jsx("group",{children:ne.jsxs("mesh",{scale:o.meshScale,ref:s,children:[ne.jsx("boxGeometry",{args:o.geometrySize}),ne.jsx("shaderMaterial",{customProgramCacheKey:()=>"1",side:qr,uniforms:o.uniforms,needsUpdate:!0,transparent:!0,vertexShader:o.shader.vertexShader,fragmentShader:o.shader.fragmentShader})]})}):null]}),ne.jsx("group",{name:"lines",children:R.map(O=>ne.jsx(sl,{currentLine:O,scale:1}))})]})})}function r0(){const{controllers:a}=He();return dr(()=>{var r,n,l,o,s,u,f,d,p,m,g,v,b,A;a!=null&&a[0]&&(a!=null&&a[1])&&((f=(u=(s=(o=(l=(n=(r=a[0])==null?void 0:r.hand)==null?void 0:n.children)==null?void 0:l[25])==null?void 0:o.children)==null?void 0:s[0])==null?void 0:u.children)!=null&&f[0]&&(a[0].hand.children[25].children[0].children[0].material.transparent=!0,a[0].hand.children[25].children[0].children[0].material.opacity=.5),(A=(b=(v=(g=(m=(p=(d=a[1])==null?void 0:d.hand)==null?void 0:p.children)==null?void 0:m[25])==null?void 0:g.children)==null?void 0:v[0])==null?void 0:b.children)!=null&&A[0]&&(a[1].hand.children[25].children[0].children[0].material.transparent=!0,a[1].hand.children[25].children[0].children[0].material.opacity=.5))}),null}class a0{constructor(r,n,l,o,s){if(this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new Xp,this.matrix.identity(),this.sliceList=[],this.lowerThresholdValue=-1/0,this.upperThresholdValue=1/0,arguments.length>0){switch(this.xLength=Number(r)||1,this.yLength=Number(n)||1,this.zLength=Number(l)||1,o){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(s);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(s);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(s);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(s);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(s);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(s);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw new Error("uint64_t type is not supported in JavaScript");case"Float32":case"float32":case"float":this.data=new Float32Array(s);break;case"Float64":case"float64":case"double":this.data=new Float64Array(s);break;default:this.data=new Uint8Array(s)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw new Error("lengths are not matching arrayBuffer size")}}get lowerThreshold(){return this.lowerThresholdValue}set lowerThreshold(r){this.lowerThresholdValue=r,this.sliceList.forEach(n=>{n.geometryNeedsUpdate=!0})}get upperThreshold(){return this.upperThresholdValue}set upperThreshold(r){this.upperThresholdValue=r,this.sliceList.forEach(n=>{n.geometryNeedsUpdate=!0})}getData(r,n,l){return this.data[l*this.xLength*this.yLength+n*this.xLength+r]}access(r,n,l){return l*this.xLength*this.yLength+n*this.xLength+r}reverseAccess(r){const n=Math.floor(r/(this.yLength*this.xLength)),l=Math.floor((r-n*this.yLength*this.xLength)/this.xLength);return[r-n*this.yLength*this.xLength-l*this.xLength,l,n]}map(r,n){const{length:l}=this.data,o=n||this;for(let s=0;s<l;s++)this.data[s]=r.call(o,this.data[s],s,this.data);return this}extractPerpendicularPlane(r,n){const l=new Je().identity(),o=this;let s,u,f,d;const p=new V,m=new V,g=new V,v=new V(this.xLength,this.yLength,this.zLength);switch(r){case"x":p.set(1,0,0),m.set(0,0,-1),g.set(0,-1,0),s=this.spacing[2],u=this.spacing[1],d=new V(n,0,0),l.multiply(new Je().makeRotationY(Math.PI/2)),f=(o.RASDimensions[0]-1)/2,l.setPosition(new V(n-f,0,0));break;case"y":p.set(0,1,0),m.set(1,0,0),g.set(0,0,1),s=this.spacing[0],u=this.spacing[2],d=new V(0,n,0),l.multiply(new Je().makeRotationX(-Math.PI/2)),f=(o.RASDimensions[1]-1)/2,l.setPosition(new V(0,n-f,0));break;case"z":default:p.set(0,0,1),m.set(1,0,0),g.set(0,-1,0),s=this.spacing[0],u=this.spacing[1],d=new V(0,0,n),f=(o.RASDimensions[2]-1)/2,l.setPosition(new V(0,0,n-f));break}m.applyMatrix4(o.inverseMatrix).normalize(),m.argVar="i",g.applyMatrix4(o.inverseMatrix).normalize(),g.argVar="j",p.applyMatrix4(o.inverseMatrix).normalize();const b=Math.floor(Math.abs(m.dot(v))),A=Math.floor(Math.abs(g.dot(v))),_=Math.abs(b*s),w=Math.abs(A*u);d=Math.abs(Math.round(d.applyMatrix4(o.inverseMatrix).dot(p)));const x=[new V(1,0,0),new V(0,1,0),new V(0,0,1)],S=[m,g,p].find(R=>Math.abs(R.dot(x[0]))>.9),E=[m,g,p].find(R=>Math.abs(R.dot(x[1]))>.9),P=[m,g,p].find(R=>Math.abs(R.dot(x[2]))>.9);function M(R,L){const N=S===p?d:S.arglet==="i"?R:L,C=E===p?d:E.arglet==="i"?R:L,O=P===p?d:P.arglet==="i"?R:L,B=S.dot(x[0])>0?N:o.xLength-1-N,F=E.dot(x[1])>0?C:o.yLength-1-C,K=P.dot(x[2])>0?O:o.zLength-1-O;return o.access(B,F,K)}return{iLength:b,jLength:A,sliceAccess:M,matrix:l,planeWidth:_,planeHeight:w}}computeMinMax(){let r=1/0,n=-1/0;const l=this.data.length;let o=0;for(o=0;o<l;o++)if(!Number.isNaN(this.data[o])){const s=this.data[o];r=Math.min(r,s),n=Math.max(n,s)}return this.min=r,this.max=n,[r,n]}}const i0={uniforms:{u_size:{value:new V(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_opacity:{value:.5},u_clim:{value:new be(.2,.8)},u_clim2:{value:new be(.2,.8)},u_clim3:{value:new be(.2,.8)},u_clim4:{value:new be(.2,.8)},u_clim5:{value:new be(.2,.8)},u_clim6:{value:new be(.2,.8)},u_xClip:{value:new be(-1,1e6)},u_yClip:{value:new be(-1,1e6)},u_zClip:{value:new be(-1,1e6)},u_data:{value:null},u_stop_geom:{value:null},u_geo_color:{value:null},u_window_size:{value:new be(1,1)},u_vol_scale:{value:new be(1,1,1)},u_physical_Pixel:{value:.5},volumeTex:{value:null},volumeTex2:{value:null},volumeTex3:{value:null},volumeTex4:{value:null},volumeTex5:{value:null},volumeTex6:{value:null},u_color:{value:new V(0,0,0)},u_color2:{value:new V(0,0,0)},u_color3:{value:new V(0,0,0)},u_color4:{value:new V(0,0,0)},u_color5:{value:new V(0,0,0)},u_color6:{value:new V(0,0,0)},u_cmdata:{value:null},near:{value:.1},far:{value:1e4},alphaScale:{value:0},dtScale:{value:1},volumeCount:{value:0},finalGamma:{value:0},boxSize:{value:new V(1,1,1)}},vertexShader:["out vec3 rayDirUnnorm;","out vec3 cameraCorrected;","uniform vec3 u_vol_scale;","uniform vec3 u_size;","varying vec3 worldSpaceCoords;","varying vec2 vUv;","varying vec4 glPosition;","uniform highp vec3 boxSize;","void main()","{","   worldSpaceCoords = position / boxSize + vec3(0.5, 0.5, 0.5); //move it from [-0.5;0.5] to [0,1]","   cameraCorrected = (inverse(modelMatrix) * vec4(cameraPosition, 1.)).xyz;","   rayDirUnnorm = position - cameraCorrected;","   gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","   glPosition = gl_Position;","   vUv = uv;","}"].join(`
`),fragmentShader:["#include <packing>","precision highp float;"," precision mediump sampler3D;","in vec3 rayDirUnnorm;","in vec3 cameraCorrected;","uniform sampler3D volumeTex;","uniform sampler3D volumeTex2;","uniform sampler3D volumeTex3;","uniform sampler3D volumeTex4;","uniform sampler3D volumeTex5;","uniform sampler3D volumeTex6;","uniform vec2 u_clim;","uniform vec2 u_clim2;","uniform vec2 u_clim3;","uniform vec2 u_clim4;","uniform vec2 u_clim5;","uniform vec2 u_clim6;","uniform vec2 u_window_size;","uniform vec2 u_xClip;","uniform vec2 u_yClip;","uniform vec2 u_zClip;","uniform sampler2D u_cmdata;","uniform sampler2D u_stop_geom;","uniform sampler2D u_geo_color;","uniform vec3 u_color;","uniform vec3 u_color2;","uniform vec3 u_color3;","uniform vec3 u_color4;","uniform vec3 u_color5;","uniform vec3 u_color6;","uniform float alphaScale;","uniform float dtScale;","uniform float finalGamma;","uniform float volumeCount;","uniform highp vec3 boxSize;","uniform vec3 u_size;","uniform int u_renderstyle;","uniform float u_opacity;","uniform vec3 u_vol_scale;","uniform float near;","uniform float u_physical_Pixel;","varying vec2 vUv;","varying vec4 glPosition;","uniform float far;","varying vec3 worldSpaceCoords;","float linearize_z(float z) {","        return near * far / (far + z * (near - far));","}","vec2 intersect_hit(vec3 orig, vec3 dir) {","  vec3 boxMin = vec3(-0.5) * boxSize;","  vec3 boxMax = vec3( 0.5) * boxSize;","  if(u_xClip.x > -1.0){   boxMin.x = u_xClip.x-(boxSize.x/2.0);","   if(u_xClip.y < boxSize.x)","       boxMax.x = u_xClip.y-(boxSize.x/2.0);","  }","  if(u_yClip.x > -1.0){   boxMin.y = u_yClip.x-(boxSize.y/2.0);","   if(u_yClip.y < boxSize.y)","      boxMax.y = u_yClip.y-(boxSize.y/2.0);","  }","  if(u_zClip.x > -1.0){   boxMin.z = u_zClip.x-(boxSize.z/2.0);","   if(u_zClip.y < boxSize.z)       boxMax.z = u_zClip.y-(boxSize.z/2.0);","  }","  vec3 invDir = 1.0 / dir;","  vec3 tmin0 = (boxMin - orig) * invDir;","  vec3 tmax0 = (boxMax - orig) * invDir;","  vec3 tmin = min(tmin0, tmax0);","  vec3 tmax = max(tmin0, tmax0);","  float t0 = max(tmin.x, max(tmin.y, tmin.z));","  float t1 = min(tmax.x, min(tmax.y, tmax.z));","  return vec2(t0, t1);","}","   // Pseudo-random number gen from","   // http://www.reedbeta.com/blog/quick-and-easy-gpu-random-numbers-in-d3d11/","   // with some tweaks for the range of values","       float wang_hash(int seed) {","     seed = (seed ^ 61) ^ (seed >> 16);","     seed *= 9;","     seed = seed ^ (seed >> 4);","     seed *= 0x27d4eb2d;","     seed = seed ^ (seed >> 15);","     return float(seed % 2147483647) / float(2147483647);","     }","float linear_to_srgb(float x) {","   if (x <= 0.0031308f) {","     return 12.92f * x;","   }","   return 1.055f * pow(x, 1.f / 2.4f) - 0.055f;","}","void main(void) {","  //STEP 1: Normalize the view Ray","  vec3 rayDir = normalize(rayDirUnnorm);","  //STEP 2: Intersect the ray with the volume bounds to find the interval along the ray overlapped by the volume","  vec2 t_hit = intersect_hit(cameraCorrected, rayDir);","  if (t_hit.x >= t_hit.y) {","    discard;","  }","  //No sample behind the eye","  t_hit.x = max(t_hit.x, 0.0);","  //STEP 3: Compute the step size to march through the volume grid","  ivec3 volumeTexSize = textureSize(volumeTex, 0);","  vec3 dt_vec = 1.0 / (vec3(volumeTexSize) * abs(rayDir));","  float dt = min(dt_vec.x, min(dt_vec.y, dt_vec.z));","  dt = max(1.0, dt);","  // Ray starting point, in the real space where the box may not be a cube.","  // Prevents a lost WebGL context."," float offset = wang_hash(int(gl_FragCoord.x + 640.0 * gl_FragCoord.y));"," vec3 p = cameraCorrected + (t_hit.x + offset + dt) * rayDir;","  // Most browsers do not need this initialization, but add it to be safe.","  gl_FragColor = vec4(0.0);","  p = p / boxSize + vec3(0.5);","  vec3 step = (rayDir * dt) / boxSize;","  // ","  // Initialization of some variables.","  float max_val = 0.0;","  float max_val2 = 0.0;","  float max_val3 = 0.0;","  float max_val4 = 0.0;","  float max_val5 = 0.0;","  float max_val6 = 0.0;","  vec3 rgbCombo = vec3(0.0);","  float total = 0.0;","  int max_i = 30000;","  int i = 0;","  float x = gl_FragCoord.x/u_window_size.x;","  float y = gl_FragCoord.y/u_window_size.y;","  vec3 meshPos = texture2D(u_stop_geom, vec2(x,y)).xyz;","  float dist = 1000.0;","  for (float t = t_hit.x; t < t_hit.y; t += dt) {","       if(meshPos != vec3(0.0))           dist = distance(p,meshPos);","      float val = texture(volumeTex, p.xyz).r;","      val = max(0.0, (val - u_clim[0]) / (u_clim[1] - u_clim[0]));","      rgbCombo += max(0.0, min(1.0, val)) * u_color;","      total += val;","      if(volumeCount > 1.0){           float val2 = texture(volumeTex2, p.xyz).r;","           val2 = max(0.0,(val2 - u_clim2[0]) / (u_clim2[1] - u_clim2[0]));","           rgbCombo += max(0.0, min(1.0, val2)) * u_color2;","           total += val2;","       }","       if(volumeCount > 2.0){           float val3 = texture(volumeTex3, p.xyz).r;","           val3 = max(0.0,(val3 - u_clim3[0]) / (u_clim3[1] - u_clim3[0]));","           rgbCombo += max(0.0, min(1.0, val3)) * u_color3;","           total += val3;","       }","       if(volumeCount > 3.0){           float val4 = texture(volumeTex4, p.xyz).r;","           val4 = max(0.0,(val4 - u_clim4[0]) / (u_clim4[1] - u_clim4[0]));","           rgbCombo += max(0.0, min(1.0, val4)) * u_color4;","           total += val4;","       }","       if(volumeCount > 4.0){           float val5 = texture(volumeTex5, p.xyz).r;","           val5 = max(0.0,(val5 - u_clim5[0]) / (u_clim5[1] - u_clim5[0]));","           rgbCombo += max(0.0, min(1.0, val5)) * u_color5;","           total += val5;","        }","        if(volumeCount > 5.0){           float val6 = texture(volumeTex6, p.xyz).r;","           val6 = max(0.0,(val6 - u_clim6[0]) / (u_clim6[1] - u_clim6[0]));","           rgbCombo += max(0.0, min(1.0, val6)) * u_color6;","           total += val6;","       }","       if(total > 0.0 && dist < 0.1){","           break;","       }else if(dist < 0.1){           gl_FragColor = vec4(0.0,0.0,0.0,0.0);","           break;","       }","       if(u_renderstyle == 0 && (max_val > u_clim[1] && max_val2 >= u_clim2[1] && max_val3 >= u_clim3[1] && max_val4 >= u_clim4[1] && max_val5 >= u_clim5[1] &&  max_val6 >= u_clim6[1])) break;","       if(u_renderstyle == 2){           total = min(total, 1.0);","           vec4 val_color = vec4(rgbCombo, total);","           val_color.a = 1.0 - pow(1.0 - val_color.a, 1.0);","           gl_FragColor.rgb += (1.0 - gl_FragColor.a) * val_color.a * val_color.rgb;","           gl_FragColor.a += (1.0 - gl_FragColor.a) * val_color.a * dtScale;","           if (gl_FragColor.a >= 0.95) {","               break;","           }","       }","       p += step;","  }","   gl_FragDepth = distance(worldSpaceCoords,p)*u_physical_Pixel;","   if(u_renderstyle == 0 && (max_val <  u_clim[0] && max_val2 < u_clim2[0] && max_val3 < u_clim3[0] &&   max_val4 <  u_clim4[0] && max_val5 <  u_clim5[0] && max_val6 <  u_clim6[0])){","        gl_FragColor = vec4(0,0,0,0);","   }else if(u_renderstyle == 0){","       max_val = (max_val - u_clim[0]) / (u_clim[1] - u_clim[0]);","       max_val2 = (max_val2 - u_clim2[0]) / (u_clim2[1] - u_clim2[0]);","       max_val3 = (max_val3 - u_clim3[0]) / (u_clim3[1] - u_clim3[0]);","       max_val4 = (max_val4 - u_clim4[0]) / (u_clim4[1] - u_clim4[0]);","       max_val5 = (max_val5 - u_clim5[0]) / (u_clim5[1] - u_clim5[0]);","       max_val6 = (max_val6 - u_clim6[0]) / (u_clim6[1] - u_clim6[0]);","       vec3 color = u_color * max_val;","       if(volumeCount > 1.0) color = color +  u_color2 * max_val2;","       if(volumeCount > 3.0) color = color +  u_color4 * max_val4;","       if(volumeCount > 2.0) color = color +  u_color3 * max_val3;","       if(volumeCount > 4.0) color = color +  u_color5 * max_val5;","       if(volumeCount > 5.0) color = color +  u_color6 * max_val6;","       vec3 colorCorrected = vec3(min(color[0], 1.0), min(color[1],1.0), min(color[2],1.0));","        gl_FragColor = vec4(color,1.0);","    }","    gl_FragColor.r = linear_to_srgb(gl_FragColor.r);","    gl_FragColor.g = linear_to_srgb(gl_FragColor.g);","    gl_FragColor.b = linear_to_srgb(gl_FragColor.b);","}"].join(`
`)},o0={maximumIntensityProjection:0,minimumIntensityProjection:1,additive:2};function s0(a,r,n,l,o,s){var O,B;const{spatialRenderingMode:u}=s,f=(B=(O=o==null?void 0:o.image)==null?void 0:O.instance)==null?void 0:B.getData();if(!f)return{channelsVisible:null,resolution:null,data:null,colors:null,contrastLimits:null,allChannels:null,channelTargetC:null};const d=o.image.instance,p=u==="3D",m=r[Dt.PHOTOMETRIC_INTERPRETATION]==="RGB",g=r[Dt.VOLUMETRIC_RENDERING_ALGORITHM],v=o0[g],b=r[Dt.SPATIAL_LAYER_VISIBLE],A=r[Dt.SPATIAL_LAYER_OPACITY];d.isInterleaved();const _=m?[[255,0,0],[0,255,0],[0,0,255]]:n.map(F=>l[F][Dt.SPATIAL_CHANNEL_COLOR]),w=m?[[0,255],[0,255],[0,255]]:n.map(F=>l[F][Dt.SPATIAL_CHANNEL_WINDOW]||[0,255]),x=m?[b&&!0,b&&!0,b&&!0]:n.map(F=>b&&l[F][Dt.SPATIAL_CHANNEL_VISIBLE]),S=m?[b&&!0,b&&!0,b&&!0]:n.map(F=>b&&d.getChannelIndex(l[F][Dt.SPATIAL_TARGET_C])),E=d.getAutoTargetResolution(),P=r[Dt.SPATIAL_TARGET_RESOLUTION],M=P===null||Number.isNaN(P)?E:P,R=o.image.loaders[0].channels;let L=r[Dt.SPATIAL_SLICE_X],N=r[Dt.SPATIAL_SLICE_Y],C=r[Dt.SPATIAL_SLICE_Z];return L=L!==null?L:new be(-1,1e5),N=N!==null?N:new be(-1,1e5),C=C!==null?C:new be(-1,1e5),{channelsVisible:x,allChannels:R,channelTargetC:S,resolution:M,data:f,colors:_,contrastLimits:w,is3dMode:p,renderingMode:v,layerTransparency:A,xSlice:L,ySlice:N,zSlice:C}}function l0(a,r,n,l,o){const{images:s={},imageLayerScopes:u,imageLayerCoordination:f,imageChannelScopesByLayer:d,imageChannelCoordination:p}=a,m=u[0],g=d[m],v=f[0][m],b=p[0][m],{channelsVisible:A,allChannels:_,channelTargetC:w,resolution:x,data:S,colors:E,contrastLimits:P,is3dMode:M,renderingMode:R,layerTransparency:L,xSlice:N,ySlice:C,zSlice:O}=s0(m,v,g,b,s[m],a);return w!==null&&(r.channelTargetC.length!==0&&(r.channelTargetC.toString()!==w.toString()||r.resolution.toString()!==x.toString())?l||o(!0):(r.channelsVisible.toString()!==A.toString()||r.colors.toString()!==E.toString()||r.is3dMode!==M||r.contrastLimits.toString()!==P.toString()||r.renderingMode.toString()!==R.toString()||r.layerTransparency.toString()!==L.toString()||r.xSlice.toString()!==N.toString()||r.ySlice.toString()!==C.toString()||r.zSlice.toString()!==O.toString())&&(n({channelsVisible:A,allChannels:_,channelTargetC:w,resolution:x,data:S,colors:E,contrastLimits:P,is3dMode:M,renderingMode:R,layerTransparency:L,xSlice:N,ySlice:C,zSlice:O}),o(!1))),{images:s,layerScope:m,imageLayerScopes:u,imageLayerCoordination:f,imageChannelScopesByLayer:d,imageChannelCoordination:p,channelsVisible:A,allChannels:_,channelTargetC:w,resolution:x,data:S,colors:E,contrastLimits:P,is3dMode:M,renderingMode:R,layerTransparency:L,xSlice:N,ySlice:C,zSlice:O}}function lo(a,r){const[n,l]=r;return(a-n)/Math.sqrt(l**2-n**2)}function u0(a,r,n,l,o,s,u,f,d,p,m,g,v){a.boxSize.value.set(n.xLength,n.yLength,n.zLength),a.volumeTex.value=r.length>0?r[0]:null,a.volumeTex2.value=r.length>1?r[1]:null,a.volumeTex3.value=r.length>2?r[2]:null,a.volumeTex4.value=r.length>3?r[3]:null,a.volumeTex5.value=r.length>4?r[4]:null,a.volumeTex6.value=r.length>5?r[5]:null,a.near.value=.1,a.far.value=3e3,a.alphaScale.value=1,a.dtScale.value=f,a.finalGamma.value=4.5,a.volumeCount.value=r.length,a.u_size.value.set(n.xLength,n.yLength,n.zLength),a.u_stop_geom.value=null,a.u_window_size.value.set(0,0),a.u_vol_scale.value.set(1/n.xLength,1/n.yLength,1/n.zLength*2),a.u_renderstyle.value=o,a.u_clim.value.set(s.length>0?s[0][0]:null,s.length>0?s[0][1]:null),a.u_clim2.value.set(s.length>1?s[1][0]:null,s.length>1?s[1][1]:null),a.u_clim3.value.set(s.length>2?s[2][0]:null,s.length>2?s[2][1]:null),a.u_clim4.value.set(s.length>3?s[3][0]:null,s.length>3?s[3][1]:null),a.u_clim5.value.set(s.length>4?s[4][0]:null,s.length>4?s[4][1]:null),a.u_clim6.value.set(s.length>5?s[5][0]:null,s.length>5?s[5][1]:null),a.u_xClip.value.set(d[0]*(1/g[0])/v[0]*n.xLength,d[1]*(1/g[0])/v[0]*n.xLength),a.u_yClip.value.set(p[0]*(1/g[1])/v[1]*n.yLength,p[1]*(1/g[1])/v[1]*n.yLength),a.u_zClip.value.set(m[0]*(1/g[2])/v[2]*n.zLength,m[1]*(1/g[1])/v[2]*n.zLength),a.u_color.value.set(u.length>0?u[0][0]:null,u.length>0?u[0][1]:null,u.length>0?u[0][2]:null),a.u_color2.value.set(u.length>1?u[1][0]:null,u.length>1?u[1][1]:null,u.length>1?u[1][2]:null),a.u_color3.value.set(u.length>2?u[2][0]:null,u.length>2?u[2][1]:null,u.length>2?u[2][2]:null),a.u_color4.value.set(u.length>3?u[3][0]:null,u.length>3?u[3][1]:null,u.length>3?u[3][2]:null),a.u_color5.value.set(u.length>4?u[4][0]:null,u.length>4?u[4][1]:null,u.length>4?u[4][2]:null),a.u_color6.value.set(u.length>5?u[5][0]:null,u.length>5?u[5][1]:null,u.length>5?u[5][2]:null)}function Cd(a,r,n,l,o,s,u,f,d,p,m,g,v,b){var R,L,N;const A=[],_=[],w=[];let x=null,S=f;if(S==null||!Array.isArray(S)||S.length<3)S=[{size:((R=S==null?void 0:S[0])==null?void 0:R.size)??1},{size:((L=S==null?void 0:S[1])==null?void 0:L.size)??1},{size:((N=S==null?void 0:S[2])==null?void 0:N.size)??1}];else for(let C=0;C<S.length;C++)(!S[C]||S[C].size===void 0||S[C].size===null)&&(S[C]={size:1});if(r.forEach((C,O)=>{n[O]&&(x=a.get(C),A.push(o.get(C)),_.push([l[O][0]/255,l[O][1]/255,l[O][2]/255]),s[O][0]===0&&s[O][1]===255?w.push([lo(u.get(C)[0],u.get(C)),lo(u.get(C)[1],u.get(C))]):w.push([lo(s[O][0],u.get(C)),lo(s[O][1],u.get(C))]))}),x===null)return null;const E={},P=i0,M=dl.clone(P.uniforms);return u0(M,A,x,E,d,w,_,p,m,g,v,[S[0].size,S[1].size,S[2]?S[2].size:1],b),[M,P,[1,S[1].size/S[0].size,S[2]?S[2].size/S[0].size:1],[x.xLength,x.yLength,x.zLength],[1,x.yLength/x.xLength,x.zLength/x.xLength]]}const c0={Uint8:Uint8Array,Uint16:Uint16Array,Uint32:Uint32Array,Int8:Int8Array,Int16:Int16Array,Int32:Int32Array,Float32:Float32Array,Float64:Float64Array};async function d0({source:a,selection:r,onUpdate:n=()=>{},downsampleDepth:l=1,signal:o}){const{shape:s,labels:u,dtype:f}=a,{height:d,width:p}=qp(a),m=s[u.indexOf("z")],g=Math.max(1,Math.floor(m/l)),v=d*p,b=c0[f],A=new b(v*g);return await Promise.all(new Array(g).fill(0).map(async(_,w)=>{const x={...r,z:w*l},{data:S}=await a.getRaster({selection:x,signal:o});let E=0;for(n({z:w,total:g,progress:.5});E<v;){const P=w*v+(v-E-1),M=(p-E-1)%p+p*Math.floor(E/p);A[P]=S[M],E+=1}n({z:w,total:g,progress:1})})),{data:A,height:d,width:p,depth:g}}function f0(a,r,n){return d0({source:n[r],selection:{t:0,c:a},downsampleDepth:2**r})}function p0(a){const r=new a0;return r.xLength=a.width,r.yLength=a.height,r.zLength=a.depth,r.data=a.data,r}function h0(a){const r=new Gp(a.data,a.xLength,a.yLength,a.zLength);return r.format=Yp,r.type=Kp,r.generateMipmaps=!1,r.minFilter=ho,r.magFilter=ho,r.needsUpdate=!0,r}function m0(a){var o;const{x:r,y:n,z:l}=((o=a==null?void 0:a.meta)==null?void 0:o.physicalSizes)??{};return[r,n,l]}function g0(a){const[r,n]=a.computeMinMax(),l=new Float32Array(a.data.length);for(let o=0;o<a.data.length;o++)l[o]=(a.data[o]-r)/Math.sqrt(n**2-r**2);return l}async function v0(a,r,n,l,o,s,u){let f=null,d=null;const{shape:p,labels:m}=n[0],g=a.filter(b=>!l.has(b)||r!==u),v=await Promise.all(g.map(b=>f0(b,r,n)));return g.forEach((b,A)=>{const _=v[A];f=p0(_);const w=f.computeMinMax();f.data=g0(f),l.set(b,f),o.set(b,h0(f)),s.set(b,w),d=m0(n[r])}),[l,o,s,d,[p[m.indexOf("x")],p[m.indexOf("y")],p[m.indexOf("z")]]]}function y0(a){var dt,Kt,_n,fn;const r=z.useRef(null),n=z.useRef(null),[l,o]=z.useState(!1),[s,u]=z.useState(!1),[f,d]=z.useState(null),[p,m]=z.useState([1,1,1]),[g,v]=z.useState({uniforms:null,shader:null,meshScale:null,geometrySize:null,boxSize:null}),[b,A]=z.useState({volumes:new Map,textures:new Map,volumeMinMax:new Map,scale:null,resolution:null,originalScale:null}),[_,w]=z.useState({channelsVisible:[],allChannels:[],channelTargetC:[],resolution:null,data:null,colors:[],contrastLimits:[],is3dMode:!1,renderingMode:null,layerTransparency:1}),[x,S]=z.useState({visible:!0,color:[1,1,1],opacity:1,multiVisible:"",multiOpacity:"",multiColor:"",data:null,obsSets:[]}),{images:E,layerScope:P,channelsVisible:M,allChannels:R,channelTargetC:L,resolution:N,data:C,colors:O,contrastLimits:B,is3dMode:F,renderingMode:K,layerTransparency:$,xSlice:le,ySlice:fe,zSlice:ve}=l0(a,_,w,s,u),{obsSegmentations:G,onEntitySelected:ee,segmentationLayerCoordination:Z,segmentationChannelCoordination:ie,segmentationChannelScopesByLayer:pe}=a;let Te=()=>{};const ze=[];if(ie[0][P]!==void 0){const me=ie[0][P][P],{setObsHighlight:Y}=ie[1][P][P];Te=Y;const te=ie[0][P][P].additionalObsSets;te!==null&&me.obsSetSelection.forEach(Me=>{const he=Me[1];te.tree[0].children.forEach(Ge=>{Ge.name===he&&Ge.set.forEach(([we])=>{const Le={name:"",id:"",color:[255,255,255]};Le.name=he,Le.id=we,me.obsSetColor.forEach(je=>{je.path[1]===he&&(Le.color=je.color)}),ze.push(Le)})})}),me.obsHighlight!==null&&ze.push({name:"",id:me.obsHighlight,color:[255,34,0]})}if((dt=G==null?void 0:G[P])!=null&&dt.obsSegmentations&&f==null){const{scene:me,sceneOptions:Y}=G[P].obsSegmentations;if(me!=null&&me.children){const te=new ll,Me=new or;Me.userData.name="finalPass",me.children.forEach(Ge=>{let we=Ge;we.material===void 0&&(we=Ge.children[0]),(we.material instanceof Sn||we.material instanceof ar)&&(we.material=new Il);let Le=we.name.replace("mesh_","").replace("mesh","").replace("glb","").replace("_dec","").replace("_Decobj","").replace("obj","").replace("_DEc","").replace(".","").replace("_Dec","");Le.includes("_")&&(Le=Le.split("_")[0]),we.name=Le,we.userData.name=Le,we.userData.layerScope=P,we.material.transparent=!0,we.material.writeDepthTexture=!0,we.material.depthTest=!0,we.material.depthWrite=!0,we.material.needsUpdate=!0,we.material.side=(Y==null?void 0:Y.materialSide)==="back"?Rd:qr;const je=we.clone();je.geometry=we.geometry.clone(),je.geometry.translate((Y==null?void 0:Y.targetX)??0,(Y==null?void 0:Y.targetY)??0,(Y==null?void 0:Y.targetZ)??0),je.geometry.scale((Y==null?void 0:Y.scaleX)??1,(Y==null?void 0:Y.scaleY)??1,(Y==null?void 0:Y.scaleZ)??1),je.geometry.rotateX((Y==null?void 0:Y.rotationX)??0),je.geometry.rotateY((Y==null?void 0:Y.rotationY)??0),je.geometry.rotateZ((Y==null?void 0:Y.rotationZ)??0);const et=we.clone();et.material=we.material.clone(),et.geometry=je.geometry.clone(),Me.add(et)}),te.add(Me),te.scale.set((Y==null?void 0:Y.sceneScaleX)??1,(Y==null?void 0:Y.sceneScaleY)??1,(Y==null?void 0:Y.sceneScaleZ)??1);const he=[(Y==null?void 0:Y.sceneScaleX)??1,(Y==null?void 0:Y.sceneScaleY)??1,(Y==null?void 0:Y.sceneScaleZ)??1];m(he),te.rotateX((Y==null?void 0:Y.sceneRotationX)??0),te.rotateY((Y==null?void 0:Y.sceneRotationY)??0),te.rotateZ((Y==null?void 0:Y.sceneRotationZ)??0),d(te)}}if(ie[0]!==void 0&&ie[0][P]!==void 0){const me=ie[0][P][P];let Y="";ze.forEach(Me=>{Y+=`${Me.id};${Me.color.toString()};${Me.name}`});let te="";if(x.obsSets.forEach(Me=>{te+=`${Me.id};${Me.color.toString()};${Me.name}`}),pe[P].length>1){let Me="",he="",Ge="",we=!1,Le=0;pe[P].forEach(je=>{const et=ie[0][P][je];Me+=`${et.spatialChannelColor.toString()};`,he+=`${et.spatialChannelOpacity};`,Ge+=`${et.spatialChannelVisible};`,we|=et.spatialChannelVisible,Le+=et.spatialChannelOpacity}),(Me!==x.multiColor||he!==x.multiOpacity||Ge!==x.multiVisible)&&S({color:me.spatialChannelColor,opacity:Le,visible:we,multiColor:Me,multiVisible:Ge,multiOpacity:he,data:G,obsSets:ze})}else(me.spatialChannelColor.toString()!==x.color.toString()||me.spatialChannelVisible!==x.visible||me.spatialChannelOpacity!==x.opacity||Y!==te)&&S({color:me.spatialChannelColor,opacity:me.spatialChannelOpacity,visible:me.spatialChannelVisible,multiColor:"",multiVisible:"",multiOpacity:"",data:G,obsSets:ze})}if(z.useEffect(()=>{if(f!==null){let me=0,Y=0;for(let te=0;te<f.children.length;te++)f.children[te].userData.name==="finalPass"?Y=te:me=te;f.children[Y].children.forEach((te,Me)=>{var we;let{color:he}=x;const Ge=te.userData.name;if(x.obsSets.forEach(Le=>{Le.id===Ge&&(he=Le.color)}),pe[P].length>1)pe[P].forEach(Le=>{const je=ie[0][P][Le];je.spatialTargetC===Ge&&(te.material.color.r=je.spatialChannelColor[0]/255,te.material.color.g=je.spatialChannelColor[1]/255,te.material.color.b=je.spatialChannelColor[2]/255,te.material.opacity=je.spatialChannelOpacity,te.visible=je.spatialChannelVisible,te.material.needsUpdate=!0,te.userData.layerScope=P,te.userData.channelScope=Le,f.children[me].children[Me].material.needsUpdate=!0)});else{te.material.color.r=he[0]/255,te.material.color.g=he[1]/255,te.material.color.b=he[2]/255,te.material.opacity=x.opacity,te.material.visible=x.visible,te.material.needsUpdate=!0,te.userData.layerScope=P;const Le=(we=Object.keys(ie[0][P]))==null?void 0:we[0];te.userData.channelScope=Le}})}},[x,f]),((fn=(_n=(Kt=E[P])==null?void 0:Kt.image)==null?void 0:_n.instance)==null?void 0:fn.getData())!==void 0&&!s&&!l&&B!==null&&B[0][1]!==255&&F&&(u(!0),o(!0)),z.useEffect(()=>{const me=async()=>{const Y=await v0(L,N,C,b.volumes,b.textures,b.volumeMinMax,b.resolution);if(Y[0]!==null)if(A({resolution:N,volumes:Y[0],textures:Y[1],volumeMinMax:Y[2],scale:Y[3]!==null?Y[3]:b.scale,originalScale:Y[4]}),!g.uniforms||!g.shader){const te=Cd(Y[0],L,M,O,Y[1],B,Y[2],Y[3],K,$,le,fe,ve,Y[4]);te!==null&&v({uniforms:te[0],shader:te[1],meshScale:te[2],geometrySize:te[3],boxSize:te[4]})}else w({channelsVisible:M,allChannels:R,channelTargetC:L,resolution:N,data:C,colors:O,contrastLimits:B,is3dMode:F,renderingMode:K,layerTransparency:$,xSlice:le,ySlice:fe,zSlice:ve})};s&&(N!==_.resolution&&r.current&&(r.current.material.uniforms.volumeCount.value=0,r.current.material.uniforms.volumeTex.value=null),me(),u(!1))},[s]),z.useEffect(()=>{var me,Y,te,Me;if(g.uniforms&&g.shader){const he=Cd(b.volumes,_.channelTargetC,_.channelsVisible,_.colors,b.textures,_.contrastLimits,b.volumeMinMax,b.scale,_.renderingMode,_.layerTransparency,_.xSlice,_.ySlice,_.zSlice,b.originalScale);if(he!==null){let Ge=0;_.channelsVisible.forEach(we=>{we&&Ge++}),u(!1),(Y=(me=r==null?void 0:r.current)==null?void 0:me.material)!=null&&Y.uniforms&&(r.current.material.uniforms.u_clim.value=he[0].u_clim.value,r.current.material.uniforms.u_clim2.value=he[0].u_clim2.value,r.current.material.uniforms.u_clim3.value=he[0].u_clim3.value,r.current.material.uniforms.u_clim4.value=he[0].u_clim4.value,r.current.material.uniforms.u_clim5.value=he[0].u_clim5.value,r.current.material.uniforms.u_clim6.value=he[0].u_clim6.value,r.current.material.uniforms.u_xClip.value=he[0].u_xClip.value,r.current.material.uniforms.u_yClip.value=he[0].u_yClip.value,r.current.material.uniforms.u_zClip.value=he[0].u_zClip.value,r.current.material.uniforms.u_color.value=he[0].u_color.value,r.current.material.uniforms.u_color2.value=he[0].u_color2.value,r.current.material.uniforms.u_color3.value=he[0].u_color3.value,r.current.material.uniforms.u_color4.value=he[0].u_color4.value,r.current.material.uniforms.u_color5.value=he[0].u_color5.value,r.current.material.uniforms.u_color6.value=he[0].u_color6.value,r.current.material.uniforms.volumeTex.value=he[0].volumeTex.value,r.current.material.uniforms.volumeTex2.value=he[0].volumeTex2.value,r.current.material.uniforms.volumeTex3.value=he[0].volumeTex3.value,r.current.material.uniforms.volumeTex4.value=he[0].volumeTex4.value,r.current.material.uniforms.volumeTex5.value=he[0].volumeTex5.value,r.current.material.uniforms.volumeTex6.value=he[0].volumeTex6.value,r.current.material.uniforms.volumeCount.value=Ge,r.current.material.uniforms.u_renderstyle.value=_.renderingMode,r.current.material.uniforms.dtScale.value=_.layerTransparency)}else(Me=(te=r==null?void 0:r.current)==null?void 0:te.material)!=null&&Me.uniforms&&(r.current.material.uniforms.volumeCount.value=0,r.current.material.uniforms.volumeTex.value=null)}},[_]),!_.is3dMode)return null;if(_.is3dMode&&(!g.uniforms||!g.shader))return ne.jsxs("group",{children:[ne.jsx("ambientLight",{}),ne.jsx("pointLight",{position:[10,10,10]}),ne.jsx(yf,{color:"white",scale:20,fontWeight:1e3,children:"Loading ..."})]});const St={segmentationGroup:f,segmentationSettings:x,segmentationSceneScale:p,renderingSettings:g,materialRef:r,highlightEntity:ee,setObsHighlight:Te};return ne.jsxs("group",{children:[ne.jsx(Dg,{}),ne.jsx(Yg,{}),ne.jsx(t0,{}),ne.jsx(r0,{}),ne.jsx(n0,{...St}),ne.jsx(Wg,{ref:n,enableDamping:!1,dampingFactor:0,zoomDampingFactor:0,smoothZoom:!1})]})}const x0=z.forwardRef((a,r)=>ne.jsxs("div",{style:{width:"100%",height:"100%"},children:[ne.jsx(Fl,{mode:"AR",sessionInit:{optionalFeatures:["hand-tracking"]},style:{border:"none",background:"rgba(0, 0, 0, 0.0)",zIndex:1,position:"absolute"},children:n=>n!=="unsupported"?ne.jsx("div",{style:{border:"1px solid white",padding:"12px 24px",borderRadius:"4px",background:"rgba(0, 0, 0, 0.1)",color:"white",font:"normal 0.8125rem sans-serif",outline:"none",cursor:"pointer"},children:n==="entered"?"Exit AR":"Enter AR"}):null}),ne.jsx(Sm,{style:{position:"absolute",top:0,left:0},camera:{fov:50,up:[0,1,0],position:[0,0,800],near:.1,far:3e3},gl:{antialias:!0,logarithmicDepthBuffer:!1},ref:r,children:ne.jsx(Lm,{children:ne.jsx(y0,{...a})})})]}));export{x0 as SpatialWrapper};
